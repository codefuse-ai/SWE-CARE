{"id": "PR_kwDOABGHUc6wyjia", "title": "Fix PathMatchingResourcePatternResolver to handle absolute paths in JAR manifests", "body": "When JAR manifest Class-Path entries contain absolute paths (as Gradle creates on Windows for long classpaths), PathMatchingResourcePatternResolver incorrectly rejected them.\r\n\r\nFixes #35730\r\n", "number": 35732, "url": "https://github.com/spring-projects/spring-framework/pull/35732", "author": {"login": "Artur-"}, "createdAt": "2025-10-31T09:34:56Z", "mergedAt": "2025-11-01T11:25:20Z", "mergedBy": {"login": "jhoeller"}, "baseRefOid": "01a58a253b0631bbaa2a3e5a4a2d098fa316ba69", "baseRefName": "6.2.x", "headRefOid": "089c627c5b0610a0325fe93b4d6535d45429b516", "headRefName": "manifest-absolute-paths", "changedFiles": 2, "labels": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"name": "type: bug"}, {"name": "in: core"}]}, "commits": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"commit": {"oid": "089c627c5b0610a0325fe93b4d6535d45429b516", "message": "fix: Fix PathMatchingResourcePatternResolver to handle absolute paths in JAR manifests\n\nWhen JAR manifest Class-Path entries contain absolute paths (as Gradle\ncreates on Windows for long classpaths), PathMatchingResourcePatternResolver\nincorrectly rejected them.\n\nFixes #35730\n\nSigned-off-by: Artur Signell <artur@vaadin.com>", "changedFilesIfAvailable": 2, "authoredDate": "2025-10-31T09:19:52Z", "author": {"user": {"login": "Artur-"}}, "committedDate": "2025-10-31T12:28:44Z", "committer": {"user": {"login": "Artur-"}}, "parents": {"nodes": [{"oid": "01a58a253b0631bbaa2a3e5a4a2d098fa316ba69"}]}}}]}, "reviews": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "reviewThreads": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "closingIssuesReferences": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"id": "I_kwDOABGHUc7VA6yV", "number": 35730, "url": "https://github.com/spring-projects/spring-framework/issues/35730", "title": "PathMatchingResourcePatternResolver fails with absolute paths in JAR manifest Class-Path entries", "body": "PathMatchingResourcePatternResolver incorrectly rejects absolute paths in JAR manifest Class-Path entries, causing classpath scanning to fail with patterns like `classpath*:**/*.class`.\n\nMinimal reproduction: https://github.com/Artur-/spring-manifest-bug-demo\n\n```sh\ngit clone https://github.com/Artur-/spring-manifest-bug-demo.git\ncd spring-manifest-bug-demo\nmvn dependency:resolve\n./create-classpath-jar.sh\n./run-test.sh\n```\n\nResult:\n- classpath*:**/*.class \u2192 2 classes \u274c (missing dependencies)\n- classpath*:org/**/*.class \u2192 458 classes \u2713 (works correctly)\n\n## Root Cause\n\nFile: PathMatchingResourcePatternResolver.java:615\n\n```java\nFile candidate = new File(parent, path);\nif (candidate.isFile() && candidate.getCanonicalPath().contains(parent.getCanonicalPath())) {\n    manifestEntries.add(ClassPathManifestEntry.of(candidate));\n}\n```\n\nThe security check rejects JARs that aren't within the parent directory. However, when Gradle creates a classpath JAR on Windows (to avoid the ~8KB command-line limit), it uses absolute paths to dependency JARs in the user's .gradle/caches/ directory. These are legitimate dependencies, not files that should be restricted to the parent directory.\n\nExample of valid manifest created by Gradle:\nClasspath JAR location: `C:/project/build/tmp/bootRun/classpath.jar`\nManifest Class-Path: `C:/Users/developer/.gradle/caches/modules-2/files-2.1/.../spring-core-6.2.1.jar`\n\nThe code extracts:\n```\nparent = \"C:/project/build/tmp/bootRun/\"  (parent of classpath.jar)\npath = \"C:/Users/developer/.gradle/caches/.../spring-core-6.2.1.jar\"  (from manifest)\n```\n\nThe check fails because the Gradle cache path doesn't contain the bootRun directory path, but these are valid dependency JARs that should be loaded.\n\n##  When This Occurs\n\n  - Windows with Gradle (classpath exceeds ~8KB limit)\n  - IntelliJ IDEA with classpath shortening\n  - Any build tool using absolute paths in manifest Class-Path\n\n\nRelated Issues\n\n- #18260, #28276, #24480\n- vaadin/flow#21051\n", "state": "CLOSED", "labels": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"name": "in: core"}, {"name": "status: superseded"}]}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpHOzv_Rng=="}, "nodes": [{"id": "IC_kwDOABGHUc7O_9Ge", "author": {"login": "jhoeller"}, "body": "Superseded by PR #35732.", "createdAt": "2025-10-31T12:25:45Z", "updatedAt": "2025-10-31T12:25:45Z"}]}}]}}
{"id": "PR_kwDOABGHUc6qfC5j", "title": "Remove redundant object allocation in cglib proxy method calls", "body": "Fixes gh-35542\r\n\r\nI've noticed ~1.2TB of memory allocations of `java.lang.Boolean` in 10 minute long JMC dump.\r\nThis seemed a lot to me so I have fixed it. After the patch, the bytecode of generated cglib proxies now display a more memory saving `valueOf()` calls to box primitives (especially the Boolean)", "number": 35543, "url": "https://github.com/spring-projects/spring-framework/pull/35543", "author": {"login": "Entea"}, "createdAt": "2025-09-25T11:19:46Z", "mergedAt": "2025-10-02T19:22:19Z", "mergedBy": {"login": "jhoeller"}, "baseRefOid": "ba0de1edce63630173784b2b2b2d60489f8c2d3c", "baseRefName": "main", "headRefOid": "96d8109b780a97a3c8780003d25b5a8a1f9ce90f", "headRefName": "main", "changedFiles": 1, "labels": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"name": "in: core"}, {"name": "type: enhancement"}]}, "commits": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"commit": {"oid": "96d8109b780a97a3c8780003d25b5a8a1f9ce90f", "message": "Remove redundant object allocation in cglib proxy method calls\n* Fixes gh-35542\n\nSigned-off-by: Nurlan Turdaliev <nurlan0000@gmail.com>", "changedFilesIfAvailable": 1, "authoredDate": "2025-09-25T11:19:14Z", "author": {"user": {"login": "Entea"}}, "committedDate": "2025-09-25T11:47:10Z", "committer": {"user": {"login": "Entea"}}, "parents": {"nodes": [{"oid": "5df082132dbb2881d600e002d5dfe4ba8f31a9a1"}]}}}]}, "reviews": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "reviewThreads": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "closingIssuesReferences": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"id": "I_kwDOABGHUc7N0xkO", "number": 35542, "url": "https://github.com/spring-projects/spring-framework/issues/35542", "title": "Remove redundant object allocation in cglib proxy method calls", "body": "Hello!\n\nI've noticed a huge amount of memory allocations of java.lang.Boolean being made in calls to CGLIB proxies with a primitive boolean in the method signature. Tracing down the issue, I found that the method invocation code uses the new Boolean(boolean) constructor (which has been deprecated for removal since Java 9, by the way) to box the boolean, instead of the more efficient Boolean.valueOf().\n\nIt would be nice to fix this small issue.", "state": "CLOSED", "labels": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"name": "in: core"}, {"name": "status: superseded"}]}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpHOxrWHBg=="}, "nodes": [{"id": "IC_kwDOABGHUc7GtYcG", "author": {"login": "sbrannen"}, "body": "Thanks for raising the issue.\n\nWe will take your PR into consideration.\n\nIn the future, please do not submit both an issue and a PR. One will suffice.\n\nIn light of that, I am closing this as:\n\n- Superseded by #35543", "createdAt": "2025-09-25T12:51:09Z", "updatedAt": "2025-09-25T12:51:09Z"}]}}]}}
{"id": "PR_kwDOABGHUc6PXzD0", "title": "Introduce Stream variant methods for SqlQuery", "body": "Closes GH-34474", "number": 34623, "url": "https://github.com/spring-projects/spring-framework/pull/34623", "author": {"login": "quaff"}, "createdAt": "2025-03-20T00:44:05Z", "mergedAt": "2025-03-21T17:38:28Z", "mergedBy": {"login": "jhoeller"}, "baseRefOid": "6505c4b839b06fca22aac9d179f2b678e196dc5f", "baseRefName": "main", "headRefOid": "2745eab27a78e9262a7363bb8912aebc4d43ca27", "headRefName": "patch-104", "changedFiles": 2, "labels": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"name": "in: data"}, {"name": "type: enhancement"}]}, "commits": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"commit": {"oid": "2745eab27a78e9262a7363bb8912aebc4d43ca27", "message": "Introduce Stream variant methods for SqlQuery\n\nCloses GH-34474\n\nSigned-off-by: Yanming Zhou <zhouyanming@gmail.com>", "changedFilesIfAvailable": 2, "authoredDate": "2025-02-24T03:43:08Z", "author": {"user": {"login": "quaff"}}, "committedDate": "2025-03-21T01:20:54Z", "committer": {"user": {"login": "quaff"}}, "parents": {"nodes": [{"oid": "cacc63da20f54d93111b86ffd7961b3ce3dcce53"}]}}}]}, "reviews": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "reviewThreads": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "closingIssuesReferences": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"id": "I_kwDOABGHUc6rSmMp", "number": 34474, "url": "https://github.com/spring-projects/spring-framework/issues/34474", "title": "Introduce Stream variant methods for SqlQuery", "body": "`queryForStream()` was introduced for `JdbcOperations` since 5.3, It would be nice if `SqlQuery` could leverage it to process large result too.\n\nI would like to prepare PR if the proposal is accepted.", "state": "CLOSED", "labels": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"name": "in: data"}, {"name": "type: enhancement"}]}, "comments": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpHOo46IwQ=="}, "nodes": [{"id": "IC_kwDOABGHUc6jF6nX", "author": {"login": "jhoeller"}, "body": "Sounds good, let's consider that for 7.0 then.", "createdAt": "2025-03-19T11:08:26Z", "updatedAt": "2025-03-19T11:08:26Z"}, {"id": "IC_kwDOABGHUc6jjojB", "author": {"login": "jhoeller"}, "body": "Superseded by PR #34623.", "createdAt": "2025-03-21T17:36:00Z", "updatedAt": "2025-03-21T17:36:00Z"}]}}]}}
{"id": "PR_kwDOABGHUc5hdDgb", "title": "Add `MySQLIdentityColumnMaxValueIncrementer`", "body": "The PR adds `MySQLIdentityColumnMaxValueIncrementer` to resolve #18989.\r\n\r\nUsing a MySQL auto-increment column as a sequence with `AbstractIdentityColumnMaxValueIncrementer` was not practical before MySQL 8 as the auto-increment counter was only stored in memory but not persisted. With MySQL 8.0 and InnoDB, this behavior has changed: https://dev.mysql.com/doc/refman/8.0/en/innodb-auto-increment-handling.html#innodb-auto-increment-initialization\r\n\r\nWith MySQL 8 and InnoDB, the new incrementer can be used safely in a setup with active-active replication. If the database parameters [`auto_increment_increment`](https://dev.mysql.com/doc/refman/8.0/en/replication-options-source.html#sysvar_auto_increment_increment) and [`auto_increment_offset`](https://dev.mysql.com/doc/refman/8.0/en/replication-options-source.html#sysvar_auto_increment_offset) are configured appropriately, the incrementer will not produce duplicate ids even if different database instances are queried.\r\n\r\nI've assembled a toy setup with a multi-threaded test against two MySQL instances with active-active replication here: https://github.com/hpoettker/mysql-incrementer-demo", "number": 31784, "url": "https://github.com/spring-projects/spring-framework/pull/31784", "author": {"login": "hpoettker"}, "createdAt": "2023-12-07T18:47:52Z", "mergedAt": "2023-12-08T15:12:29Z", "mergedBy": {"login": "jhoeller"}, "baseRefOid": "2e07f9ab33d882876f46912fcea08030b2593d49", "baseRefName": "main", "headRefOid": "dfadac8207bb53e9d44c9efb4ac44a1ae74279d7", "headRefName": "mysql-incrementer", "changedFiles": 2, "labels": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"name": "in: data"}, {"name": "type: enhancement"}]}, "commits": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"commit": {"oid": "dfadac8207bb53e9d44c9efb4ac44a1ae74279d7", "message": "Adds `MySQLIdentityColumnMaxValueIncrementer`\n\nThe new `DataFieldMaxValueIncrementer` can be used with identity columns in MySQL 8.0 or later.", "changedFilesIfAvailable": 2, "authoredDate": "2023-12-07T18:20:02Z", "author": {"user": {"login": "hpoettker"}}, "committedDate": "2023-12-07T18:20:02Z", "committer": {"user": {"login": "hpoettker"}}, "parents": {"nodes": [{"oid": "2e07f9ab33d882876f46912fcea08030b2593d49"}]}}}]}, "reviews": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "reviewThreads": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "closingIssuesReferences": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"id": "MDU6SXNzdWUzOTgxOTQ5MTQ=", "number": 18989, "url": "https://github.com/spring-projects/spring-framework/issues/18989", "title": "MySQLMaxValueIncrementer is not multi-master replication-safe [SPR-14418]", "body": "**[Tim Gokcen](https://jira.spring.io/secure/ViewProfile.jspa?name=hexetic)** opened **[SPR-14418](https://jira.spring.io/browse/SPR-14418?redirect=false)** and commented\n\nThe Spring `org.springframework.jdbc.support.incrementer` subsystem is used by Spring Batch, among others, to generate increasing \"unique\" IDs.\n\nHowever, `org.springframework.jdbc.support.incrementer.MySQLMaxValueIncrementer` is not safe to use in multi-master MySQL or MariaDB environments, e.g. master-master replication or MySQL/Galera cluster. This is because of the way in which it always kicks forward last_insert_id() by getCacheSize(), which will result in duplicate IDs across hosts and result in collisions if those IDs are used to, for example, insert rows into a table that has a unique key on the ID.\n\nThe global MySQL variable `auto_increment_increment` is available and used by clustering systems to ensure that AUTO_INCREMENT columns do not collide across the cluster (see the [Galera documentation](https://mariadb.org/auto-increments-in-galera/)). The same value could also be used by MySQLMaxValueIncrementer to avoid collisions.\n\nIn multi-master environments, the cacheSize would also have to always be equal to 1; there is no way to pre-allocate IDs without guaranteeing that they were not already selected by another host.\n\nAlternatively, the whole idea of using the backing RDBMS to generate increasing IDs could be abandoned in favour of generating non-linearly increasing \"probably-unique\" IDs, as for example in in [Twitter Snowflake](https://github.com/twitter/snowflake/tree/snowflake-2010), which uses a combination of \"timestamp + host-ID + thread-ID + counter\" to produce a very-likely-to-be-unique 64-bit integer.\n\n\n---\n\n**Affects:** 4.2.6\n", "state": "CLOSED", "labels": {"totalCount": 3, "pageInfo": {"hasNextPage": false, "endCursor": "Mw"}, "nodes": [{"name": "in: data"}, {"name": "type: enhancement"}, {"name": "status: superseded"}]}, "comments": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpHObgrLnw=="}, "nodes": [{"id": "MDEyOklzc3VlQ29tbWVudDQ1MzQ0MTcxNQ==", "author": {"login": "spring-projects-issues"}, "body": "**[krishna81m@gmail.com](https://jira.spring.io/secure/ViewProfile.jspa?name=krishna81m)** commented\n\nSpring Batch does not seem to provide support to inject/override custom implementations as they not annotated beans that you can override using `@Primary` at runtime. However, src/main/resources/data-source-context.xml already has externalized this class based on src/main/resources/batch-mysql.properties based on the ENVIRONMENT\n\n```java\n<!--  Use this to set additional properties on beans at run time -->\n<bean id=\"overrideProperties\" class=\"org.springframework.beans.factory.config.PropertyOverrideConfigurer\"\n   depends-on=\"environment\">\n   <property name=\"location\" value=\"classpath:batch-${ENVIRONMENT}.properties\" />\n\nbatch-mysql.properties\n..\nbatch.jdbc.password=test\nbatch.database.incrementer.class=org.springframework.jdbc.support.incrementer.MySQLMaxValueIncrementer\n..\n```\n\nWe probably have to implement a custom class and override this properties file in classpath if I am not wrong. Worst case, we were able to fork and inject our own Incrementer to resolve this problem in our Galera cluster across DCs besides thinking about stopping replication completely.\n\n", "createdAt": "2018-04-03T01:35:29Z", "updatedAt": "2019-01-11T09:08:22Z"}, {"id": "IC_kwDOABGHUc5uCsuf", "author": {"login": "jhoeller"}, "body": "Superseded by PR #31784.", "createdAt": "2023-12-07T22:23:13Z", "updatedAt": "2023-12-07T22:23:13Z"}]}}]}}
{"id": "PR_kwDOABGHUc5ggDmA", "title": "Correct conversion from Resource[] with length 1 to Collection<Resource>", "body": "Fix GH-31693", "number": 31699, "url": "https://github.com/spring-projects/spring-framework/pull/31699", "author": {"login": "quaff"}, "createdAt": "2023-11-28T01:40:01Z", "mergedAt": "2023-11-30T13:05:13Z", "mergedBy": {"login": "jhoeller"}, "baseRefOid": "4e2d3573189b7c0afce62bce29cd915de4077f56", "baseRefName": "main", "headRefOid": "acecf3753ff9f0b8856c56b4605ddc4d1a975177", "headRefName": "patch-37", "changedFiles": 3, "labels": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"name": "type: regression"}, {"name": "in: core"}]}, "commits": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"commit": {"oid": "acecf3753ff9f0b8856c56b4605ddc4d1a975177", "message": "Correct conversion from Resource[] with length 1 to Collection<Resource>\n\nFix GH-31693", "changedFilesIfAvailable": 3, "authoredDate": "2023-11-27T09:03:00Z", "author": {"user": {"login": "quaff"}}, "committedDate": "2023-11-28T01:35:21Z", "committer": {"user": {"login": "quaff"}}, "parents": {"nodes": [{"oid": "4e2d3573189b7c0afce62bce29cd915de4077f56"}]}}}]}, "reviews": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "reviewThreads": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "closingIssuesReferences": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"id": "I_kwDOABGHUc536E_Q", "number": 31693, "url": "https://github.com/spring-projects/spring-framework/issues/31693", "title": "Resource collection injection by @Value regression", "body": "```java\r\nimport static org.assertj.core.api.Assertions.assertThat;\r\n\r\nimport java.util.List;\r\n\r\nimport org.junit.jupiter.api.Test;\r\nimport org.springframework.beans.factory.annotation.Value;\r\nimport org.springframework.core.io.Resource;\r\nimport org.springframework.test.context.junit.jupiter.SpringJUnitConfig;\r\n\r\n@SpringJUnitConfig\r\npublic class ResourcesInjectionByFieldTests {\r\n\r\n\t@Value(\"classpath:application.yaml\")\r\n\tprivate Resource[] resourcesArray;\r\n\r\n\t@Value(\"classpath:application.yaml\")\r\n        // @Value(\"classpath*:application.yaml\") will works with 6.1\r\n\tprivate List<Resource> resourcesList;\r\n\r\n\t@Test\r\n\tvoid test() {\r\n\t\tassertThat(resourcesArray).isNotEmpty();\r\n\t\tassertThat(resourcesList).isNotEmpty();\r\n\t}\r\n\r\n}\r\n\r\n```\r\nThis test case failed after upgrading spring framework from 6.0 to 6.1, I believe it introduced by https://github.com/spring-projects/spring-framework/commit/84b3335e711bee38efdf6518e72d0ec441704fce which fixed https://github.com/spring-projects/spring-framework/issues/24845. It's possible that this will fix a [spring boot regression](https://github.com/spring-projects/spring-boot/issues/38556).\r\n```\r\n15:51:49.983 [main] INFO org.springframework.test.context.support.AnnotationConfigContextLoaderUtils -- Could not detect default configuration classes for test class [com.example.demo.ResourcesInjectionByFieldTests]: ResourcesInjectionByFieldTests does not declare any static, non-private, non-final, nested classes annotated with @Configuration.\r\n15:51:50.141 [main] ERROR org.springframework.test.context.TestContextManager -- Caught exception while allowing TestExecutionListener [org.springframework.test.context.support.DependencyInjectionTestExecutionListener] to prepare test instance [com.example.demo.ResourcesInjectionByFieldTests@737a135b]\r\norg.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'com.example.demo.ResourcesInjectionByFieldTests': Unsatisfied dependency expressed through field 'resourcesList': Failed to convert value of type 'java.lang.String' to required type 'java.util.List'; Cannot convert value of type 'java.lang.String' to required type 'java.util.List': PropertyEditor [org.springframework.core.io.support.ResourceArrayPropertyEditor] returned inappropriate value of type 'org.springframework.core.io.ClassPathResource'\r\n\tat org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:772)\r\n\tat org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:752)\r\n\tat org.springframework.beans.factory.annotation.InjectionMetadata.inject(InjectionMetadata.java:145)\r\n\tat org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessProperties(AutowiredAnnotationBeanPostProcessor.java:493)\r\n\tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1420)\r\n\tat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireBeanProperties(AbstractAutowireCapableBeanFactory.java:397)\r\n\tat org.springframework.test.context.support.DependencyInjectionTestExecutionListener.injectDependencies(DependencyInjectionTestExecutionListener.java:142)\r\n\tat org.springframework.test.context.support.DependencyInjectionTestExecutionListener.prepareTestInstance(DependencyInjectionTestExecutionListener.java:97)\r\n\tat org.springframework.test.context.TestContextManager.prepareTestInstance(TestContextManager.java:247)\r\n\tat org.springframework.test.context.junit.jupiter.SpringExtension.postProcessTestInstance(SpringExtension.java:163)\r\n...\r\nCaused by: org.springframework.beans.TypeMismatchException: Failed to convert value of type 'java.lang.String' to required type 'java.util.List'; Cannot convert value of type 'java.lang.String' to required type 'java.util.List': PropertyEditor [org.springframework.core.io.support.ResourceArrayPropertyEditor] returned inappropriate value of type 'org.springframework.core.io.ClassPathResource'\r\n\tat org.springframework.beans.TypeConverterSupport.convertIfNecessary(TypeConverterSupport.java:87)\r\n\tat org.springframework.beans.TypeConverterSupport.convertIfNecessary(TypeConverterSupport.java:71)\r\n\tat org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1379)\r\n\tat org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1348)\r\n\tat org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:769)\r\n\t... 76 common frames omitted\r\nCaused by: java.lang.IllegalArgumentException: Cannot convert value of type 'java.lang.String' to required type 'java.util.List': PropertyEditor [org.springframework.core.io.support.ResourceArrayPropertyEditor] returned inappropriate value of type 'org.springframework.core.io.ClassPathResource'\r\n\tat org.springframework.beans.TypeConverterDelegate.convertIfNecessary(TypeConverterDelegate.java:268)\r\n\tat org.springframework.beans.TypeConverterSupport.convertIfNecessary(TypeConverterSupport.java:80)\r\n\t... 80 common frames omitted\r\n```\r\n", "state": "CLOSED", "labels": {"totalCount": 3, "pageInfo": {"hasNextPage": false, "endCursor": "Mw"}, "nodes": [{"name": "type: regression"}, {"name": "in: core"}, {"name": "status: superseded"}]}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpHObUzIkQ=="}, "nodes": [{"id": "IC_kwDOABGHUc5tTMiR", "author": {"login": "jhoeller"}, "body": "Superseded by PR #31699.", "createdAt": "2023-11-30T13:03:33Z", "updatedAt": "2023-11-30T13:03:33Z"}]}}]}}
{"id": "PR_kwDOABGHUc5fvsZy", "title": "Extract recurring asciidoc links to attributes", "body": "This commit extracts Spring-related links and recurring external links into asciidoctor attributes to be used by the Antora toolchain.\r\n\r\nIt notably homogenizes links to:\r\n - IETF RFCs\r\n - Java Community Process JSRs\r\n - Java API Documentation (Java 17 version)\r\n - Kotlin documentation (Kotlinlang.org version)\r\n - the Spring Boot reference guide (`html` version)\r\n\r\nThis commit also reworks most link attributes to follow a Project-Category-Misc syntax. For example, `spring-boot-docs` rather than `docs-spring-boot`.\r\n\r\nCloses gh-26864", "number": 31619, "url": "https://github.com/spring-projects/spring-framework/pull/31619", "author": {"login": "simonbasle"}, "createdAt": "2023-11-17T12:29:55Z", "mergedAt": "2023-11-21T14:59:24Z", "mergedBy": {"login": "simonbasle"}, "baseRefOid": "bec385d310865331db34b1ef8f93f0b0c29eac2e", "baseRefName": "main", "headRefOid": "a4425b2a6cb0c6c149072c94c64b5cb38adb6fd3", "headRefName": "asciidocAttributes", "changedFiles": 202, "labels": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"name": "type: documentation"}]}, "commits": {"totalCount": 8, "pageInfo": {"hasNextPage": false, "endCursor": "OA"}, "nodes": [{"commit": {"oid": "1f9b099dfb4e4e57248d07de28ebc2f9878b9794", "message": "Extract recurring asciidoc links to attributes\n\nThis commit extract spring-related links and recurring\nexternal links into asciidoctor attributes to be used\nby the Antora toolchain.\n\nIt notably homogenizes links to:\n - IETF RFCs\n - Java Community Process JSRs\n - the Java API Documentation (on the Java 17 version)\n - Kotlin documentations (on the Kotlinlang.org version)\n - the Spring Boot reference guide (on the `html` version)\n\nThis commit also reworks most link attributes to follow\na Project-Category-Misc syntax. For example, spring-boot-docs rather than docs-spring-boot.\n\nCloses gh-26864", "changedFilesIfAvailable": 183, "authoredDate": "2023-11-16T11:03:09Z", "author": {"user": {"login": "simonbasle"}}, "committedDate": "2023-11-17T12:19:34Z", "committer": {"user": {"login": "simonbasle"}}, "parents": {"nodes": [{"oid": "dd97dee7fda7c0a29a5c943961816a77124a0676"}]}}}, {"commit": {"oid": "366681fc95787637ac509e23e40b4070e4b7767c", "message": "revert attribute of JIRA link, this section should have been removed on main", "changedFilesIfAvailable": 1, "authoredDate": "2023-11-21T10:28:45Z", "author": {"user": {"login": "simonbasle"}}, "committedDate": "2023-11-21T10:28:45Z", "committer": {"user": {"login": "simonbasle"}}, "parents": {"nodes": [{"oid": "1f9b099dfb4e4e57248d07de28ebc2f9878b9794"}]}}}, {"commit": {"oid": "e481fb2149ffdc1b472cd56fae9cd383e4baf459", "message": "review: fold attribute, inline spring-repo, remove issues-old", "changedFilesIfAvailable": 1, "authoredDate": "2023-11-21T10:29:51Z", "author": {"user": {"login": "simonbasle"}}, "committedDate": "2023-11-21T10:29:51Z", "committer": {"user": {"login": "simonbasle"}}, "parents": {"nodes": [{"oid": "366681fc95787637ac509e23e40b4070e4b7767c"}]}}}, {"commit": {"oid": "c771d63a24dd7d420c208af409545b7ec2398bc9", "message": "review: (actually) remove issues-old attribute", "changedFilesIfAvailable": 1, "authoredDate": "2023-11-21T10:36:11Z", "author": {"user": {"login": "simonbasle"}}, "committedDate": "2023-11-21T10:36:11Z", "committer": {"user": {"login": "simonbasle"}}, "parents": {"nodes": [{"oid": "e481fb2149ffdc1b472cd56fae9cd383e4baf459"}]}}}, {"commit": {"oid": "21c016fe3ecbd8c07903d74397f3d4432148157e", "message": "Remove now irrelevant src/docs/asciidoc folder", "changedFilesIfAvailable": 19, "authoredDate": "2023-11-21T10:38:00Z", "author": {"user": {"login": "simonbasle"}}, "committedDate": "2023-11-21T10:38:00Z", "committer": {"user": {"login": "simonbasle"}}, "parents": {"nodes": [{"oid": "c771d63a24dd7d420c208af409545b7ec2398bc9"}]}}}, {"commit": {"oid": "fe605cf708ea42d9be5525888404fcddadac892c", "message": "fixup: convert the correct JIRA issue to a gh link, keep the other one", "changedFilesIfAvailable": 1, "authoredDate": "2023-11-21T10:56:16Z", "author": {"user": {"login": "simonbasle"}}, "committedDate": "2023-11-21T10:56:16Z", "committer": {"user": {"login": "simonbasle"}}, "parents": {"nodes": [{"oid": "21c016fe3ecbd8c07903d74397f3d4432148157e"}]}}}, {"commit": {"oid": "c7ce9fdc3f7c3147388e2ae3472fef965ddeba2a", "message": "Merge branch 'main' into asciidocAttributes", "changedFilesIfAvailable": 93, "authoredDate": "2023-11-21T11:10:30Z", "author": {"user": {"login": "simonbasle"}}, "committedDate": "2023-11-21T11:10:30Z", "committer": {"user": null}, "parents": {"nodes": [{"oid": "fe605cf708ea42d9be5525888404fcddadac892c"}, {"oid": "bec385d310865331db34b1ef8f93f0b0c29eac2e"}]}}}, {"commit": {"oid": "a4425b2a6cb0c6c149072c94c64b5cb38adb6fd3", "message": "remove redundant attributes.adoc", "changedFilesIfAvailable": 1, "authoredDate": "2023-11-21T14:49:53Z", "author": {"user": {"login": "simonbasle"}}, "committedDate": "2023-11-21T14:49:53Z", "committer": {"user": {"login": "simonbasle"}}, "parents": {"nodes": [{"oid": "c7ce9fdc3f7c3147388e2ae3472fef965ddeba2a"}]}}}]}, "reviews": {"totalCount": 8, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpO5MjAyMy0xMS0yMVQxODo1MTowMSswODowMLkyMDIzLTExLTIxVDE4OjUxOjAxKzA4OjAwzmfQAyY="}, "nodes": [{"id": "PRR_kwDOABGHUc5niSvO", "author": {"login": "bclozel"}, "state": "APPROVED", "body": "Thanks for putting this together, this is solving quite a few consistency issues and will make the docs much easier to maintain!", "submittedAt": "2023-11-17T13:50:28Z", "updatedAt": "2023-11-17T13:50:28Z", "commit": {"oid": "1f9b099dfb4e4e57248d07de28ebc2f9878b9794"}, "comments": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}}, {"id": "PRR_kwDOABGHUc5nnzbz", "author": {"login": "snicoll"}, "state": "APPROVED", "body": "\ud83d\udc4d ", "submittedAt": "2023-11-18T21:31:21Z", "updatedAt": "2023-11-18T21:31:21Z", "commit": {"oid": "1f9b099dfb4e4e57248d07de28ebc2f9878b9794"}, "comments": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}}, {"id": "PRR_kwDOABGHUc5nzAj1", "author": {"login": "sbrannen"}, "state": "CHANGES_REQUESTED", "body": "This is much needed.\r\n\r\nThanks so much for taking this on! \ud83d\udc4f \r\n\r\nI've left a few questions.", "submittedAt": "2023-11-21T09:04:19Z", "updatedAt": "2023-11-21T09:04:19Z", "commit": {"oid": "1f9b099dfb4e4e57248d07de28ebc2f9878b9794"}, "comments": {"totalCount": 4, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMy0xMS0yMVQwOTowMzoyNlrOU3Xt1w=="}, "nodes": [{"id": "PRRC_kwDOABGHUc5Tdbsg", "author": {"login": "sbrannen"}, "body": "Since this is specific to Framework (as opposed to the Spring portfolio in general) and is only used once, I suggest we remove it and inline it in `spring-framework-github`.", "createdAt": "2023-11-21T08:53:49Z", "updatedAt": "2023-11-21T09:04:19Z", "path": "framework-docs/antora.yml", "diffHunk": "@@ -18,15 +18,73 @@ asciidoc:\n     # FIXME: The package is not renamed\n     chomp: 'all'\n     include-java: 'example$docs-src/main/java/org/springframework/docs'\n-    spring-framework-main-code: 'https://github.com/spring-projects/spring-framework/tree/main'\n+    spring-site: 'https://spring.io'\n+    spring-site-blog: '{spring-site}/blog'\n+    spring-site-cve: \"{spring-site}/security\"\n+    spring-site-guides: '{spring-site}/guides'\n+    spring-site-projects: '{spring-site}/projects'\n+    spring-site-tools: \"{spring-site}/tools\"\n+    spring-org: 'spring-projects'\n+    spring-repo: \"{spring-org}/spring-framework\"", "line": null, "startLine": null, "originalLine": 28, "originalStartLine": null, "replyTo": null, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "a4425b2a6cb0c6c149072c94c64b5cb38adb6fd3"}, "originalCommit": {"oid": "1f9b099dfb4e4e57248d07de28ebc2f9878b9794"}}, {"id": "PRRC_kwDOABGHUc5TddiE", "author": {"login": "sbrannen"}, "body": "A quick search reveals that we're only using that base URL for a single `SPR-` issue.\r\n\r\nSince all `SPR-` issues have been migrated to GitHub, I suggest we remove the `issues-old` attribute.\r\n\r\nIn fact, I'll replace that JIRA link with a GitHub link on `main`.", "createdAt": "2023-11-21T08:59:23Z", "updatedAt": "2023-11-21T09:04:19Z", "path": "framework-docs/antora.yml", "diffHunk": "@@ -18,15 +18,73 @@ asciidoc:\n     # FIXME: The package is not renamed\n     chomp: 'all'\n     include-java: 'example$docs-src/main/java/org/springframework/docs'\n-    spring-framework-main-code: 'https://github.com/spring-projects/spring-framework/tree/main'\n+    spring-site: 'https://spring.io'\n+    spring-site-blog: '{spring-site}/blog'\n+    spring-site-cve: \"{spring-site}/security\"\n+    spring-site-guides: '{spring-site}/guides'\n+    spring-site-projects: '{spring-site}/projects'\n+    spring-site-tools: \"{spring-site}/tools\"\n+    spring-org: 'spring-projects'\n+    spring-repo: \"{spring-org}/spring-framework\"\n+    spring-github-org: \"https://github.com/{spring-org}\"\n+    spring-framework-github: \"https://github.com/{spring-repo}\"\n+    spring-framework-code: '{spring-framework-github}/tree/main'\n+    spring-framework-issues: '{spring-framework-github}/issues'\n+    issues-old: 'https://jira.spring.io/browse'", "line": null, "startLine": null, "originalLine": 33, "originalStartLine": null, "replyTo": null, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "a4425b2a6cb0c6c149072c94c64b5cb38adb6fd3"}, "originalCommit": {"oid": "1f9b099dfb4e4e57248d07de28ebc2f9878b9794"}}, {"id": "PRRC_kwDOABGHUc5TdeaB", "author": {"login": "sbrannen"}, "body": "This appears to be overridden in `attributes.adoc`.\r\n\r\nDo we need both?", "createdAt": "2023-11-21T09:02:02Z", "updatedAt": "2023-11-21T09:04:19Z", "path": "framework-docs/antora.yml", "diffHunk": "@@ -18,15 +18,73 @@ asciidoc:\n     # FIXME: The package is not renamed\n     chomp: 'all'", "line": 19, "startLine": null, "originalLine": 19, "originalStartLine": null, "replyTo": null, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "a4425b2a6cb0c6c149072c94c64b5cb38adb6fd3"}, "originalCommit": {"oid": "1f9b099dfb4e4e57248d07de28ebc2f9878b9794"}}, {"id": "PRRC_kwDOABGHUc5Tde3X", "author": {"login": "sbrannen"}, "body": "Do we still need this file?\r\n\r\nIn other words, can we move `chomp` and `fold` to `antora.yml` and remove this one?", "createdAt": "2023-11-21T09:03:26Z", "updatedAt": "2023-11-21T09:04:19Z", "path": "framework-docs/modules/ROOT/pages/attributes.adoc", "diffHunk": "@@ -1,20 +1,20 @@\n // Spring Portfolio\n-:docs-site:                     https://docs.spring.io\n-:docs-spring-boot:              {docs-site}/spring-boot/docs/current/reference\n-:docs-spring-gemfire:           {docs-site}/spring-gemfire/docs/current/reference\n-:docs-spring-security:          {docs-site}/spring-security/reference\n+// :docs-site:                     https://docs.spring.io", "line": null, "startLine": null, "originalLine": 2, "originalStartLine": null, "replyTo": null, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "a4425b2a6cb0c6c149072c94c64b5cb38adb6fd3"}, "originalCommit": {"oid": "1f9b099dfb4e4e57248d07de28ebc2f9878b9794"}}]}}, {"id": "PRR_kwDOABGHUc5nzML9", "author": {"login": "simonbasle"}, "state": "COMMENTED", "body": "", "submittedAt": "2023-11-21T09:16:48Z", "updatedAt": "2023-11-21T09:16:48Z", "commit": {"oid": "1f9b099dfb4e4e57248d07de28ebc2f9878b9794"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMy0xMS0yMVQwOToxNjo0OFrOU3Yyog=="}, "nodes": [{"id": "PRRC_kwDOABGHUc5TdjKi", "author": {"login": "simonbasle"}, "body": "@sbrannen let's perhaps do the replace in this PR? (this would avoid a merge conflict)", "createdAt": "2023-11-21T09:16:48Z", "updatedAt": "2023-11-21T09:16:48Z", "path": "framework-docs/antora.yml", "diffHunk": "@@ -18,15 +18,73 @@ asciidoc:\n     # FIXME: The package is not renamed\n     chomp: 'all'\n     include-java: 'example$docs-src/main/java/org/springframework/docs'\n-    spring-framework-main-code: 'https://github.com/spring-projects/spring-framework/tree/main'\n+    spring-site: 'https://spring.io'\n+    spring-site-blog: '{spring-site}/blog'\n+    spring-site-cve: \"{spring-site}/security\"\n+    spring-site-guides: '{spring-site}/guides'\n+    spring-site-projects: '{spring-site}/projects'\n+    spring-site-tools: \"{spring-site}/tools\"\n+    spring-org: 'spring-projects'\n+    spring-repo: \"{spring-org}/spring-framework\"\n+    spring-github-org: \"https://github.com/{spring-org}\"\n+    spring-framework-github: \"https://github.com/{spring-repo}\"\n+    spring-framework-code: '{spring-framework-github}/tree/main'\n+    spring-framework-issues: '{spring-framework-github}/issues'\n+    issues-old: 'https://jira.spring.io/browse'", "line": null, "startLine": null, "originalLine": 33, "originalStartLine": null, "replyTo": {"id": "PRRC_kwDOABGHUc5TddiE"}, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "a4425b2a6cb0c6c149072c94c64b5cb38adb6fd3"}, "originalCommit": {"oid": "1f9b099dfb4e4e57248d07de28ebc2f9878b9794"}}]}}, {"id": "PRR_kwDOABGHUc5nzZiG", "author": {"login": "sbrannen"}, "state": "COMMENTED", "body": "", "submittedAt": "2023-11-21T09:41:27Z", "updatedAt": "2023-11-21T09:41:27Z", "commit": {"oid": "1f9b099dfb4e4e57248d07de28ebc2f9878b9794"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMy0xMS0yMVQwOTo0MToyNlrOU3a4mw=="}, "nodes": [{"id": "PRRC_kwDOABGHUc5Tdrib", "author": {"login": "sbrannen"}, "body": "It turns out the sections related to that SPR issue were obsolete, so I removed them in 617ba845771f8cf6d8f7e30ba8ff66214e97bc54.\r\n\r\nApologies if that causes troubling merge conflicts.", "createdAt": "2023-11-21T09:41:26Z", "updatedAt": "2023-11-21T09:53:14Z", "path": "framework-docs/antora.yml", "diffHunk": "@@ -18,15 +18,73 @@ asciidoc:\n     # FIXME: The package is not renamed\n     chomp: 'all'\n     include-java: 'example$docs-src/main/java/org/springframework/docs'\n-    spring-framework-main-code: 'https://github.com/spring-projects/spring-framework/tree/main'\n+    spring-site: 'https://spring.io'\n+    spring-site-blog: '{spring-site}/blog'\n+    spring-site-cve: \"{spring-site}/security\"\n+    spring-site-guides: '{spring-site}/guides'\n+    spring-site-projects: '{spring-site}/projects'\n+    spring-site-tools: \"{spring-site}/tools\"\n+    spring-org: 'spring-projects'\n+    spring-repo: \"{spring-org}/spring-framework\"\n+    spring-github-org: \"https://github.com/{spring-org}\"\n+    spring-framework-github: \"https://github.com/{spring-repo}\"\n+    spring-framework-code: '{spring-framework-github}/tree/main'\n+    spring-framework-issues: '{spring-framework-github}/issues'\n+    issues-old: 'https://jira.spring.io/browse'", "line": null, "startLine": null, "originalLine": 33, "originalStartLine": null, "replyTo": {"id": "PRRC_kwDOABGHUc5TddiE"}, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "a4425b2a6cb0c6c149072c94c64b5cb38adb6fd3"}, "originalCommit": {"oid": "1f9b099dfb4e4e57248d07de28ebc2f9878b9794"}}]}}, {"id": "PRR_kwDOABGHUc5nze6s", "author": {"login": "simonbasle"}, "state": "COMMENTED", "body": "", "submittedAt": "2023-11-21T09:50:37Z", "updatedAt": "2023-11-21T09:50:37Z", "commit": {"oid": "1f9b099dfb4e4e57248d07de28ebc2f9878b9794"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMy0xMS0yMVQwOTo1MDozN1rOU3bugg=="}, "nodes": [{"id": "PRRC_kwDOABGHUc5Tdu6C", "author": {"login": "simonbasle"}, "body": "I don't think so, not even sure `attributes.adoc` is used anymore in the antora toolchain \ud83e\udd14\r\nactually, let me double check that the whole `src/docs/asciidoc` folder is even relevant at all now...", "createdAt": "2023-11-21T09:50:37Z", "updatedAt": "2023-11-21T09:50:37Z", "path": "framework-docs/antora.yml", "diffHunk": "@@ -18,15 +18,73 @@ asciidoc:\n     # FIXME: The package is not renamed\n     chomp: 'all'", "line": 19, "startLine": null, "originalLine": 19, "originalStartLine": null, "replyTo": {"id": "PRRC_kwDOABGHUc5TdeaB"}, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "a4425b2a6cb0c6c149072c94c64b5cb38adb6fd3"}, "originalCommit": {"oid": "1f9b099dfb4e4e57248d07de28ebc2f9878b9794"}}]}}, {"id": "PRR_kwDOABGHUc5nz7FD", "author": {"login": "sbrannen"}, "state": "COMMENTED", "body": "", "submittedAt": "2023-11-21T10:40:08Z", "updatedAt": "2023-11-21T10:40:08Z", "commit": {"oid": "366681fc95787637ac509e23e40b4070e4b7767c"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMy0xMS0yMVQxMDo0MDowN1rOU3gLKg=="}, "nodes": [{"id": "PRRC_kwDOABGHUc5TeAsq", "author": {"login": "sbrannen"}, "body": "This remaining link somehow didn't show up in my local searches.\r\n\r\nIt can be replaced with the [GitHub issue](https://github.com/spring-projects/spring-framework/issues/14870).\r\n\r\n```asciidoc\r\n{spring-framework-issues}/14870[gh-14870]\r\n```", "createdAt": "2023-11-21T10:40:07Z", "updatedAt": "2023-11-21T10:40:08Z", "path": "framework-docs/modules/ROOT/pages/integration/cache/annotations.adoc", "diffHunk": "@@ -67,7 +67,7 @@ To provide a different default key generator, you need to implement the\n The default key generation strategy changed with the release of Spring 4.0. Earlier\n versions of Spring used a key generation strategy that, for multiple key parameters,\n considered only the `hashCode()` of parameters and not `equals()`. This could cause\n-unexpected key collisions (see {issues-old}/SPR-10237[SPR-10237]\n+unexpected key collisions (see https://jira.spring.io/browse/SPR-10237[SPR-10237]", "line": null, "startLine": null, "originalLine": 70, "originalStartLine": null, "replyTo": null, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "a4425b2a6cb0c6c149072c94c64b5cb38adb6fd3"}, "originalCommit": {"oid": "366681fc95787637ac509e23e40b4070e4b7767c"}}]}}, {"id": "PRR_kwDOABGHUc5n0AMm", "author": {"login": "simonbasle"}, "state": "COMMENTED", "body": "", "submittedAt": "2023-11-21T10:51:01Z", "updatedAt": "2023-11-21T10:51:01Z", "commit": {"oid": "366681fc95787637ac509e23e40b4070e4b7767c"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMy0xMS0yMVQxMDo1MTowMVrOU3hGZA=="}, "nodes": [{"id": "PRRC_kwDOABGHUc5TeEZk", "author": {"login": "simonbasle"}, "body": "that's my bad, I somehow reintroduced the wrong link / missed the fact that there were 2 jira links in the doc \ud83d\ude2e\u200d\ud83d\udca8  will fix right away", "createdAt": "2023-11-21T10:51:01Z", "updatedAt": "2023-11-21T10:51:01Z", "path": "framework-docs/modules/ROOT/pages/integration/cache/annotations.adoc", "diffHunk": "@@ -67,7 +67,7 @@ To provide a different default key generator, you need to implement the\n The default key generation strategy changed with the release of Spring 4.0. Earlier\n versions of Spring used a key generation strategy that, for multiple key parameters,\n considered only the `hashCode()` of parameters and not `equals()`. This could cause\n-unexpected key collisions (see {issues-old}/SPR-10237[SPR-10237]\n+unexpected key collisions (see https://jira.spring.io/browse/SPR-10237[SPR-10237]", "line": null, "startLine": null, "originalLine": 70, "originalStartLine": null, "replyTo": {"id": "PRRC_kwDOABGHUc5TeAsq"}, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "a4425b2a6cb0c6c149072c94c64b5cb38adb6fd3"}, "originalCommit": {"oid": "366681fc95787637ac509e23e40b4070e4b7767c"}}]}}]}, "reviewThreads": {"totalCount": 5, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMy0xMS0yMVQxMDo0MDowN1rONVCbnw=="}, "nodes": [{"id": "PRRT_kwDOABGHUc41TyTd", "isResolved": true, "isOutdated": true, "isCollapsed": true, "path": "framework-docs/antora.yml", "startLine": null, "originalLine": 28, "diffSide": "RIGHT", "startDiffSide": null, "resolvedBy": {"login": "sbrannen"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMy0xMS0yMVQwODo1Mzo0OVrOU3W7IA=="}, "nodes": [{"id": "PRRC_kwDOABGHUc5Tdbsg"}]}}, {"id": "PRRT_kwDOABGHUc41TzgU", "isResolved": true, "isOutdated": true, "isCollapsed": true, "path": "framework-docs/antora.yml", "startLine": null, "originalLine": 33, "diffSide": "RIGHT", "startDiffSide": null, "resolvedBy": {"login": "sbrannen"}, "comments": {"totalCount": 3, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMy0xMS0yMVQwOTo0MToyNlrOU3a4mw=="}, "nodes": [{"id": "PRRC_kwDOABGHUc5TddiE"}, {"id": "PRRC_kwDOABGHUc5TdjKi"}, {"id": "PRRC_kwDOABGHUc5Tdrib"}]}}, {"id": "PRRT_kwDOABGHUc41T0Ec", "isResolved": true, "isOutdated": false, "isCollapsed": true, "path": "framework-docs/antora.yml", "startLine": 19, "originalLine": 19, "diffSide": "RIGHT", "startDiffSide": null, "resolvedBy": {"login": "simonbasle"}, "comments": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMy0xMS0yMVQwOTo1MDozN1rOU3bugg=="}, "nodes": [{"id": "PRRC_kwDOABGHUc5TdeaB"}, {"id": "PRRC_kwDOABGHUc5Tdu6C"}]}}, {"id": "PRRT_kwDOABGHUc41T0Yc", "isResolved": true, "isOutdated": true, "isCollapsed": true, "path": "framework-docs/modules/ROOT/pages/attributes.adoc", "startLine": null, "originalLine": 2, "diffSide": "RIGHT", "startDiffSide": null, "resolvedBy": {"login": "simonbasle"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMy0xMS0yMVQwOTowMzoyNlrOU3Xt1w=="}, "nodes": [{"id": "PRRC_kwDOABGHUc5Tde3X"}]}}, {"id": "PRRT_kwDOABGHUc41UJuf", "isResolved": true, "isOutdated": true, "isCollapsed": true, "path": "framework-docs/modules/ROOT/pages/integration/cache/annotations.adoc", "startLine": null, "originalLine": 70, "diffSide": "RIGHT", "startDiffSide": null, "resolvedBy": {"login": "simonbasle"}, "comments": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMy0xMS0yMVQxMDo1MTowMVrOU3hGZA=="}, "nodes": [{"id": "PRRC_kwDOABGHUc5TeAsq"}, {"id": "PRRC_kwDOABGHUc5TeEZk"}]}}]}, "closingIssuesReferences": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"id": "MDU6SXNzdWU4Njg0NjgyNjQ=", "number": 26864, "url": "https://github.com/spring-projects/spring-framework/issues/26864", "title": "Use asciidoc attributes in reference documentation", "body": "There are a number of places where links could use an attribute to rationalize what we use and make sure they are consistent.", "state": "CLOSED", "labels": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"name": "type: documentation"}, {"name": "status: superseded"}]}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpHObEs1FA=="}, "nodes": [{"id": "IC_kwDOABGHUc5sSzUU", "author": {"login": "jhoeller"}, "body": "Superseded by PR #31619.", "createdAt": "2023-11-17T18:04:42Z", "updatedAt": "2023-11-17T18:04:42Z"}]}}]}}
{"id": "PR_kwDOABGHUc5RMp4Z", "title": "Always fall back to original method if annotation pointcut used", "body": "Prior to this commit, `AspectJExpressionPointcut` didn't fall back to the original method if `!@annotation()` is used, which can result in a false positive.\r\n\r\n- fixes #27119", "number": 30534, "url": "https://github.com/spring-projects/spring-framework/pull/30534", "author": {"login": "quaff"}, "createdAt": "2023-05-24T01:44:04Z", "mergedAt": "2023-11-23T15:01:19Z", "mergedBy": {"login": "jhoeller"}, "baseRefOid": "ca4d0d784b5dafdcba3a8aa74921193255ed8e3b", "baseRefName": "main", "headRefOid": "ef73ba93c87a83e481a5c9918440c5d162c4cfa9", "headRefName": "patch-22", "changedFiles": 2, "labels": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"name": "type: bug"}, {"name": "in: core"}]}, "commits": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"commit": {"oid": "ef73ba93c87a83e481a5c9918440c5d162c4cfa9", "message": "Always fall back to original method if annotation pointcut used\n\nPrior to this commit, AspectJExpressionPointcut doesn't fall back to original method if `!@annotation()` is used, it can cause false positive result.\n\nFix GH-27119", "changedFilesIfAvailable": 2, "authoredDate": "2023-05-24T04:23:32Z", "author": {"user": {"login": "quaff"}}, "committedDate": "2023-05-25T01:34:03Z", "committer": {"user": {"login": "quaff"}}, "parents": {"nodes": [{"oid": "1d6246d700db3d0ae78280f54f7595265845e174"}]}}}]}, "reviews": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "reviewThreads": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "closingIssuesReferences": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"id": "MDU6SXNzdWU5MzUzNzA5NjA=", "number": 27119, "url": "https://github.com/spring-projects/spring-framework/issues/27119", "title": "Not annotation pointcut matches dynamic proxy methods incorrectly", "body": "\"target\" and \"not @annotation\" combination not works as expected, but \"target\" and \"@annotation\" combination works fine.\r\n```java\r\n\t// works as expected\r\n\t@Around(\"execution(public * *(..)) and target(repository) and @annotation(org.springframework.transaction.annotation.Transactional)\")\r\n\tpublic Object interceptPositive(ProceedingJoinPoint pjp, Repository repository) throws Throwable {\r\n\t\tMethod method = ((MethodSignature) pjp.getSignature()).getMethod();\r\n\t\tif (!method.isAnnotationPresent(Transactional.class))\r\n\t\t\tthrow new RuntimeException(\"annotation should present here\");\r\n\t\treturn pjp.proceed();\r\n\t}\r\n\r\n\t// not works as expected\r\n\t@Around(\"execution(public * *(..)) and target(repository) and not @annotation(org.springframework.transaction.annotation.Transactional)\")\r\n\tpublic Object interceptNegative(ProceedingJoinPoint pjp, Repository repository) throws Throwable {\r\n\t\tMethod method = ((MethodSignature) pjp.getSignature()).getMethod();\r\n\t\tif (method.isAnnotationPresent(Transactional.class))\r\n\t\t\tthrow new RuntimeException(\"annotation should not present here\");\r\n\t\treturn pjp.proceed();\r\n\t}\r\n```\r\n[test-pointcut.zip](https://github.com/spring-projects/spring-framework/files/6751811/test-pointcut.zip) is a test project\r\n", "state": "CLOSED", "labels": {"totalCount": 3, "pageInfo": {"hasNextPage": false, "endCursor": "Mw"}, "nodes": [{"name": "type: bug"}, {"name": "in: core"}, {"name": "status: superseded"}]}, "comments": {"totalCount": 7, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpHObMBPAA=="}, "nodes": [{"id": "MDEyOklzc3VlQ29tbWVudDg3NDc1OTI5MA==", "author": {"login": "sbrannen"}, "body": "@quaff, have you tried the following?\r\n\r\n```java\r\n@Around(\"execution(public * *(..)) and target(repository) and !@annotation(org.springframework.transaction.annotation.Transactional)\")\r\n```", "createdAt": "2021-07-06T13:27:06Z", "updatedAt": "2021-07-06T13:27:06Z"}, {"id": "MDEyOklzc3VlQ29tbWVudDg3NTE5MDM2Mg==", "author": {"login": "quaff"}, "body": "> @quaff, have you tried the following?\r\n> \r\n> ```java\r\n> @Around(\"execution(public * *(..)) and target(repository) and !@annotation(org.springframework.transaction.annotation.Transactional)\")\r\n> ```\r\n\r\nYes, same result.", "createdAt": "2021-07-07T01:07:33Z", "updatedAt": "2021-07-07T01:07:33Z"}, {"id": "IC_kwDOABGHUc5W-9cW", "author": {"login": "quaff"}, "body": "Still not fixed in v6.0.6.", "createdAt": "2023-03-08T03:41:19Z", "updatedAt": "2023-03-08T03:41:19Z"}, {"id": "IC_kwDOABGHUc5XBdYZ", "author": {"login": "sbrannen"}, "body": "> Still not fixed in v6.0.6.\r\n\r\nIndeed.\r\n\r\nI've just assigned to this to the 6.1.x backlog, so that somebody from the team can pick it up.", "createdAt": "2023-03-08T11:10:10Z", "updatedAt": "2023-03-08T11:10:10Z"}, {"id": "IC_kwDOABGHUc5cNPuQ", "author": {"login": "nakulmitra"}, "body": "@sbrannen what if I used && in place of and, will it work?\r\n```java\r\n@Around(\"execution(public * *(..)) && target(repository) && !@annotation(org.springframework.transaction.annotation.Transactional)\")\r\n``` ", "createdAt": "2023-05-14T18:58:39Z", "updatedAt": "2023-05-14T19:00:21Z"}, {"id": "IC_kwDOABGHUc5cNld6", "author": {"login": "quaff"}, "body": "> @sbrannen what if I used && in place of and, will it work?\r\n> \r\n> ```java\r\n> @Around(\"execution(public * *(..)) && target(repository) && !@annotation(org.springframework.transaction.annotation.Transactional)\")\r\n> ```\r\n\r\nI don't think it will works, `&&` is simply substitution of `and`.", "createdAt": "2023-05-15T01:21:59Z", "updatedAt": "2023-05-15T01:21:59Z"}, {"id": "IC_kwDOABGHUc5swE8A", "author": {"login": "jhoeller"}, "body": "Superseded by PR #30534.", "createdAt": "2023-11-23T14:37:46Z", "updatedAt": "2023-11-23T14:37:46Z"}]}}]}}
{"id": "PR_kwDOABGHUc5NQnZk", "title": "Rename MockMVC matcher methods to prevent regression in user tests", "body": "This commit changes the name of two recently introduced methods in the\r\n`MockRestRequestMatchers` class for header and queryParam. These have\r\nbeen found to cause false negatives in user tests, due to the new\r\noverload taking precedence in some cases.\r\n\r\nNamely, using a `Matcher` factory method which can apply to both `List`\r\nand `String` will cause the compiler to select the newest list overload,\r\nby instantiating a `Matcher<Object>`.\r\n\r\nThis can cause false negatives in user tests, failing tests that used\r\nto pass because the Matcher previously applied to the first String in\r\nthe header or queryParam value list. For instance, `equalsTo(\"a\")`.\r\n\r\nThe new overloads are recent enough and this has enough potential to\r\ncause an arbitrary number of user tests to fail that we break the API\r\nto eliminate the ambiguity, by renaming the methods with a `*List`\r\nsuffix.\r\n\r\nCloses gh-30220\r\nCloses gh-30238\r\nSee gh-29953\r\nSee gh-28660\r\n", "number": 30238, "url": "https://github.com/spring-projects/spring-framework/pull/30238", "author": {"login": "simonbasle"}, "createdAt": "2023-03-30T13:00:02Z", "mergedAt": "2023-04-04T13:06:15Z", "mergedBy": {"login": "simonbasle"}, "baseRefOid": "3a36d51473a8f3212601c6550c6ffaa3d7840bb2", "baseRefName": "main", "headRefOid": "596f3559e09a656f75df464bec4166bd91ba84df", "headRefName": "gh30220-headerQueryParamList", "changedFiles": 2, "labels": {"totalCount": 3, "pageInfo": {"hasNextPage": false, "endCursor": "Mw"}, "nodes": [{"name": "in: test"}, {"name": "status: backported"}, {"name": "in: web"}]}, "commits": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"commit": {"oid": "a44bc02ba83a5e71c4b08d20fb00398b36c06620", "message": "Rename MockMVC matcher methods to prevent regression in user tests\n\nThis commit changes the name of two recently introduced methods in the\n`MockRestRequestMatchers` class for header and queryParam. These have\nbeen found to cause false negatives in user tests, due to the new\noverload taking precedence in some cases.\n\nNamely, using a `Matcher` factory method which can apply to both `List`\nand `String` will cause the compiler to select the newest list overload,\nby instantiating a `Matcher<Object>`.\n\nThis can cause false negatives in user tests, failing tests that used\nto pass because the Matcher previously applied to the first String in\nthe header or queryParam value list. For instance, `equalsTo(\"a\")`.\n\nThe new overloads are recent enough and this has enough potential to\ncause an arbitrary number of user tests to fail that we break the API\nto eliminate the ambiguity, by renaming the methods with a `*List`\nsuffix.\n\nCloses gh-30220\nClose gh-30238\nSee gh-29953\nSee gh-28660", "changedFilesIfAvailable": 2, "authoredDate": "2023-03-30T12:49:03Z", "author": {"user": {"login": "simonbasle"}}, "committedDate": "2023-03-30T13:01:22Z", "committer": {"user": {"login": "simonbasle"}}, "parents": {"nodes": [{"oid": "b3748243199fe809f177bb7922c69f7eb37ab6d2"}]}}}, {"commit": {"oid": "596f3559e09a656f75df464bec4166bd91ba84df", "message": "fix imports", "changedFilesIfAvailable": 1, "authoredDate": "2023-04-04T09:34:42Z", "author": {"user": {"login": "simonbasle"}}, "committedDate": "2023-04-04T09:34:42Z", "committer": {"user": {"login": "simonbasle"}}, "parents": {"nodes": [{"oid": "a44bc02ba83a5e71c4b08d20fb00398b36c06620"}]}}}]}, "reviews": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpO5MjAyMy0wNC0wNFQxNzo1Njo0MiswODowMLkyMDIzLTA0LTA0VDE3OjU2OjQyKzA4OjAwzlGx_6M="}, "nodes": [{"id": "PRR_kwDOABGHUc5Rsf-j", "author": {"login": "sbrannen"}, "state": "APPROVED", "body": "", "submittedAt": "2023-04-04T09:56:42Z", "updatedAt": "2023-04-04T09:56:42Z", "commit": {"oid": "596f3559e09a656f75df464bec4166bd91ba84df"}, "comments": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}}]}, "reviewThreads": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "closingIssuesReferences": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"id": "I_kwDOABGHUc5h_cQI", "number": 30220, "url": "https://github.com/spring-projects/spring-framework/issues/30220", "title": "Wrong MockRestRequestMatchers.header() method in spring-test being invoked (JDK issue?)", "body": "**Affects:** 2.7.10\r\n\r\n---\r\n\r\nHello everyone.\r\n\r\nI'm uncertain if this is an issue with spring-test or with Java compiler itself but, from Spring Boot 2.7.10 (which incorporates spring-test 5.3.26), we have been having an odd issue with tests calling the wrong `MockRestRequestMatchers.header()` method.\r\n\r\nIn spring-test 5.3.25 there were a couple of `header()` methods, but the one that interest us is the one with this signature:\r\n\r\n```public static RequestMatcher header(String name, Matcher<? super String>... matchers)```\r\n\r\nthis was used in testing like this:\r\n\r\n```.andExpect(header(\"X-MY-HEADER\", equalTo(\"myValue\")))```\r\n\r\nwhere `equalTo()` is defined in Hamcrest as\r\n\r\n```public static <T> Matcher<T> equalTo(T operand)```\r\n\r\nthis worked normally.\r\n\r\nFrom Spring Boot 2.7.10 (spring-test 5.3.26) a new `header()` method has been added with this signature:\r\n\r\n```public static RequestMatcher header(String name, Matcher<? super List<String>> matcher)```\r\n\r\nand this is where things are breaking: the same call above is now entering this new method, as opposed to the previous. I find this surprising because the signature doesn't match, `equalTo(\"myValue\")` returns `Matcher<String>`, which doesn't align to `Matcher<? super List<String>>`, and yet it's coming in. If I change the call to `header()` to explicitly call out the type like this:\r\n\r\n```.andExpect(header(\"X-MY-HEADER\", CoreMatchers.<String>equalTo(\"myValue\")))```\r\n\r\nthen things go back to normal and the call is again directed to the old `header()` method.\r\n\r\nI'm guessing that, via type erasure, the signatures of the two `header()` methods are being simplified to just `header(String, Matcher)` and, there being two possible candidates that can match the call, Java is just picking the first one. I'm not sure what could be done from spring-framework's perspective, though.\r\n\r\nThoughts?", "state": "CLOSED", "labels": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"name": "status: backported"}, {"name": "type: regression"}]}, "comments": {"totalCount": 3, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpHOWNTKGg=="}, "nodes": [{"id": "IC_kwDOABGHUc5Yz-t9", "author": {"login": "simonbasle"}, "body": "That's a bit unfortunate indeed \ud83d\ude1e \r\nWhen these \"base\" `Matchers` that can conceptually apply to either `String` or `List` will cause the compiler to select the `header(String, Matcher<List>)` signature. I unfortunately didn't realize that `equalTo(T)` would fall in this category.\r\n\r\nTo be precise, this is because the signature is really:\r\n```\r\npublic static RequestMatcher header(String name, Matcher<? super List<String>> matcher)\r\n```\r\nSo, to the compiler, `CoreMatchers.equalTo(\"myValue\")` fits that signature as a `Matcher<Object>` \ud83d\ude2e\u200d\ud83d\udca8 \r\n\r\n\r\n### Why was the new variant introduced?\r\nSee initial context in #28660.\r\n\r\nNote that the vararg based signature, which takes `Matcher<String>`, has a blind spot: if you provide N matchers, it only validates that the first N values in the header values list do match. This means that in your example the call would match even if the header values was in reality `[ \"myValue\", \"otherValue\" ]`... The intent of introducing a variant which accepts a List-wide `Matcher` was to alleviate this limitation and enable usage of collection matchers like:\r\n - `contains`\r\n - `hasItems`\r\n - `everyItem`\r\n - `hasSize`\r\n - `empty`\r\n\r\nThe signature has to use `? super List` because the Hamcrest collection matchers are inconsistent in the generic wildcards they use \ud83d\ude1e \r\n\r\n### A better workaround\r\nYour workaround of calling `CoreMatchers.<String>equalTo(\"myValue\")` does unambiguously select the aforementioned string-based signature, but a better workaround would be to use:\r\n\r\n```java\r\n.andExpect(header(\"X-MY-HEADER\", \r\n    Machers.contains(\"myValue\")\r\n   //equivalent to Matchers.contains(CoreMatchers.equalTo(\"myValue\"))\r\n));\r\n```\r\n\r\nThis is unambiguously a `Matcher<Iterable<String>>` AND it will validate that there are no more than one header value on top of checking for equality.\r\n\r\n### Can this be fixed in Framework?\r\n\r\nI have toyed with modifying the list-based overload implementation to try to detect such \"unexpected\" matchers and apply the passed `Matcher` directly to the first element of the `List` in addition to the whole `List` itself, but I think that is a slippery slope of trying to be too smart.\r\n\r\nThis would result in the following puzzling statements all passing in tests:\r\n```java\r\n\t\trequest.getHeaders().put(\"twoElements\", List.of(\"a\", \"b\"));\r\n\r\n\t\tMockRestRequestMatchers.header(\"twoElements\", Matchers.equalTo(\"a\")).match(this.request);\r\n\t\tMockRestRequestMatchers.header(\"twoElements\", Matchers.equalTo(List.of(\"a\", \"b\"))).match(this.request);\r\n\r\n\t\tMockRestRequestMatchers.header(\"twoElements\", Matchers.hasToString(\"[a, b]\")).match(this.request);\r\n\t\tMockRestRequestMatchers.header(\"twoElements\", Matchers.hasToString(\"a\")).match(this.request);\r\n```\r\n\r\nThis could also short-circuit null checks (although this example is a bit contrived, nonetheless `null` _is_ an acceptable value for a `HttpHeaders`...):\r\n\r\n```java\r\n\t\trequest.getHeaders().add(\"m\", null);\r\n\t\trequest.getHeaders().add(\"m\", \"b\");\r\n\r\n\t\tMockRestRequestMatchers.header(\"m\", Matchers.notNullValue()).match(this.request);\r\n\t\tMockRestRequestMatchers.header(\"m\", Matchers.nullValue()).match(this.request);\r\n```\r\n(it passes because the `List` is not null, even though the first element of the list is `null`) \r\n", "createdAt": "2023-03-30T09:54:48Z", "updatedAt": "2023-03-30T09:54:48Z"}, {"id": "IC_kwDOABGHUc5Y0m-k", "author": {"login": "simonbasle"}, "body": "This can be considered a form of regression and the feature is recent enough that we might consider hot-fixing the API, renaming the list-based variant to something unambiguously different like `headerList`. Note that a similar change is necessary for `queryParam` which had the same new API.", "createdAt": "2023-03-30T12:04:15Z", "updatedAt": "2023-03-30T12:04:15Z"}, {"id": "IC_kwDOABGHUc5Y1Moa", "author": {"login": "quiram"}, "body": "Hi @simonbasle.\r\n\r\nThanks a lot for the detailed explanation, that is very informative: I had missed the possibility that type inference could use `Matcher<Object>` as the type for `equalTo(String)`, but now that you mention it it makes perfect sense.\r\n\r\nI can see that you've opted to rename the new methods to add the `*List` suffix, I agree that this can be useful for the wider community (there may be many people scratching their heads right now). On the other hand, I really like your suggestion to use `contains()` as opposed to `equalsTo()`, it is a stricter assertion (in our case our headers usually only have one value but you never know!); I think we will adopt it anyway (using the new `*List()` variant as it becomes available).\r\n\r\nOnce again, thanks for addressing this so quickly.", "createdAt": "2023-03-30T13:49:42Z", "updatedAt": "2023-03-30T13:49:42Z"}]}}]}}
{"id": "PR_kwDOABGHUc5NDDBj", "title": "Use log4j-slf4j2-impl ", "body": "Modified to slf4j2-impl in build.gradle\r\ndue to slf4j-api versions 1.7 x or earlier issue\r\n\r\nCloses #30213 ", "number": 30216, "url": "https://github.com/spring-projects/spring-framework/pull/30216", "author": {"login": "kyuarl21"}, "createdAt": "2023-03-28T09:24:50Z", "mergedAt": "2023-04-12T11:11:48Z", "mergedBy": {"login": "jhoeller"}, "baseRefOid": "2184d4e80e4d2c6de3488e2203a5c9d98ce305fb", "baseRefName": "main", "headRefOid": "38a31f6dd8b5e2dd15187ef6f2f63c811500555e", "headRefName": "main", "changedFiles": 1, "labels": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"name": "type: task"}]}, "commits": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"commit": {"oid": "38a31f6dd8b5e2dd15187ef6f2f63c811500555e", "message": "Modified to slf4j2-impl in build.gradle\ndue to slf4j-api versions 1.7 x or earlier issue", "changedFilesIfAvailable": 1, "authoredDate": "2023-03-28T09:18:34Z", "author": {"user": {"login": "kyuarl21"}}, "committedDate": "2023-03-28T09:18:45Z", "committer": {"user": {"login": "kyuarl21"}}, "parents": {"nodes": [{"oid": "0c0cda9815645f0864a87cd854158438e1e78117"}]}}}]}, "reviews": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "reviewThreads": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "closingIssuesReferences": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"id": "I_kwDOABGHUc5h9PSv", "number": 30213, "url": "https://github.com/spring-projects/spring-framework/issues/30213", "title": "\"SLF4J: Class path contains SLF4J bindings targeting slf4j-api versions 1.7.x or earlier.\" issue", "body": "I'm not sure, so I'm raising an issue.\r\nDuring the test, an issue of \"SLF4J: Class path contains SLF4J bindings targeting slf4j-api versions 1.7.x or earlier.\" occurred.\r\n![\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2023-03-28 \u110b\u1169\u1112\u116e 5 06 45](https://user-images.githubusercontent.com/97569663/228172774-096fa2f3-1343-47a9-a909-e5c0b5612230.png)\r\n\r\nAs a result of referring to Stack Overflow, the error phrase simply disappeared.\r\n![\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2023-03-28 \u110b\u1169\u1112\u116e 5 07 21](https://user-images.githubusercontent.com/97569663/228174173-73f21b5c-b5cf-456a-ad0b-d6a1a569b2da.png)\r\n\r\n![\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2023-03-28 \u110b\u1169\u1112\u116e 5 07 41](https://user-images.githubusercontent.com/97569663/228174284-68c995ec-026e-48dc-9aae-cc93753e500b.png)\r\n\r\nSorry if it's not an issue.", "state": "CLOSED", "labels": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"name": "status: superseded"}]}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpHOWZ3VNg=="}, "nodes": [{"id": "IC_kwDOABGHUc5ZndU2", "author": {"login": "rstoyanchev"}, "body": "Superseded by #30216.", "createdAt": "2023-04-11T14:49:26Z", "updatedAt": "2023-04-11T14:49:26Z"}]}}]}}
{"id": "PR_kwDOABGHUc5L13pO", "title": "Documentation for Vavr's Try method to trigger transaction rollbacks", "body": "Updated the Spring Framework documentation to include an example of using Vavr's Try monad to trigger transaction rollbacks when a @Transactional-annotated method returns a Failure. The modified documentation demonstrates how to use Try in a transactional method and how to check if an exception has been wrapped inside a Try.Failure instance. Additionally, a link to the official Vavr documentation was added to provide more information on the Try method.\r\n\r\nCloses #29560", "number": 30108, "url": "https://github.com/spring-projects/spring-framework/pull/30108", "author": {"login": "edyda99"}, "createdAt": "2023-03-12T19:20:07Z", "mergedAt": "2023-03-28T08:38:04Z", "mergedBy": {"login": "jhoeller"}, "baseRefOid": "9cf7b0e230af83e08efa73a43334c75f6110988f", "baseRefName": "main", "headRefOid": "7027e43cc9d2b195157849a7e2a5afc113b13b27", "headRefName": "issue-29560", "changedFiles": 1, "labels": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"name": "in: data"}, {"name": "type: documentation"}]}, "commits": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"commit": {"oid": "7027e43cc9d2b195157849a7e2a5afc113b13b27", "message": "feat: Add support for Vavr's Try monad to trigger transaction rollbacks\n\nUpdated the Spring Framework documentation to include an example of using Vavr's Try monad to trigger transaction rollbacks when a @Transactional-annotated method returns a Failure. The modified documentation demonstrates how to use Try in a transactional method and how to check if an exception has been wrapped inside a Try.Failure instance. Additionally, a link to the official Vavr documentation was added to provide more information on the Try method.", "changedFilesIfAvailable": 1, "authoredDate": "2023-03-12T19:17:44Z", "author": {"user": {"login": "edyda99"}}, "committedDate": "2023-03-12T19:17:44Z", "committer": {"user": {"login": "edyda99"}}, "parents": {"nodes": [{"oid": "9cf7b0e230af83e08efa73a43334c75f6110988f"}]}}}]}, "reviews": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "reviewThreads": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "closingIssuesReferences": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"id": "I_kwDOABGHUc5XIbZJ", "number": 29560, "url": "https://github.com/spring-projects/spring-framework/issues/29560", "title": "Document support of Vavr's `Try` to potentially roll back declarative transactions", "body": "#20361 introduced support for Vavr's `Try` monad to trigger transaction rollbacks when an `@Transactional`-annotated method returns a `Failure`.\r\n\r\nI would appreciate it if that feature was described in the reference documentation, likely [this section](https://docs.spring.io/spring-framework/docs/current/reference/html/data-access.html#transaction-declarative-rolling-back).", "state": "CLOSED", "labels": {"totalCount": 3, "pageInfo": {"hasNextPage": false, "endCursor": "Mw"}, "nodes": [{"name": "in: data"}, {"name": "type: documentation"}, {"name": "status: superseded"}]}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpHOWA_iCA=="}, "nodes": [{"id": "IC_kwDOABGHUc5YD-II", "author": {"login": "jhoeller"}, "body": "Superseded by PR #30108.", "createdAt": "2023-03-21T08:26:04Z", "updatedAt": "2023-03-21T08:26:04Z"}]}}]}}
{"id": "PR_kwDOABGHUc5K3QKj", "title": "Add SpEL support for registered MethodHandles", "body": "This commit adds support for MethodHandles in SpEL, using the same\r\nsyntax as user-defined functions (which also covers reflective Methods).\r\n\r\nThe most benefit is expected with handles that capture a static method\r\nwith no arguments, or with fully bound handles (where all the arguments\r\nhave been bound, including a target instance as first bound argument\r\nif necessary). Partially bound MethodHandle should also be supported.\r\n\r\nA best effort approach is taken to detect varargs as there is no API\r\nsupport to determine if an argument is a vararg or an explicit array,\r\nunlike with Method. Argument conversions are also applied. Finally,\r\narray repacking is not always necessary with varargs so it is only\r\nperformed when the vararg is the sole argument to the invoked method.\r\n\r\nCloses gh-27099\r\nCloses gh-30045\r\n", "number": 30045, "url": "https://github.com/spring-projects/spring-framework/pull/30045", "author": {"login": "simonbasle"}, "createdAt": "2023-02-27T19:05:37Z", "mergedAt": "2023-05-05T14:18:25Z", "mergedBy": {"login": "simonbasle"}, "baseRefOid": "f2c0b3064156e0159e8c20d59ea4f654aaaaa7d9", "baseRefName": "main", "headRefOid": "88a5167bf0cd6388310d716f7983ddbbe91156c5", "headRefName": "27099-spelMethodHandle", "changedFiles": 9, "labels": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"name": "in: core"}, {"name": "type: enhancement"}]}, "commits": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"commit": {"oid": "88a5167bf0cd6388310d716f7983ddbbe91156c5", "message": "Add SpEL support for registered MethodHandles\n\nThis commit adds support for MethodHandles in SpEL, using the same\nsyntax as user-defined functions (which also covers reflective Methods).\n\nThe most benefit is expected with handles that capture a static method\nwith no arguments, or with fully bound handles (where all the arguments\nhave been bound, including a target instance as first bound argument\nif necessary). Partially bound MethodHandle should also be supported.\n\nA best effort approach is taken to detect varargs as there is no API\nsupport to determine if an argument is a vararg or an explicit array,\nunlike with Method. Argument conversions are also applied. Finally,\narray repacking is not always necessary with varargs so it is only\nperformed when the vararg is the sole argument to the invoked method.\n\nSee gh-27099\nCloses gh-30045", "changedFilesIfAvailable": 9, "authoredDate": "2023-02-27T18:58:05Z", "author": {"user": {"login": "simonbasle"}}, "committedDate": "2023-05-05T13:56:40Z", "committer": {"user": {"login": "simonbasle"}}, "parents": {"nodes": [{"oid": "f2c0b3064156e0159e8c20d59ea4f654aaaaa7d9"}]}}}]}, "reviews": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpO5MjAyMy0wMy0wN1QxNjo1MDo0MyswODowMLkyMDIzLTAzLTA3VDE2OjUwOjQyKzA4OjAwzk8mOUY="}, "nodes": [{"id": "PRR_kwDOABGHUc5PJjlG", "author": {"login": "simonbasle"}, "state": "COMMENTED", "body": "", "submittedAt": "2023-03-07T08:50:43Z", "updatedAt": "2023-03-07T08:50:43Z", "commit": null, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMy0wMy0wN1QwODo1MDo0MlrOQzTcQg=="}, "nodes": [{"id": "PRRC_kwDOABGHUc5DNNxC", "author": {"login": "simonbasle"}, "body": "here the subtle difference compared to the older `convertAllMethodArguments` higher in the source file is that we get `TypeDescriptor` out of a raw `Class` only (vs  a `MethodParam` obtained via reflection with `MethodParameter.forExecutable`)", "createdAt": "2023-03-07T08:50:42Z", "updatedAt": "2023-03-07T08:50:54Z", "path": "spring-expression/src/main/java/org/springframework/expression/spel/support/ReflectionHelper.java", "diffHunk": "@@ -330,6 +333,90 @@ else if (!sourceType.equals(targetType.getElementTypeDescriptor())) {\n \t\treturn conversionOccurred;\n \t}\n \n+\t/**\n+\t * Takes an input set of argument values and converts them to the types specified as the\n+\t * required parameter types. The arguments are converted 'in-place' in the input array.\n+\t * @param converter the type converter to use for attempting conversions\n+\t * @param arguments the actual arguments that need conversion\n+\t * @param methodHandle the target MethodHandle\n+\t * @param varargsPosition the known position of the varargs argument, if any\n+\t * ({@code null} if not varargs)\n+\t * @return {@code true} if some kind of conversion occurred on an argument\n+\t * @throws EvaluationException if a problem occurs during conversion\n+\t */\n+\tpublic static boolean convertAllMethodHandleArguments(TypeConverter converter, Object[] arguments,\n+\t\t\tMethodHandle methodHandle, @Nullable Integer varargsPosition) throws EvaluationException {\n+\t\tboolean conversionOccurred = false;\n+\t\tfinal MethodType methodHandleArgumentTypes = methodHandle.type();\n+\t\tif (varargsPosition == null) {\n+\t\t\tfor (int i = 0; i < arguments.length; i++) {\n+\t\t\t\tClass<?> argumentClass = methodHandleArgumentTypes.parameterType(i);\n+\t\t\t\tResolvableType resolvableType = ResolvableType.forClass(argumentClass);\n+\t\t\t\tTypeDescriptor targetType = new TypeDescriptor(resolvableType, argumentClass, null);", "line": 356, "startLine": null, "originalLine": 356, "originalStartLine": null, "replyTo": null, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "88a5167bf0cd6388310d716f7983ddbbe91156c5"}, "originalCommit": null}]}}]}, "reviewThreads": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMy0wMy0wN1QwODo1MDo0MlrOKvw9YQ=="}, "nodes": [{"id": "PRRT_kwDOABGHUc4q_D1h", "isResolved": false, "isOutdated": false, "isCollapsed": false, "path": "spring-expression/src/main/java/org/springframework/expression/spel/support/ReflectionHelper.java", "startLine": 356, "originalLine": 356, "diffSide": "RIGHT", "startDiffSide": null, "resolvedBy": null, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMy0wMy0wN1QwODo1MDo0MlrOQzTcQg=="}, "nodes": [{"id": "PRRC_kwDOABGHUc5DNNxC"}]}}]}, "closingIssuesReferences": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"id": "MDU6SXNzdWU5MzAwNzcxOTY=", "number": 27099, "url": "https://github.com/spring-projects/spring-framework/issues/27099", "title": "SpEL FunctionReference could support MethodHandle", "body": "A SpEL `FunctionReference` is currently limited to a **static** `Method` object, limiting what it can do drastically.\r\n\r\nOddly enough, the source code seems to imply that it could reference something else than a static Method, but if I'm not mistaken, there is only one code path, failing early with an exception if the method is not a static method:\r\n\r\nhttps://github.com/spring-projects/spring-framework/blob/a2ef6badc4c76790128910851fdde0df55ec15f9/spring-expression/src/main/java/org/springframework/expression/spel/ast/FunctionReference.java#L73-L77\r\n\r\nthen later:\r\nhttps://github.com/spring-projects/spring-framework/blob/a2ef6badc4c76790128910851fdde0df55ec15f9/spring-expression/src/main/java/org/springframework/expression/spel/ast/FunctionReference.java#L105-L108\r\n\r\n\r\nAnyways, it would be nice if `FunctionReference` could actually reference a `MethodHandle`, thus capturing a receiver (or even more context) that wouldn't have to leak in the signature to the \"function\".\r\n\r\nAre there any show stoppers for this? AFAIU, compilation to bytecode is optional, so even that shouldn't be a problem (but maybe it is actually possible). Happy to work on a PR for this if deemed acceptable.\r\n", "state": "CLOSED", "labels": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"name": "in: core"}, {"name": "type: enhancement"}]}, "comments": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpHOVj3oTA=="}, "nodes": [{"id": "IC_kwDOABGHUc5WAZYu", "author": {"login": "fanthos"}, "body": "I resolved this issue by replace the original `FunctionReference` using my patched version, by replacing the `FunctionReference` AST object. I made parameters optional (default to null) in my implemention, and disable bytecode generation when object instance is not null. The patched version could call instance function.", "createdAt": "2023-02-24T07:32:32Z", "updatedAt": "2023-02-24T07:32:32Z"}, {"id": "IC_kwDOABGHUc5WPehM", "author": {"login": "simonbasle"}, "body": "Superseded by gh-30045\r\nLet's discuss the implementation in the PR \ud83d\udc4d ", "createdAt": "2023-02-27T19:06:30Z", "updatedAt": "2023-02-27T19:06:30Z"}]}}]}}
{"id": "PR_kwDOABGHUc5Kn7wW", "title": "Add test support to record async events, with JUnit Jupiter caveat", "body": "This commit modifies the way the `@RecordApplicationEvents` annotation\nworks in tests, allowing for capture of events from threads other than\nthe main test thread (async events) and for the assertion of captured\nevent from a separate thread (e.g. when using `Awaitility`).\n\nThis is done by switching the `ApplicationEventsHolder` to use an\n`InheritedThreadLocal`.\n\nThere is a mutual exclusion between support of asynchronous events vs\nsupport of JUnit5 parallel tests with the `@TestInstance(PER_CLASS)`\nmode. As a result, we favor the former and now `SpringExtension` will\ninvalidate a test class that is annotated (or meta-annotated, or\nenclosed-annotated) with `@RecordApplicationEvents` AND\n`@TestInstance(PER_CLASS)` AND `@Execution(CONCURRENT)`.\n\nCloses gh-29827\n", "number": 30020, "url": "https://github.com/spring-projects/spring-framework/pull/30020", "author": {"login": "simonbasle"}, "createdAt": "2023-02-23T16:41:43Z", "mergedAt": "2023-05-05T15:10:41Z", "mergedBy": {"login": "simonbasle"}, "baseRefOid": "906c54faffc75721b98f9b9cf63d35edd81f7b4f", "baseRefName": "main", "headRefOid": "f269a80ef76dcddb1529345b221e9a35ced68e92", "headRefName": "29827-inheritTheadApplicationEvents", "changedFiles": 8, "labels": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"name": "in: test"}, {"name": "type: enhancement"}]}, "commits": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"commit": {"oid": "f269a80ef76dcddb1529345b221e9a35ced68e92", "message": "Add test support to record async events, with Junit5 caveat\n\nThis commit modifies the way the `@RecordApplicationEvents` annotation\nworks in tests, allowing for capture of events from threads other than\nthe main test thread (async events) and for the assertion of captured\nevent from a separate thread (e.g. when using `Awaitility`).\n\nThis is done by switching the `ApplicationEventsHolder` to use an\n`InheritedThreadLocal`.\n\nThere is a mutual exclusion between support of asynchronous events vs\nsupport of JUnit5 parallel tests with the `@TestInstance(PER_CLASS)`\nmode. As a result, we favor the former and now `SpringExtension` will\ninvalidate a test class that is annotated (or meta-annotated, or\nenclosed-annotated) with `@RecordApplicationEvents` AND\n`@TestInstance(PER_CLASS)` AND `@Execution(CONCURRENT)`.\n\nSee gh-29827\nCloses gh-30020", "changedFilesIfAvailable": 8, "authoredDate": "2023-02-23T16:33:41Z", "author": {"user": {"login": "simonbasle"}}, "committedDate": "2023-05-05T14:21:39Z", "committer": {"user": {"login": "simonbasle"}}, "parents": {"nodes": [{"oid": "906c54faffc75721b98f9b9cf63d35edd81f7b4f"}]}}}]}, "reviews": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "reviewThreads": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "closingIssuesReferences": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"id": "I_kwDOABGHUc5bfvsP", "number": 29827, "url": "https://github.com/spring-projects/spring-framework/issues/29827", "title": "`@RecordApplicationEvents` should record events from spawned threads, too", "body": "The infrastructure behind `@RecordApplicationEvents` currently uses a `ThreadLocal` to capture application events published by the current thread. Unfortunately, this rules out events published by asynchronous event listeners in turn. It would be nice if events would be captured that are published on threads spawned by the current execution thread.", "state": "CLOSED", "labels": {"totalCount": 3, "pageInfo": {"hasNextPage": false, "endCursor": "Mw"}, "nodes": [{"name": "in: test"}, {"name": "type: enhancement"}, {"name": "status: superseded"}]}, "comments": {"totalCount": 4, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpHOW5KduA=="}, "nodes": [{"id": "IC_kwDOABGHUc5ShHdQ", "author": {"login": "sbrannen"}, "body": "## Related Issues\r\n\r\n- https://github.com/spring-projects-experimental/spring-modulith/issues/116", "createdAt": "2023-01-16T18:16:01Z", "updatedAt": "2023-01-16T18:16:01Z"}, {"id": "IC_kwDOABGHUc5VIbfv", "author": {"login": "simonbasle"}, "body": "The model falls apart for concurrent tests, and most notably for tests cases that instantiate the _Test Class_ once. Typically, JUnit5 tests with `@TestInstance(Lifecycle.PER_CLASS)` (and TestNG as well if I understand correctly).\r\n\r\nTo be clear, turning the `ApplicationEventsHolder` `ThreadLocal` into an `InheritableThreadLocal` breaks the above case (as demonstrated by `ParallelApplicationEventsIntegrationTests`).\r\n\r\nUnlike in Spring Modulith, we can't really assume that tests are not parallelized (or at least parallelized in a way that events collection won't get polluted), so we have to chose between:\r\n 1. support concurrent tests / `Lifecycle.PER_CLASS`\r\n 2. support asynchronously published events and events assertions performed in a separate thread (like with Awaitility)\r\n\r\nThe `@Autowired` support is also problematic, because for `PER_CLASS` the `ApplicationEvents` is injected once and cannot have a dedicated instance per test method.\r\n\r\nThis can't be solved in time for 6.0.5, and in fact I'm not sure this can be solved at all without some breaking change / behavior (and as such 6.1.0 would potentially be a better candidate). Removing from milestone and marking for further team discussion / design.", "createdAt": "2023-02-13T16:46:39Z", "updatedAt": "2023-02-13T16:46:39Z"}, {"id": "IC_kwDOABGHUc5V9A6g", "author": {"login": "simonbasle"}, "body": "I've made quite the number of local iterations on this one, and I think the minimum viable implementation is one that:\r\n\r\n 1. have `SpringExtension` detect and reject test cases annotated with `@RecordApplicationEvents` and `@TestInstance(Lifecycle.PER_CLASS)` and `@Execution(ExecutionMode.CONCURRENT)`\r\n 2. have `ApplicationEventsHolder` use an `InheritableThreadLocal<ApplicationEvents>`\r\n\r\nI've tried various other configurations, none of which really alleviate the PER_CLASS caveat. These other ideas included: storing an `ApplicationEvents` in the `TestContext`, attempting to register one `ApplicationEventApplicationListener` per test and to trigger autowiring again, filtering captured events in the listener if a different `ApplicationEvents` could be found in the holder vs the one with which the event listener was constructed...\r\n\r\nIn the end, the `InheritableThreadLocal` seems to have the same impact with the minimum of code. ", "createdAt": "2023-02-23T16:18:35Z", "updatedAt": "2023-02-23T16:18:35Z"}, {"id": "IC_kwDOABGHUc5bkp24", "author": {"login": "simonbasle"}, "body": "Superseded by gh-30020", "createdAt": "2023-05-05T14:19:56Z", "updatedAt": "2023-05-05T14:19:56Z"}]}}]}}
{"id": "PR_kwDOABGHUc5Joq93", "title": "Allow MockRest to match header/queryParam value list with one Matcher", "body": "This commit adds a `header` variant and a `queryParam` variant to the\n`MockRestRequestMatchers` API which take a single `Matcher` over the\nlist of values.\n\nContrary to the vararg variants, the whole list is evaluated and the\ncaller can choose the desired semantics using readily-available iterable\nmatchers like `everyItem`, `hasItems`, `hasSize`, `contains` or\n`containsInAnyOrder`...\n\nThe fact that the previous variants don't strictly check the size of the\nactual list == the number of provided matchers or expected values is\nnow documented in their respective javadocs.\n\nCloses gh-28660\n", "number": 29953, "url": "https://github.com/spring-projects/spring-framework/pull/29953", "author": {"login": "simonbasle"}, "createdAt": "2023-02-09T16:28:36Z", "mergedAt": "2023-02-13T16:51:01Z", "mergedBy": {"login": "simonbasle"}, "baseRefOid": "ca9439657e001be5c5bb3460e128ce2f968dfec1", "baseRefName": "main", "headRefOid": "c662b31ec1e615e91b30a25bdf061c625deef29c", "headRefName": "28660-requestMatcherWholeValues", "changedFiles": 2, "labels": {"totalCount": 4, "pageInfo": {"hasNextPage": false, "endCursor": "NA"}, "nodes": [{"name": "in: test"}, {"name": "status: backported"}, {"name": "in: web"}, {"name": "type: enhancement"}]}, "commits": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"commit": {"oid": "d9a60b9386861010408762b03fcb3c3059ebeb2e", "message": "Allow MockRest to match header/queryParam value list with one Matcher\n\nThis commit adds a `header` variant and a `queryParam` variant to the\n`MockRestRequestMatchers` API which take a single `Matcher` over the\nlist of values.\n\nContrary to the vararg variants, the whole list is evaluated and the\ncaller can choose the desired semantics using readily-available iterable\nmatchers like `everyItem`, `hasItems`, `hasSize`, `contains` or\n`containsInAnyOrder`...\n\nThe fact that the previous variants don't strictly check the size of the\nactual list == the number of provided matchers or expected values is\nnow documented in their respective javadocs.\n\nCloses gh-28660", "changedFilesIfAvailable": 2, "authoredDate": "2023-02-09T16:18:20Z", "author": {"user": {"login": "simonbasle"}}, "committedDate": "2023-02-09T16:18:20Z", "committer": {"user": {"login": "simonbasle"}}, "parents": {"nodes": [{"oid": "ca9439657e001be5c5bb3460e128ce2f968dfec1"}]}}}, {"commit": {"oid": "c662b31ec1e615e91b30a25bdf061c625deef29c", "message": "fix wrapping of javadocs", "changedFilesIfAvailable": 1, "authoredDate": "2023-02-13T08:51:22Z", "author": {"user": {"login": "simonbasle"}}, "committedDate": "2023-02-13T08:51:22Z", "committer": {"user": {"login": "simonbasle"}}, "parents": {"nodes": [{"oid": "d9a60b9386861010408762b03fcb3c3059ebeb2e"}]}}}]}, "reviews": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpO5MjAyMy0wMi0xMFQwMDo0NToxMyswODowMLkyMDIzLTAyLTEwVDAwOjQ1OjEzKzA4OjAwzkz79Os="}, "nodes": [{"id": "PRR_kwDOABGHUc5M-_Tr", "author": {"login": "rstoyanchev"}, "state": "APPROVED", "body": "Looks good, just minor formatting comment. For Javadoc we [wrap around 90](https://github.com/spring-projects/spring-framework/wiki/Code-Style#line-wrapping), or even 80.", "submittedAt": "2023-02-09T16:45:13Z", "updatedAt": "2023-02-09T16:45:13Z", "commit": {"oid": "d9a60b9386861010408762b03fcb3c3059ebeb2e"}, "comments": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}}]}, "reviewThreads": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "closingIssuesReferences": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"id": "I_kwDOABGHUc5MFg2f", "number": 28660, "url": "https://github.com/spring-projects/spring-framework/issues/28660", "title": "Add support in `MockRestServiceServer` to assert ALL `header` and `queryParam` values with a single `Matcher`", "body": "**Affects:** 5.3.21\r\n\r\n---\r\n\r\nThe current API for `MockRestServiceServer` and `MockRestRequestMatchers` does not allow a test to validate that all values of a certain header key satisfy a matcher. Trying to do\r\n\r\n```java\r\n.andExpect(header(\"Accept\", endsWith(\"json\")))\r\n```\r\n\r\ndoes not work because it passes if the first value for the header ends with `\"json\"`. I would like to be able to do something like this:\r\n\r\n```java\r\n.andExpect(header(\"Accept\", allMatch(endsWith(\"json\"))))\r\n```\r\n\r\nor something to that effect.\r\n", "state": "CLOSED", "labels": {"totalCount": 5, "pageInfo": {"hasNextPage": false, "endCursor": "NQ"}, "nodes": [{"name": "in: test"}, {"name": "status: backported"}, {"name": "in: web"}, {"name": "type: enhancement"}, {"name": "status: superseded"}]}, "comments": {"totalCount": 11, "pageInfo": {"hasNextPage": true, "endCursor": "Y3Vyc29yOnYyOpHOVNHdPw=="}, "nodes": [{"id": "IC_kwDOABGHUc5FLr4X", "author": {"login": "sbrannen"}, "body": "Hi @mspiess,\r\n\r\n> I would like to be able to do something like this:\r\n> \r\n> ```java\r\n> .andExpect(header(\"Accept\", allMatch(endsWith(\"json\"))))\r\n> ```\r\n> \r\n> or something to that effect.\r\n\r\nThat's a good point. In fact, it almost appears that the current API would support that. At least, the current tests in place are based on that assumption.\r\n\r\nhttps://github.com/spring-projects/spring-framework/blob/93b340e5633d623e0899dd296bda7ce86ce02b20/spring-test/src/test/java/org/springframework/test/web/client/match/MockRestRequestMatchersTests.java#L126-L131\r\n\r\nThat `headerContains()` test actually does not assert what it appears to.\r\n\r\nSince `bar` and `baz` both contain `ba`, the test **appears** to assert that both `bar` and `baz` are checked, but in fact -- as you've pointed out -- only `bar` is checked.\r\n\r\nIn other words, rewriting the assertion as follows would also cause the test to pass.\r\n\r\n```java\r\nMockRestRequestMatchers.header(\"foo\", containsString(\"bar\")).match(this.request);\r\n```\r\n\r\nIn order to perform an assertion on each header value, you have to provide a matcher for each value. Thus, the following **fails**:\r\n\r\n```java\r\nMockRestRequestMatchers.header(\"foo\", containsString(\"bar\"), containsString(\"bar\")).match(this.request);\r\n```\r\n\r\nWhereas, the following **pass**:\r\n\r\n```java\r\nMockRestRequestMatchers.header(\"foo\", containsString(\"bar\"), containsString(\"baz\")).match(this.request);\r\n\r\nMockRestRequestMatchers.header(\"foo\", containsString(\"ba\"), containsString(\"ba\")).match(this.request);\r\n```\r\n\r\nThus, there is in fact support for performing assertions against all of the values for a given header, but it is awkward to use and not really documented.\r\n\r\nFurthermore, with the current implementation of this feature you have to know exactly how many values are expected **and** you have to repeat the `Matcher` or expected value.\r\n\r\nFYI: this applies to all variants of `queryParam(...)` and `header(...)`.\r\n\r\n----\r\n\r\nOne way to address this would be to introduce new variants of these methods that accept a single `String` or `Matcher` (instead of var-args) such as the following.\r\n\r\n```java\r\npublic static RequestMatcher header(String name, Matcher<? super String> matcher) {\r\n\treturn request -> {\r\n\t\tList<String> headerValues = request.getHeaders().get(name);\r\n\t\tassertNotNull(\"No header values\", headerValues);\r\n\t\tString reason = \"Request header [\" + name + \"]\";\r\n\t\theaderValues.forEach(value -> assertThat(reason, value, matcher));\r\n\t};\r\n}\r\n```\r\n\r\nThis would achieve what you are requesting; however, there is a downside: any invocation of `header()` or `queryParam()` with a single argument for the var-args array would now invoke this new method when recompiled, which would be a breaking change. To avoid that, we could come up with a new name for the single-argument variants.", "createdAt": "2022-06-20T17:27:19Z", "updatedAt": "2022-06-20T17:33:31Z"}, {"id": "IC_kwDOABGHUc5FL_x_", "author": {"login": "mspiess"}, "body": "Hi @sbrannen,\r\nthanks for the quick response and the nice summary.\r\n\r\nPerhaps a new overload would be a less of a breaking change:\r\n```Java\r\npublic static RequestMatcher header(String name, Matcher<? super Collection<? super String>> matcher) {\r\n\treturn request -> {\r\n\t\tList<String> headerValues = request.getHeaders().get(name);\r\n\t\tassertThat(\"Request header [\" + name + \"]\", headerValues, matcher);\r\n\t};\r\n}\r\n```\r\nThis would allow the following:\r\n```Java\r\nMockRestRequestMatchers.header(\"foo\", everyItem(containsString(\"ba\"))).match(this.request);\r\n```\r\nThis brings more control to the call site, as the caller can decide how to match the collection. E.g. one may want to assert that any value matches, which is not possible currently without knowing the amount and order of the header values.\r\nAlthough I have to acknowledge that this is a strong difference in behavior for an overload and may cause some confusion.\r\n\r\n>To avoid that, we could come up with a new name for the single-argument variants.\r\n\r\nI suggest `headerValues`.", "createdAt": "2022-06-20T19:21:45Z", "updatedAt": "2022-06-21T05:59:41Z"}, {"id": "IC_kwDOABGHUc5FO-qo", "author": {"login": "rstoyanchev"}, "body": "When it comes to headers, I don't think the expectation that you would know how many and match each individually is all that unreasonable. I'd expect that matching across all headers in one condition is probably a less common case.\r\n\r\nThe Javadoc on the existing methods could certainly use an improvement, even if it's obvious that a vararg means, one value or Matcher for each value.\r\n\r\nNothing wrong with introducing a variant that accepts a `Matcher<? super Collection<? super String>>` but I wouldn't call it `headerValues` since the other one is also capable of matching all header values. Perhaps `headerList` would be more explicit about the difference.", "createdAt": "2022-06-21T10:21:55Z", "updatedAt": "2022-06-21T10:21:55Z"}, {"id": "IC_kwDOABGHUc5FQEQS", "author": {"login": "sbrannen"}, "body": "> I'd expect that matching across all headers in one condition is probably a less common case.\r\n\r\nI agree.\r\n\r\n> The Javadoc on the existing methods could certainly use an improvement\r\n\r\nYes, let's improve the documentation for the affected methods.\r\n\r\n> Nothing wrong with introducing a variant that accepts a `Matcher<? super Collection<? super String>>` \r\n\r\nI did some research on what's available in Hamcrest. Instead of `Collection`, they use `Iterable`. So let's go with `Iterable` for compatibility.\r\n\r\nThe interesting (disappointing?) part is that `everyItem()` and `hasItem()` have different generic signatures. `everyItem()` produces `Matcher<Iterable<? extends U>>`; whereas, `hasItem()` produces `Matcher<Iterable<? super T>>`. \r\n\r\nThis makes `everyItem()` incompatible with the proposed new method in `MockRestRequestMatchers`, but there's nothing we can do about that since it's baked into Hamcrest like that.\r\n\r\nThough you can create a custom `everyItem()` implementation that ignores the generics as follows, and this will work with the new method in `MockRestRequestMatchers`.\r\n\r\n```java\r\n@SuppressWarnings({ \"rawtypes\", \"unchecked\" })\r\npublic static <U> Matcher<Iterable<? super U>> everyItem(Matcher<U> itemMatcher) {\r\n    return new Every(itemMatcher);\r\n}\r\n```\r\n\r\n> but I wouldn't call it `headerValues` since the other one is also capable of matching all header values. Perhaps `headerList` would be more explicit about the difference.\r\n\r\nWith the proposed signature below, we don't actually run into any issues with the compiler (in terms of source compatibility).\r\n\r\n```java\r\npublic static RequestMatcher header(String name, Matcher<Iterable<? super String>> matcher)\r\n```\r\n\r\nSo we could choose to keep the `header` method name, but perhaps a different name would help to highlight the difference in behavior (and avoid binary incompatibility).", "createdAt": "2022-06-21T14:40:33Z", "updatedAt": "2022-06-21T14:40:33Z"}, {"id": "IC_kwDOABGHUc5FQbAC", "author": {"login": "rstoyanchev"}, "body": "Keeping the `header` method name sounds good. ", "createdAt": "2022-06-21T15:42:45Z", "updatedAt": "2022-06-21T15:42:45Z"}, {"id": "IC_kwDOABGHUc5FQvwy", "author": {"login": "sbrannen"}, "body": "> The interesting (disappointing?) part is that `everyItem()` and `hasItem()` have different generic signatures. `everyItem()` produces `Matcher<Iterable<? extends U>>`; whereas, `hasItem()` produces `Matcher<Iterable<? super T>>`.\r\n\r\nIt turns out that there are open issues for Hamcrest on this topic.\r\n\r\nSee https://github.com/hamcrest/JavaHamcrest/issues/289#issuecomment-1162016379 for details.", "createdAt": "2022-06-21T16:59:52Z", "updatedAt": "2022-06-21T16:59:52Z"}, {"id": "IC_kwDOABGHUc5UtyQH", "author": {"login": "rstoyanchev"}, "body": "@sbrannen, do we go with your most recent proposal?\r\n\r\n```java\r\npublic static RequestMatcher header(String name, Matcher<Iterable<? super String>> matcher)\r\n```\r\n\r\nIts usefulness is reduced by the Hamcrest issue, however, that doesn't seem to be moving. Perhaps we can just go back to the earlier suggestion with a slightly different name:\r\n\r\n```java\r\npublic static RequestMatcher everyHeader(String name, Matcher<? super String> matcher);\r\n```\r\n", "createdAt": "2023-02-07T18:55:05Z", "updatedAt": "2023-02-07T18:55:48Z"}, {"id": "IC_kwDOABGHUc5Uyxkd", "author": {"login": "sbrannen"}, "body": "> @sbrannen, do we go with your most recent proposal?\r\n> \r\n> ```java\r\n> public static RequestMatcher header(String name, Matcher<Iterable<? super String>> matcher)\r\n> ```\r\n\r\nYes, I believe that's the route we need to go.\r\n\r\n> Its usefulness is reduced by the Hamcrest issue, however, that doesn't seem to be moving. \r\n\r\nIndeed, unfortunately.\r\n\r\n> Perhaps we can just go back to the earlier suggestion with a slightly different name:\r\n> \r\n> ```java\r\n> public static RequestMatcher everyHeader(String name, Matcher<? super String> matcher);\r\n> ```\r\n\r\nI think this is too limiting. The same matcher would be applied to each queryParam/header value individually instead of acting on the collection as a whole -- effectively the same semantics as `Matchers.everyItem()`.\r\n\r\nIn other words, if we go this route users would not be able to benefit from features like `Matchers.hasItem()`.\r\n\r\nOf course, if we wanted to provide a workaround for the generics issues in Hamcrest... we _could_ introduce both methods. However, I'm not convinced we should do that; as I mentioned in https://github.com/spring-projects/spring-framework/issues/28660#issuecomment-1161839634, users can come up with their own workarounds for the generics issues in Hamcrest.\r\n\r\n----\r\n\r\n@simonbasle has expressed in interest in taking on this issue, so I've assigned it to him for tentative inclusion in 6.0.5.\r\n\r\n----\r\n\r\nPlease note that I changed the title of this issue to reflect a changed focus on both `header()` and `queryParam()` from `MockRestRequestMatchers`.\r\n", "createdAt": "2023-02-08T13:24:25Z", "updatedAt": "2023-02-08T13:24:25Z"}, {"id": "IC_kwDOABGHUc5UzHw1", "author": {"login": "rstoyanchev"}, "body": "> Of course, if we wanted to provide a workaround for the generics issues in Hamcrest... we could introduce both methods. However, I'm not convinced we should do that; as I mentioned in https://github.com/spring-projects/spring-framework/issues/28660#issuecomment-1161839634, users can come up with their own workarounds for the generics issues in Hamcrest.\r\n\r\nVery much worth explaining and illustrating this in the Javadoc of such a new method.", "createdAt": "2023-02-08T14:29:38Z", "updatedAt": "2023-02-08T14:29:38Z"}, {"id": "IC_kwDOABGHUc5U0d0_", "author": {"login": "simonbasle"}, "body": "I'm having a look and I need to better understand why, but it appears that the following signature works both for `hasItem` and `everyItem` (among others):\r\n\r\n```java\r\npublic static RequestMatcher header(String name, Matcher<? super List<String>> matcher) {\r\n```\r\n\r\n<details>\r\n<summary>See test below demonstrating usage with various matchers</summary>\r\n\r\n```java\r\n@Test\r\nvoid headerListMatchers() throws IOException {\r\n\tthis.request.getHeaders().put(\"foo\", Arrays.asList(\"bar\", \"baz\"));\r\n\r\n\tMockRestRequestMatchers.header(\"foo\", containsInAnyOrder(endsWith(\"baz\"), endsWith(\"bar\"))).match(this.request);\r\n\tMockRestRequestMatchers.header(\"foo\", contains(is(\"bar\"), is(\"baz\"))).match(this.request);\r\n\tMockRestRequestMatchers.header(\"foo\", contains(is(\"bar\"), Matchers.anything())).match(this.request);\r\n\tMockRestRequestMatchers.header(\"foo\", hasItem(endsWith(\"baz\"))).match(this.request);\r\n\tMockRestRequestMatchers.header(\"foo\", everyItem(startsWith(\"ba\"))).match(this.request);\r\n\tMockRestRequestMatchers.header(\"foo\", hasSize(2)).match(this.request);\r\n\r\n\t//these can be a bit ambiguous when reading the test (the compiler selects the list matcher):\r\n\tMockRestRequestMatchers.header(\"foo\", notNullValue()).match(this.request);\r\n\tMockRestRequestMatchers.header(\"foo\", is(anything())).match(this.request);\r\n\tMockRestRequestMatchers.header(\"foo\", allOf(notNullValue(), notNullValue())).match(this.request);\r\n\r\n\t//these are not as ambiguous thanks to an inner matcher that is either obviously list-oriented,\r\n\t//string-oriented or obviously a vararg of matchers\r\n\t//list matcher version\r\n\tMockRestRequestMatchers.header(\"foo\", allOf(notNullValue(), hasSize(2))).match(this.request);\r\n\t//vararg version\r\n\tMockRestRequestMatchers.header(\"foo\", allOf(notNullValue(), endsWith(\"ar\"))).match(this.request);\r\n\tMockRestRequestMatchers.header(\"foo\", is((any(String.class)))).match(this.request);\r\n\tMockRestRequestMatchers.header(\"foo\", CoreMatchers.either(is(\"bar\")).or(is(nullValue()))).match(this.request);\r\n\tMockRestRequestMatchers.header(\"foo\", is(notNullValue()), is(notNullValue()));\r\n}\r\n```\r\n\r\n</details>", "createdAt": "2023-02-08T18:10:28Z", "updatedAt": "2023-02-08T18:13:23Z"}]}}]}}
{"id": "PR_kwDOABGHUc5GoWjs", "title": "Polish #29727: Mention Kotlin andExpectAll in reference manual", "body": "This just adds a Kotlin snippet alongside the Java snippet in the\nreference manual.\n\nRelates to gh-29727\nCloses gh-27317\n", "number": 29766, "url": "https://github.com/spring-projects/spring-framework/pull/29766", "author": {"login": "simonbasle"}, "createdAt": "2023-01-04T14:19:55Z", "mergedAt": "2023-01-04T18:11:54Z", "mergedBy": {"login": "simonbasle"}, "baseRefOid": "74f58198fd689408973363d00a730b5c2bf4ed14", "baseRefName": "main", "headRefOid": "0b9aef3084ae1491159462a9b53e4e8ee9ca8527", "headRefName": "expectAllDslInRefguide", "changedFiles": 1, "labels": {"totalCount": 3, "pageInfo": {"hasNextPage": false, "endCursor": "Mw"}, "nodes": [{"name": "in: test"}, {"name": "type: documentation"}, {"name": "theme: kotlin"}]}, "commits": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"commit": {"oid": "0b9aef3084ae1491159462a9b53e4e8ee9ca8527", "message": "Polish #29727: Mention Kotlin andExpectAll in reference manual\n\nThis just adds a Kotlin snippet alongside the Java snippet in the\nreference manual.\n\nRelates to gh-29727\nCloses gh-27317", "changedFilesIfAvailable": 1, "authoredDate": "2023-01-04T13:50:28Z", "author": {"user": {"login": "simonbasle"}}, "committedDate": "2023-01-04T13:50:28Z", "committer": {"user": {"login": "simonbasle"}}, "parents": {"nodes": [{"oid": "74f58198fd689408973363d00a730b5c2bf4ed14"}]}}}]}, "reviews": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpO5MjAyMy0wMS0wNVQwMDoxMTozNSswODowMLkyMDIzLTAxLTA1VDAwOjExOjM1KzA4OjAwzkmt2e4="}, "nodes": [{"id": "PRR_kwDOABGHUc5Jrdnu", "author": {"login": "sdeleuze"}, "state": "APPROVED", "body": "", "submittedAt": "2023-01-04T16:11:35Z", "updatedAt": "2023-01-04T16:11:35Z", "commit": {"oid": "0b9aef3084ae1491159462a9b53e4e8ee9ca8527"}, "comments": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}}]}, "reviewThreads": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "closingIssuesReferences": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"id": "MDU6SXNzdWU5NzcwNzcyNTQ=", "number": 27317, "url": "https://github.com/spring-projects/spring-framework/issues/27317", "title": "Introduce Kotlin DSL for `ResultActions.andExpectAll()`", "body": "## Overview\r\n\r\nCommit dd9b99e13d6b30462fb168799e6bbca1456123da introduced `ResultActions.andExpectAll()` to support _soft assertions_ in `MockMvc`.\r\n\r\n`ResultActionsDsl.kt` already has support for `andExpect()`.\r\n\r\n\r\n## Related Issues\r\n\r\n- #27318\r\n\r\n## Deliverables\r\n\r\n- [x] Introduce Kotlin support for `ResultActions.andExpectAll()` in `ResultActionsDsl.kt`. => #29727 \r\n- [x] Add a Kotlin example using `andExpectAll()` in the reference manual alongside the Java example introduced in dd9b99e13d6b30462fb168799e6bbca1456123da. => #29766 ", "state": "CLOSED", "labels": {"totalCount": 5, "pageInfo": {"hasNextPage": false, "endCursor": "NQ"}, "nodes": [{"name": "in: test"}, {"name": "in: web"}, {"name": "type: enhancement"}, {"name": "status: superseded"}, {"name": "theme: kotlin"}]}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpHOU44UFw=="}, "nodes": [{"id": "IC_kwDOABGHUc5TjhQX", "author": {"login": "sbrannen"}, "body": "- Superseded by #29727", "createdAt": "2023-01-24T11:58:26Z", "updatedAt": "2023-01-24T11:58:26Z"}]}}]}}
{"id": "PR_kwDOABGHUc5F-K4E", "title": "Add Kotlin DSL support for MockMVC andExpectAll", "body": "As the DSL internally calls `ResultActions.andExpect`, this is done with a trick where a synthetic `ResultActions` is provided at top level which stores each `ResultMatcher` in a mutable list. Once the DSL usage is done, the top level DSL `andExpectAll` turns that list into a `vararg` passed down to the actual `actions.andExpectAll`.\r\n\r\nCloses gh-27317\r\n", "number": 29727, "url": "https://github.com/spring-projects/spring-framework/pull/29727", "author": {"login": "simonbasle"}, "createdAt": "2022-12-21T16:12:03Z", "mergedAt": "2023-01-03T17:26:26Z", "mergedBy": {"login": "simonbasle"}, "baseRefOid": "697292ba0ca5aa69454e7a184197be90c75de3ab", "baseRefName": "main", "headRefOid": "16bbf3ed40891259aaa4cde17da700027bb481bc", "headRefName": "27317-kotlinAndExpectAll", "changedFiles": 3, "labels": {"totalCount": 3, "pageInfo": {"hasNextPage": false, "endCursor": "Mw"}, "nodes": [{"name": "in: test"}, {"name": "type: enhancement"}, {"name": "theme: kotlin"}]}, "commits": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"commit": {"oid": "4fc268959235c12426202938f479ba079a3a3e9b", "message": "Add Kotlin DSL support for MockMVC andExpectAll\n\nAs the DSL internally calls ResultActions.andExpect, this is done with\na trick where a synthetic ResultActions is provided at top level which\nstores each ResultMatcher in a mutable list. Once the DSL usage is done,\n the top level DSL andExpectAll turns that list into a vararg passed\n down to the actual `actions.andExpectAll`.\n\nFixes gh-27317.", "changedFilesIfAvailable": 3, "authoredDate": "2022-12-21T16:07:59Z", "author": {"user": {"login": "simonbasle"}}, "committedDate": "2022-12-21T16:07:59Z", "committer": {"user": {"login": "simonbasle"}}, "parents": {"nodes": [{"oid": "697292ba0ca5aa69454e7a184197be90c75de3ab"}]}}}, {"commit": {"oid": "16bbf3ed40891259aaa4cde17da700027bb481bc", "message": "review: add since, add matchAll test", "changedFilesIfAvailable": 3, "authoredDate": "2023-01-03T16:17:59Z", "author": {"user": {"login": "simonbasle"}}, "committedDate": "2023-01-03T16:17:59Z", "committer": {"user": {"login": "simonbasle"}}, "parents": {"nodes": [{"oid": "4fc268959235c12426202938f479ba079a3a3e9b"}]}}}]}, "reviews": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpO5MjAyMy0wMS0wNFQwMDoxOTo1MiswODowMLkyMDIzLTAxLTA0VDAwOjE5OjUxKzA4OjAwzkmZZfs="}, "nodes": [{"id": "PRR_kwDOABGHUc5Jl8Tx", "author": {"login": "sdeleuze"}, "state": "APPROVED", "body": "Looks a fine way to solve this non trivial issue, please just check the few comments I added.", "submittedAt": "2023-01-03T15:07:44Z", "updatedAt": "2023-01-03T15:07:44Z", "commit": {"oid": "4fc268959235c12426202938f479ba079a3a3e9b"}, "comments": {"totalCount": 4, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMy0wMS0wM1QxNTowNjoxNVrOPziWoA=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4_OJAG", "author": {"login": "sdeleuze"}, "body": "Maybe add a related usage in tests?", "createdAt": "2023-01-03T15:04:19Z", "updatedAt": "2023-01-03T15:07:44Z", "path": "spring-test/src/main/kotlin/org/springframework/test/web/servlet/MockMvcResultMatchersDsl.kt", "diffHunk": "@@ -145,4 +145,11 @@ class MockMvcResultMatchersDsl internal constructor (private val actions: Result\n \tfun match(matcher: ResultMatcher) {\n \t\tactions.andExpect(matcher)\n \t}\n+\n+\t/**\n+\t * @see ResultActions.andExpectAll\n+\t */\n+\tfun matchAll(vararg matchers: ResultMatcher) {", "line": 153, "startLine": null, "originalLine": 152, "originalStartLine": null, "replyTo": null, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "16bbf3ed40891259aaa4cde17da700027bb481bc"}, "originalCommit": {"oid": "4fc268959235c12426202938f479ba079a3a3e9b"}}, {"id": "PRRC_kwDOABGHUc4_OJK5", "author": {"login": "sdeleuze"}, "body": "Clever trick, seems to provide a desired behavior, so good catch!", "createdAt": "2023-01-03T15:05:05Z", "updatedAt": "2023-01-03T15:07:44Z", "path": "spring-test/src/main/kotlin/org/springframework/test/web/servlet/ResultActionsDsl.kt", "diffHunk": "@@ -19,6 +19,34 @@ class ResultActionsDsl internal constructor (private val actions: ResultActions,\n \t\treturn this\n \t}\n \n+\n+\t/**\n+\t * Provide access to [MockMvcResultMatchersDsl] Kotlin DSL.\n+\t * @see MockMvcResultMatchersDsl.matchAll\n+\t */\n+\tfun andExpectAll(dsl: MockMvcResultMatchersDsl.() -> Unit): ResultActionsDsl {", "line": 28, "startLine": null, "originalLine": 27, "originalStartLine": null, "replyTo": null, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "16bbf3ed40891259aaa4cde17da700027bb481bc"}, "originalCommit": {"oid": "4fc268959235c12426202938f479ba079a3a3e9b"}}, {"id": "PRRC_kwDOABGHUc4_OJY-", "author": {"login": "sdeleuze"}, "body": "Maybe add `@since 6.0.4`?", "createdAt": "2023-01-03T15:06:06Z", "updatedAt": "2023-01-03T15:07:44Z", "path": "spring-test/src/main/kotlin/org/springframework/test/web/servlet/MockMvcResultMatchersDsl.kt", "diffHunk": "@@ -145,4 +145,11 @@ class MockMvcResultMatchersDsl internal constructor (private val actions: Result\n \tfun match(matcher: ResultMatcher) {\n \t\tactions.andExpect(matcher)\n \t}\n+\n+\t/**\n+\t * @see ResultActions.andExpectAll", "line": 151, "startLine": null, "originalLine": 150, "originalStartLine": null, "replyTo": null, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "16bbf3ed40891259aaa4cde17da700027bb481bc"}, "originalCommit": {"oid": "4fc268959235c12426202938f479ba079a3a3e9b"}}, {"id": "PRRC_kwDOABGHUc4_OJag", "author": {"login": "sdeleuze"}, "body": "Maybe add `@since 6.0.4`?", "createdAt": "2023-01-03T15:06:15Z", "updatedAt": "2023-01-03T15:07:44Z", "path": "spring-test/src/main/kotlin/org/springframework/test/web/servlet/ResultActionsDsl.kt", "diffHunk": "@@ -19,6 +19,34 @@ class ResultActionsDsl internal constructor (private val actions: ResultActions,\n \t\treturn this\n \t}\n \n+\n+\t/**\n+\t * Provide access to [MockMvcResultMatchersDsl] Kotlin DSL.\n+\t * @see MockMvcResultMatchersDsl.matchAll", "line": 26, "startLine": null, "originalLine": 25, "originalStartLine": null, "replyTo": null, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "16bbf3ed40891259aaa4cde17da700027bb481bc"}, "originalCommit": {"oid": "4fc268959235c12426202938f479ba079a3a3e9b"}}]}}, {"id": "PRR_kwDOABGHUc5JmWX7", "author": {"login": "simonbasle"}, "state": "COMMENTED", "body": "", "submittedAt": "2023-01-03T16:19:52Z", "updatedAt": "2023-01-03T16:19:52Z", "commit": {"oid": "4fc268959235c12426202938f479ba079a3a3e9b"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMy0wMS0wM1QxNjoxOTo1MVrOPzmkYQ=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4_OaRh", "author": {"login": "simonbasle"}, "body": "done", "createdAt": "2023-01-03T16:19:51Z", "updatedAt": "2023-01-03T16:19:52Z", "path": "spring-test/src/main/kotlin/org/springframework/test/web/servlet/MockMvcResultMatchersDsl.kt", "diffHunk": "@@ -145,4 +145,11 @@ class MockMvcResultMatchersDsl internal constructor (private val actions: Result\n \tfun match(matcher: ResultMatcher) {\n \t\tactions.andExpect(matcher)\n \t}\n+\n+\t/**\n+\t * @see ResultActions.andExpectAll\n+\t */\n+\tfun matchAll(vararg matchers: ResultMatcher) {", "line": 153, "startLine": null, "originalLine": 152, "originalStartLine": null, "replyTo": {"id": "PRRC_kwDOABGHUc4_OJAG"}, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "16bbf3ed40891259aaa4cde17da700027bb481bc"}, "originalCommit": {"oid": "4fc268959235c12426202938f479ba079a3a3e9b"}}]}}]}, "reviewThreads": {"totalCount": 4, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMy0wMS0wM1QxNTowNjoxNVrOKHdk0g=="}, "nodes": [{"id": "PRRT_kwDOABGHUc4od2CR", "isResolved": true, "isOutdated": false, "isCollapsed": true, "path": "spring-test/src/main/kotlin/org/springframework/test/web/servlet/MockMvcResultMatchersDsl.kt", "startLine": 153, "originalLine": 152, "diffSide": "RIGHT", "startDiffSide": null, "resolvedBy": {"login": "simonbasle"}, "comments": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMy0wMS0wM1QxNjoxOTo1MVrOPzmkYQ=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4_OJAG"}, {"id": "PRRC_kwDOABGHUc4_OaRh"}]}}, {"id": "PRRT_kwDOABGHUc4od2JE", "isResolved": true, "isOutdated": false, "isCollapsed": true, "path": "spring-test/src/main/kotlin/org/springframework/test/web/servlet/ResultActionsDsl.kt", "startLine": 28, "originalLine": 27, "diffSide": "RIGHT", "startDiffSide": null, "resolvedBy": {"login": "simonbasle"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMy0wMS0wM1QxNTowNTowNVrOPziSuQ=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4_OJK5"}]}}, {"id": "PRRT_kwDOABGHUc4od2SP", "isResolved": true, "isOutdated": false, "isCollapsed": true, "path": "spring-test/src/main/kotlin/org/springframework/test/web/servlet/MockMvcResultMatchersDsl.kt", "startLine": 151, "originalLine": 150, "diffSide": "RIGHT", "startDiffSide": null, "resolvedBy": {"login": "simonbasle"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMy0wMS0wM1QxNTowNjowNlrOPziWPg=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4_OJY-"}]}}, {"id": "PRRT_kwDOABGHUc4od2TS", "isResolved": true, "isOutdated": false, "isCollapsed": true, "path": "spring-test/src/main/kotlin/org/springframework/test/web/servlet/ResultActionsDsl.kt", "startLine": 26, "originalLine": 25, "diffSide": "RIGHT", "startDiffSide": null, "resolvedBy": {"login": "simonbasle"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMy0wMS0wM1QxNTowNjoxNVrOPziWoA=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4_OJag"}]}}]}, "closingIssuesReferences": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"id": "MDU6SXNzdWU5NzcwNzcyNTQ=", "number": 27317, "url": "https://github.com/spring-projects/spring-framework/issues/27317", "title": "Introduce Kotlin DSL for `ResultActions.andExpectAll()`", "body": "## Overview\r\n\r\nCommit dd9b99e13d6b30462fb168799e6bbca1456123da introduced `ResultActions.andExpectAll()` to support _soft assertions_ in `MockMvc`.\r\n\r\n`ResultActionsDsl.kt` already has support for `andExpect()`.\r\n\r\n\r\n## Related Issues\r\n\r\n- #27318\r\n\r\n## Deliverables\r\n\r\n- [x] Introduce Kotlin support for `ResultActions.andExpectAll()` in `ResultActionsDsl.kt`. => #29727 \r\n- [x] Add a Kotlin example using `andExpectAll()` in the reference manual alongside the Java example introduced in dd9b99e13d6b30462fb168799e6bbca1456123da. => #29766 ", "state": "CLOSED", "labels": {"totalCount": 5, "pageInfo": {"hasNextPage": false, "endCursor": "NQ"}, "nodes": [{"name": "in: test"}, {"name": "in: web"}, {"name": "type: enhancement"}, {"name": "status: superseded"}, {"name": "theme: kotlin"}]}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpHOU44UFw=="}, "nodes": [{"id": "IC_kwDOABGHUc5TjhQX", "author": {"login": "sbrannen"}, "body": "- Superseded by #29727", "createdAt": "2023-01-24T11:58:26Z", "updatedAt": "2023-01-24T11:58:26Z"}]}}]}}
{"id": "PR_kwDOABGHUc5Dh0s_", "title": "Restrict forwards in MockMvcWebConnection to 100", "body": "When a filter is configured to conditionally forward, and it is configured to handle FORWARD dispatches as well, and it prevents infinite forward loops by either extending OncePerRequestFilter or otherwise using request attributes, this can result in infinite forward loops in WebClient tests using MockMvcWebConnection. This change will restrict the maximum number of forwards in MockMvcWebConnection to 100.\r\n\r\nCloses gh-29483", "number": 29557, "url": "https://github.com/spring-projects/spring-framework/pull/29557", "author": {"login": "manthanb"}, "createdAt": "2022-11-23T06:38:01Z", "mergedAt": "2023-02-07T15:23:56Z", "mergedBy": {"login": "simonbasle"}, "baseRefOid": "ed5ab77397e773cfce3b17d00ceb8e84b0581aab", "baseRefName": "main", "headRefOid": "56b5ec243063a2cc8acb8ba797b8058b422edab5", "headRefName": "main", "changedFiles": 3, "labels": {"totalCount": 4, "pageInfo": {"hasNextPage": false, "endCursor": "NA"}, "nodes": [{"name": "in: test"}, {"name": "status: backported"}, {"name": "in: web"}, {"name": "type: enhancement"}]}, "commits": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"commit": {"oid": "19d5c7f44a58c414614ecbae38728aaca02e159f", "message": "Restrict forwards in MockMvcWebConnection to 100\n\nWhen a filter is configured to conditionally forward, and it is\nconfigured to handle FORWARD dispatches as well, and it prevents\ninfinite forward loops by either extending OncePerRequestFilter or\notherwise using request attributes, this can result in infinite\nforward loops in WebClient tests using MockMvcWebConnection. This\nchange will restrict the maximum number of forwards in\nMockMvcWebConnection to 100.\n\nCloses gh-29483", "changedFilesIfAvailable": 3, "authoredDate": "2022-11-23T06:28:08Z", "author": {"user": null}, "committedDate": "2022-11-23T06:35:41Z", "committer": {"user": null}, "parents": {"nodes": [{"oid": "ed5ab77397e773cfce3b17d00ceb8e84b0581aab"}]}}}, {"commit": {"oid": "56b5ec243063a2cc8acb8ba797b8058b422edab5", "message": "Polish contribution: throw exception rather than fallback", "changedFilesIfAvailable": 2, "authoredDate": "2023-02-07T14:55:31Z", "author": {"user": {"login": "simonbasle"}}, "committedDate": "2023-02-07T14:55:31Z", "committer": {"user": {"login": "simonbasle"}}, "parents": {"nodes": [{"oid": "19d5c7f44a58c414614ecbae38728aaca02e159f"}]}}}]}, "reviews": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpO5MjAyMy0wMi0wN1QyMzoxOTo0NyswODowMLkyMDIzLTAyLTA3VDIzOjE5OjQ3KzA4OjAwzky69PE="}, "nodes": [{"id": "PRR_kwDOABGHUc5LWYG-", "author": {"login": "simonbasle"}, "state": "CHANGES_REQUESTED", "body": "@manthanb thanks for the contribution. I think that throwing an exception as proposed in the original issue would be better, wdyt? The message can mention that there is a probable infinite loop and that it forwarded 100 times.", "submittedAt": "2023-01-20T18:40:12Z", "updatedAt": "2023-01-20T18:40:13Z", "commit": {"oid": "19d5c7f44a58c414614ecbae38728aaca02e159f"}, "comments": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}}, {"id": "PRR_kwDOABGHUc5MuvTx", "author": {"login": "simonbasle"}, "state": "APPROVED", "body": "I went ahead and made the adjustments to throw rather than ignore", "submittedAt": "2023-02-07T15:19:47Z", "updatedAt": "2023-02-07T15:19:47Z", "commit": {"oid": "56b5ec243063a2cc8acb8ba797b8058b422edab5"}, "comments": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}}]}, "reviewThreads": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "closingIssuesReferences": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"id": "I_kwDOABGHUc5WViJl", "number": 29483, "url": "https://github.com/spring-projects/spring-framework/issues/29483", "title": "Possible infinite forward loop with MockMvcWebConnection", "body": "When a filter is configured to conditionally forward, and it is configured to handle FORWARD dispatches as well, and it prevents infinite forward loops by either extending `OncePerRequestFilter` or otherwise using request attributes, this can result in infinite forward loops in `WebClient` tests using `MockMvcWebConnection`. Because in this case request attributes are not propagated from the original request to the forwards.\r\n\r\nExample `RequireSettingFilter`:\r\n```java\r\n@Component\r\npublic class RequireSettingFilter extends OncePerRequestFilter {\r\n\r\n\t@Override\r\n\tprotected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException {\r\n\t\tif (System.getProperty(\"mysetting\") == null) {\r\n\t\t\trequest.getRequestDispatcher(\"/error/missingsetting\").forward(request, response);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfilterChain.doFilter(request, response);\r\n\t}\r\n}\r\n```\r\n\r\n`RedirectTest`:\r\n```java\r\n@WebMvcTest\r\npublic class RedirectTest {\r\n\t@Autowired\r\n\tWebClient webClient;\r\n\r\n\t@Test\r\n\tvoid testForwardToError() throws FailingHttpStatusCodeException, MalformedURLException, IOException {\r\n\t\tHtmlPage page = webClient.getPage(\"/demo.html\");\r\n\t\tassertEquals(\"A demo\", page.asNormalizedText());\r\n\t}\r\n}\r\n```\r\n\r\nSuggested fix: In `org.springframework.test.web.servlet.htmlunit.MockMvcWebConnection.getResponse(WebRequest)` forwards are handled. Limit this to e.g. 100 forwards and afterwards throw an exception that the page is not forwarding properly. Infinite loops are very bad, because they can make the build system hang.\r\n\r\nNote that just copying request attributes from the original request to the new one wouldn't help for the case of `OncePerRequestFilter`, because it clears the attributes when exiting `doFilterInternal(...)`.\r\n\r\n**Affects:** 5.3.23\r\n", "state": "CLOSED", "labels": {"totalCount": 4, "pageInfo": {"hasNextPage": false, "endCursor": "NA"}, "nodes": [{"name": "in: test"}, {"name": "status: backported"}, {"name": "in: web"}, {"name": "type: enhancement"}]}, "comments": {"totalCount": 3, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpHOVCSlMw=="}, "nodes": [{"id": "IC_kwDOABGHUc5TX8Z3", "author": {"login": "simonbasle"}, "body": "Once the forward happens, if the filter also apply to the forward destination it is applied on a distinct request. I'm not entirely sure if this is specific to MockMvc's `MockRequestDispatchHandler` or if it is true of more `RequestDispatcher`s \ud83e\udd14\r\n\r\nUnlike other MockMVC parts, `MockMvcWebConnection` is really trying to get to some HTML for the benefit of `HtmlUnit` and as such does follow these forwards.\r\nSo it can end up in an infinite loop if the forwarding filter applies to both original request and forwarded request. I agree that being defensive there is an enhancement.\r\n\r\nPerhaps there is more area of improvement (`MockRequestDispatcherHandler` not setting the `DispatcherType` to `FORWARD` for instance) , but this is a good first step.", "createdAt": "2023-01-20T18:36:59Z", "updatedAt": "2023-01-20T18:36:59Z"}, {"id": "IC_kwDOABGHUc5Tcuag", "author": {"login": "svschouw-bb"}, "body": "Setting the dispatch type to `FORWARD` might help, but I think you would need to handle all the [forward attributes](https://javaee.github.io/servlet-spec/downloads/servlet-3.1/Final/servlet-3_1-final.pdf#G13.999505) then as well. If you would really like to do it correctly you'd need a `RequestDispatcher` that actually handles the forward instead of setting a `forwardedUrl` parameter. But I think this is where the `MockMvc` case really differs from the `MockMvcWebConnection`. With `MockMvc` you want to do a single request and see that it did a forward. With `MockMvcWebConnection` you want to see the entire result of the request.\r\n\r\nBut in my opinion this ticket is mostly just about avoiding the infinite loop. If you really want to do some advanced integration testing, it's probably better to use Spring Boot's `@SpringBootTest(webEnvironment=RANDOM_PORT)` or something.", "createdAt": "2023-01-23T09:32:48Z", "updatedAt": "2023-01-23T09:32:48Z"}, {"id": "IC_kwDOABGHUc5UJKUz", "author": {"login": "simonbasle"}, "body": "Superseded by gh-29557", "createdAt": "2023-02-01T08:56:27Z", "updatedAt": "2023-02-01T08:56:27Z"}]}}]}}
{"id": "PR_kwDOABGHUc4-qR6t", "title": "Protect JMS connection creation against prepareConnection errors", "body": "The creation of new JMS connection (after reset) is done in local method field (instead of instance field directly) to prevent situation, when connection is not correctly configured/prepared in case when JMSException from prepare() method is thrown.\r\n\r\nSee gh-29115", "number": 29116, "url": "https://github.com/spring-projects/spring-framework/pull/29116", "author": {"login": "lenoch7"}, "createdAt": "2022-09-09T08:28:40Z", "mergedAt": "2023-02-28T15:10:06Z", "mergedBy": {"login": "simonbasle"}, "baseRefOid": "858394b72055018e315599f4292201f9a70c7ec4", "baseRefName": "main", "headRefOid": "991b51e0abdd140786a1e6fcf71f4e6b8af71dbc", "headRefName": "SingleConnectionFactory-Reconnection", "changedFiles": 2, "labels": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"name": "in: messaging"}, {"name": "type: bug"}]}, "commits": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"commit": {"oid": "76f31e8fe3109f726f934d04612cff83c2af252a", "message": "Fix creation of new JMS connection\n\nThe creation of new JMS connection (after reset) is done in local\nmethod field (instead of instance field directly) to prevent\nsituation, when connection is not correctly configured/prepared in\ncase when JMSException from prepare() method is thrown.\n\nSee gh-29115", "changedFilesIfAvailable": 2, "authoredDate": "2022-09-09T08:13:35Z", "author": {"user": {"login": "lenoch7"}}, "committedDate": "2022-12-16T07:51:09Z", "committer": {"user": {"login": "lenoch7"}}, "parents": {"nodes": [{"oid": "858394b72055018e315599f4292201f9a70c7ec4"}]}}}, {"commit": {"oid": "991b51e0abdd140786a1e6fcf71f4e6b8af71dbc", "message": "Polish log level and message", "changedFilesIfAvailable": 1, "authoredDate": "2023-02-28T15:05:09Z", "author": {"user": {"login": "simonbasle"}}, "committedDate": "2023-02-28T15:05:09Z", "committer": {"user": {"login": "simonbasle"}}, "parents": {"nodes": [{"oid": "76f31e8fe3109f726f934d04612cff83c2af252a"}]}}}]}, "reviews": {"totalCount": 3, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpO5MjAyMy0wMi0yOFQyMjoyMDowMSswODowMLkyMDIzLTAyLTI4VDIyOjIwOjAxKzA4OjAwzk6K3x4="}, "nodes": [{"id": "PRR_kwDOABGHUc5DNKGp", "author": {"login": "valituguran"}, "state": "COMMENTED", "body": "Looks good. ", "submittedAt": "2022-10-01T12:15:25Z", "updatedAt": "2022-10-01T12:15:25Z", "commit": null, "comments": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}}, {"id": "PRR_kwDOABGHUc5Ml6wk", "author": {"login": "simonbasle"}, "state": "COMMENTED", "body": "LGTM @jhoeller what do you think?", "submittedAt": "2023-02-06T11:22:42Z", "updatedAt": "2023-02-28T14:19:12Z", "commit": {"oid": "76f31e8fe3109f726f934d04612cff83c2af252a"}, "comments": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}}, {"id": "PRR_kwDOABGHUc5Oit8e", "author": {"login": "simonbasle"}, "state": "APPROVED", "body": "", "submittedAt": "2023-02-28T14:20:01Z", "updatedAt": "2023-02-28T14:20:01Z", "commit": {"oid": "76f31e8fe3109f726f934d04612cff83c2af252a"}, "comments": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}}]}, "reviewThreads": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "closingIssuesReferences": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"id": "I_kwDOABGHUc5Rgb4o", "number": 29115, "url": "https://github.com/spring-projects/spring-framework/issues/29115", "title": "SingleConnectionFactory - reconnection problem (AMQ Broker)", "body": "I have a problem with reconnection when `SingleConnectionFactory` (`CachingConnectionFactory`) is used.\r\nI think it is a similar (or same?) problem reported in #23058 issue.\r\n\r\nFrom all sources, which I have (logs, heap dump ...), it seems that problem is caused due **missing Exception Listener\r\non connection (`ActiveMQConnection`), which is stored on `SingleConnectionFactory`**.\r\n\r\nI have following environment:\r\n- Apache ActiveMQ Broker 5.16.2\r\n- `failover:(tcp://localhost:61616)?maxReconnectAttempts=5`\r\n- `SingleConnectionFactory` (`CachingConnectionFactory`)\r\n - `setReconnectOnException(true)`\r\n\r\n###### Logs\r\n- it is visible that \"resetting the underlying JMS Connection\" on `CachingConnectionFactory` is invoked\r\n- but suddenly these logs are no longer present and only logs from `DefaultMessageListenerContainer` are present\r\n  -  I know that it is not recommended to use DMLC with `CachingConnectionFactory`, but please stay with me for a moment (because I think the problem is in `SingleConnectionFactory`)\r\n\r\n```\r\n2022-09-06T05:16:06.024+00:00 {ActiveMQ Connection Executor: unconnected} [CachingConnectionFactory] [INFO] Encountered a JMSException - resetting the underlying JMS Connection\r\n...\r\n2022-09-06T05:18:37.210+00:00 {ActiveMQ Connection Executor: unconnected} [CachingConnectionFactory] [INFO] Encountered a JMSException - resetting the underlying JMS Connection\r\n...\r\n2022-09-06T05:21:08.254+00:00 {ActiveMQ Connection Executor: unconnected} [CachingConnectionFactory] [INFO] Encountered a JMSException - resetting the underlying JMS Connection\r\n...\r\n2022-09-06T05:23:39.319+00:00 {ActiveMQ Connection Executor: unconnected} [CachingConnectionFactory] [INFO] Encountered a JMSException - resetting the underlying JMS Connection\r\n...\r\n2022-09-06T05:26:15.367+00:00 {ActiveMQ Connection Executor: unconnected} [CachingConnectionFactory] [INFO] Encountered a JMSException - resetting the underlying JMS Connection\r\n...\r\n2022-09-06T05:26:25.498+00:00 {taskExecutor-151} [DefaultMessageListenerContainer] [ERROR] Could not refresh JMS Connection for destination '...' - retrying using FixedBackOff{interval=5000, currentAttempts=1, maxAttempts=unlimited}. Cause: The JMS connection has failed: ...cluster.local\r\n2022-09-06T05:26:30.499+00:00 {taskExecutor-151} [DefaultMessageListenerContainer] [ERROR] Could not refresh JMS Connection for destination '...' - retrying using FixedBackOff{interval=5000, currentAttempts=2, maxAttempts=unlimited}. Cause: The JMS \r\n...\r\n2022-09-06T05:46:30.559+00:00 {taskExecutor-142} [DefaultMessageListenerContainer] [ERROR] Could not refresh JMS Connection for destination '...' - retrying using FixedBackOff{interval=5000, currentAttempts=242, maxAttempts=unlimited}. Cause: The JMS connection has failed: ...cluster.local\r\n2022-09-06T05:46:35.559+00:00 {taskExecutor-151} [DefaultMessageListenerContainer] [ERROR] Could not refresh JMS Connection for destination '...' - retrying using FixedBackOff{interval=5000, currentAttempts=243, maxAttempts=unlimited}. Cause: The JMS connection has failed: ...cluster.local\r\n...\r\n```\r\n###### HeapDump\r\n- I see only one `CachingConnectionFactory`\r\n  - I see `SingleConnectionFactory$AggregatedExceptionListener` in `aggregatedExceptionListener`\r\n  - I see `ActiveMQConnection` under `connection` field\r\n    - I see that `exceptionListener` (on `ActiveMQConnection`) is `null` (ExceptionListener is missing - but this exception listener must be present to invoke reset of underlying JMS Connection stored on `SingleConnectionFactory`)\r\n    - I see that `transportFailed` (on `ActiveMQConnection`) is `true` (it is a probably a reason why ExceptionListener is missing, see bellow)\r\n    - I see that `firstFailureError` (on `ActiveMQConnection`) is `java.net.UnknownHostException` (but type of the failure is not too important)\r\n\r\n###### Debugger\r\n- I am able to simulate the problem in debugger\r\n- It is enough to \"delay\" thread, which invokes `SingleConnectionFactory.initConnection()`\r\n  - after new connection is created\r\n   - but before connection is prepared, where exception listener is established\r\n\r\n###### Code (`SingleConnectionFactory.initConnection()`)\r\n```\r\npublic void initConnection() throws JMSException {\r\n\tif (getTargetConnectionFactory() == null) {\r\n\t\tthrow new IllegalStateException(\r\n\t\t\t\t\"'targetConnectionFactory' is required for lazily initializing a Connection\");\r\n\t}\r\n\tsynchronized (this.connectionMonitor) {\r\n\t\tif (this.connection != null) {\r\n\t\t\tcloseConnection(this.connection);\r\n\t\t}\r\n\t\tthis.connection = doCreateConnection();\r\n\t\tprepareConnection(this.connection);\r\n\t\tif (this.startedCount > 0) {\r\n\t\t\tthis.connection.start();\r\n\t\t}\r\n\t\tif (logger.isDebugEnabled()) {\r\n\t\t\tlogger.debug(\"Established shared JMS Connection: \" + this.connection);\r\n\t\t}\r\n\t}\r\n}\r\n```\r\n\r\n##### Why ExceptionListener on JMS Connection stored on `SingleConnectionFactory` is missing?\r\n- please suppose following situation\r\n - the new connection is created successfully (`this.connection = doCreateConnection();`)\r\n - but some of subsequent methods (in my case `prepareConnection(this.connection)`) throws `JMSException`\r\n - we get new connection (stored on `SingleConnectionFactory`), but without JMS Exception Listener\r\n - this finally caused, that `SingleConnectionFactory.resetConnection()` is never invoked and \"invalid\" connection stays stored on `SingleConnectionFactory` (till restart or \"manual\" invocation of `SingleConnectionFactory.resetConnection()`)\r\n\r\nI know it is (nearly) impossible to get this situation, because setup of exception listener (in `prepareConnection(Connection)`) should be (nearly) always done before invocation of `ActiveMQConnection.onException(IOException)` method, which sets `transportFailed` and `firstFailureError`, which finally caused that `ActiveMQConnection.setExceptionListener(ExceptionListener)` (invoked in `prepareConnection(this.connection)`) throws `ConnectionFailedException`, but I see this state in application heap dump (I am sorry).\r\n\r\nMy proposal is to change `SingleConnectionFactory.initConnection()` in a way, when new connection is created and configured/prepared in method local field and when all is ok, then assign it to instance connection field. Something like this:\r\n```\r\npublic void initConnection() throws JMSException {\r\n\t...\r\n\tsynchronized (this.connectionMonitor) {\r\n\t\tif (this.connection != null) {\r\n\t\t\tcloseConnection(this.connection);\r\n\t\t}\r\n\t\tConnection con = doCreateConnection();\r\n\t\ttry {\r\n\t\t\tprepareConnection(con);\r\n\t\t\tthis.connection = con;\r\n\t\t}\r\n\t\tcatch (JMSException ex) {\r\n\t\t\ttry {\r\n\t\t\t\t con.close();\r\n\t\t\t}\r\n\t\t\tcatch(Throwable th) {\r\n\t\t\t\tlogger.warn(\"Could not close new (but not used as shared) JMS Connection\", th);\r\n\t\t\t}\r\n\t\t\tthrow ex;\r\n\t\t}\r\n\t\tif (this.startedCount > 0) {\r\n\t\t\tthis.connection.start();\r\n\t\t}\r\n\t\t...\r\n\t}\r\n}\r\n```\r\n", "state": "CLOSED", "labels": {"totalCount": 3, "pageInfo": {"hasNextPage": false, "endCursor": "Mw"}, "nodes": [{"name": "in: messaging"}, {"name": "status: backported"}, {"name": "type: bug"}]}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpHOVlMHKg=="}, "nodes": [{"id": "IC_kwDOABGHUc5WUwcq", "author": {"login": "simonbasle"}, "body": "Superseded by gh-29116", "createdAt": "2023-02-28T14:29:03Z", "updatedAt": "2023-02-28T14:29:03Z"}]}}]}}
{"id": "PR_kwDOABGHUc41-xac", "title": "Avoid duplicate `ApplicationListener` firing (proxy vs. target)", "body": "In `AbstractApplicationEventMulticaster.retrieveApplicationListeners`, despite best efforts to avoid it, unwrapped proxies (singleton targets) can end up in the list of programmatically registered listeners. In order to avoid duplicates, we need to find and replace them by their proxy counterparts, because if both a proxy and its target end up in `allListeners`, listeners will fire twice.\r\n\r\nFixes #28283.", "number": 28322, "url": "https://github.com/spring-projects/spring-framework/pull/28322", "author": {"login": "kriegaex"}, "createdAt": "2022-04-11T07:53:12Z", "mergedAt": "2023-10-10T15:01:00Z", "mergedBy": {"login": "jhoeller"}, "baseRefOid": "efb6abc43f550c2be20f39ad9ce65346ee5ebd65", "baseRefName": "main", "headRefOid": "0dba415171294487b642c84084ef0207cc60988d", "headRefName": "issue-28283", "changedFiles": 7, "labels": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"name": "type: bug"}, {"name": "in: core"}]}, "commits": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"commit": {"oid": "5367d96e8dddb5365cb8b0443dace852f0489bed", "message": "Regression test for duplicate firing of proxied application listeners\n\nApplicationContextEventTests.eventForSelfInjectedProxiedListenerFiredOnlyOnce\nrelates to and reproduces #28283.", "changedFilesIfAvailable": 6, "authoredDate": "2023-07-19T01:45:45Z", "author": {"user": {"login": "kriegaex"}}, "committedDate": "2023-07-21T02:46:47Z", "committer": {"user": {"login": "kriegaex"}}, "parents": {"nodes": [{"oid": "0d8a8432d18af8d2a5fcb29f9de40e4cbf0f9016"}]}}}, {"commit": {"oid": "0dba415171294487b642c84084ef0207cc60988d", "message": "Avoid duplicate application listeners (proxy vs. proxy target)\n\nIn AbstractApplicationEventMulticaster.retrieveApplicationListeners,\ndespite best efforts to avoid it, unwrapped proxies (singleton targets)\ncan end up in the list of programmatically registered listeners. In\norder to avoid duplicates, we need to find and replace them by their\nproxy counterparts, because if both a proxy and its target end up in\n'allListeners', listeners will fire twice.\n\nFixes #28283.", "changedFilesIfAvailable": 1, "authoredDate": "2022-04-11T07:51:04Z", "author": {"user": {"login": "kriegaex"}}, "committedDate": "2023-07-21T02:46:47Z", "committer": {"user": {"login": "kriegaex"}}, "parents": {"nodes": [{"oid": "5367d96e8dddb5365cb8b0443dace852f0489bed"}]}}}]}, "reviews": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpO5MjAyMy0wOC0yM1QxNzoyMDozMiswODowMLkyMDIzLTA4LTIzVDE3OjIwOjMyKzA4OjAwzl7W-ZY="}, "nodes": [{"id": "PRR_kwDOABGHUc5atdkq", "author": {"login": "sbrannen"}, "state": "CHANGES_REQUESTED", "body": "Hi @kriegaex,\r\n\r\nApologies for the belated review. This one slipped through the cracks.\r\n\r\nCan you please introduce a test that fails before the change and passes afterwards?\r\n\r\nThanks", "submittedAt": "2023-07-10T11:29:24Z", "updatedAt": "2023-07-10T11:29:24Z", "commit": null, "comments": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}}, {"id": "PRR_kwDOABGHUc5e1vmW", "author": {"login": "sbrannen"}, "state": "APPROVED", "body": "Thanks for adding the failing test. That helps a lot!", "submittedAt": "2023-08-23T09:20:32Z", "updatedAt": "2023-08-23T09:20:32Z", "commit": {"oid": "0dba415171294487b642c84084ef0207cc60988d"}, "comments": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}}]}, "reviewThreads": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "closingIssuesReferences": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"id": "I_kwDOABGHUc5HDETI", "number": 28283, "url": "https://github.com/spring-projects/spring-framework/issues/28283", "title": "Using AOP and DI itself causes Spring ApplicationListener to be fired twice ", "body": "## Software versions\r\n\r\n- Spring Version  5.3.18 and earlier \r\n- JDK Version 1.8.0_202\r\n\r\n## Overview\r\n\r\nWhen I use Spring ApplicationListener, in order to prevent transaction invalidation, my ApplicationListener implementation class writes the following code (of course, the code can be written differently to avoid this problem), which will cause my listener to trigger twice after the event is published. I think it's not normal, but not sure if it's a bug, so I want to ask everyone's opinion.\r\n\r\n```java\r\n@Component\r\npublic class EventDemoListener implements ApplicationListener<EventDemo> {\r\n    @Autowired\r\n    DemoService1 demoService1;\r\n    @Autowired\r\n    DemoService2 demoService2;\r\n    @Autowired\r\n    EventDemoListener eventDemoListener;\r\n\r\n    @Override\r\n    public void onApplicationEvent(EventDemo event) {\r\n        eventDemoListener.testTransaction();\r\n        System.out.println(\"receiver \" + event.getMessage());\r\n    }\r\n\r\n    @Transactional(rollbackFor = Exception.class)\r\n    public void testTransaction() {\r\n        demoService1.doService();\r\n        demoService2.doService();\r\n    }\r\n}\r\n```\r\nThrough this demo project, this problem can be reproduced. Please read the README.md document before running.    \r\n[https://github.com/ZiFeng-Wu/spring-study](https://github.com/ZiFeng-Wu/spring-study)\r\n\r\n## Analysis\r\n\r\n1. After analysis, because here DI itself , When `EventDemoListener` is created, property filling will trigger `DefaultSingletonBeanRegistry#getSingleton(String, boolean)` in advance.\r\n\r\n2. Then `singletonFactory.getObject()` executed in `getSingleton()` will cause the unproxyed `EventDemoListener` object to be put into `AbstractAutoProxyCreator#earlyProxyReferences`.\r\n\r\n3. After the properties are filled, calling `AbstractAutowireCapableBeanFactory#initializeBean(String, Object, RootBeanDefinition)` and executing `ApplicationListenerDetector#postProcessAfterInitialization(Object, String)` will cause the unproxyed `EventDemoListener` object to be put into the `AbstractApplicationEventMulticaster.DefaultListenerRetriever#applicationListeners` container.\r\n\r\n    [![enter image description here][1]][1]\r\n\r\n4. Then when the event is published, execute `AbstractApplicationEventMulticaster.DefaultListenerRetriever#getApplicationListeners()`  and use `ApplicationListener<?> listener =beanFactory.getBean(listenerBeanName, ApplicationListener.class)` to obtain the listener is the proxied `EventDemoListener` object.\r\n\r\n5. At this time, there are only unproxyed `EventDemoListener` object in the `applicationListeners` container, so the proxied `EventDemoListener` object will be added to the final returned allListeners collection, as shown in the figure below, which will eventually cause the listener to be triggered twice.\r\n\r\n    [![enter image description here][2]][2]\r\n\r\n\r\n  [1]: https://i.stack.imgur.com/lz51c.png\r\n  [2]: https://i.stack.imgur.com/oZ8OA.png\r\n", "state": "CLOSED", "labels": {"totalCount": 3, "pageInfo": {"hasNextPage": false, "endCursor": "Mw"}, "nodes": [{"name": "type: bug"}, {"name": "in: core"}, {"name": "status: superseded"}]}, "comments": {"totalCount": 6, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpHOYRXB-A=="}, "nodes": [{"id": "IC_kwDOABGHUc5BPgnE", "author": {"login": "kriegaex"}, "body": "I looked into this issue too, because the [same question](https://stackoverflow.com/q/71775299/1082681) was asked on Stack Overflow. Only later I found it here, because I also just wanted to raise an issue for it.\r\n\r\nActually, this not only happens for this rather strange scenario using both self-injection and `@Transactional` from within the `ApplicationListener` implementation, but in other cases where listener is being proxied, too, for example if it is the target of a Spring AOP `@Aspect`. This is a fact, not pure speculation. I tried, and the result is the same.\r\n\r\nAs for the root cause: In `AbstractApplicationEventMulticaster.retrieveApplicationListeners`, there are two loops searching for listeners. The first one finds the original listener, the second one finds the bean, which yields a proxy instance.\r\n\r\nhttps://github.com/spring-projects/spring-framework/blob/c9e781676271a980d39063fc1f23a348b0d37be1/spring-context/src/main/java/org/springframework/context/event/AbstractApplicationEventMulticaster.java#L224-L232\r\n\r\nThis would be relatively easy to remedy,\r\n  * either by checking `allListeners` for duplicates after both loops have finished\r\n  * or by checking for existing non-proxy elements upon inserting in the loop checking registered beans.\r\n\r\nDuplicates in this context could be identified by  `AopProxyUtils.getSingletonTarget(listener)`.\r\n\r\nHow about this?\r\n\r\n```patch\r\n--- a/spring-context/src/main/java/org/springframework/context/event/AbstractApplicationEventMulticaster.java\t(revision Staged)\r\n+++ b/spring-context/src/main/java/org/springframework/context/event/AbstractApplicationEventMulticaster.java\t(date 1649655053343)\r\n@@ -260,8 +260,9 @@\r\n \t\t\tfor (String listenerBeanName : listenerBeans) {\r\n \t\t\t\ttry {\r\n \t\t\t\t\tif (supportsEvent(beanFactory, listenerBeanName, eventType)) {\r\n-\t\t\t\t\t\tApplicationListener<?> listener =\r\n-\t\t\t\t\t\t\t\tbeanFactory.getBean(listenerBeanName, ApplicationListener.class);\r\n+\t\t\t\t\t\tApplicationListener<?> listener = (ApplicationListener<?>) AopProxyUtils.getSingletonTarget(\r\n+\t\t\t\t\t\t\tbeanFactory.getBean(listenerBeanName, ApplicationListener.class)\r\n+\t\t\t\t\t\t);\r\n \t\t\t\t\t\tif (!allListeners.contains(listener) && supportsEvent(listener, eventType, sourceType)) {\r\n \t\t\t\t\t\t\tif (retriever != null) {\r\n \t\t\t\t\t\t\t\tif (beanFactory.isSingleton(listenerBeanName)) {\r\n```\r\n\r\nThis fixes the problem, at least in this context. It might cause problems elsewhere, please verify. If this is OK, would you like to have a PR? If so, for which branch? _5.3.x_ or _main_? Maybe I could create a PR for _main_ and a committer could back-port it to all relevant versions which still get updates.\r\n\r\nActually, in the same class there is some proxy unwrapping going on in another place already, seemingly in order to **avoid** getting unwrapped objects into the list of listeners, which is the opposite of what my patch does. Hmm...\r\n\r\nhttps://github.com/spring-projects/spring-framework/blob/c9e781676271a980d39063fc1f23a348b0d37be1/spring-context/src/main/java/org/springframework/context/event/AbstractApplicationEventMulticaster.java#L106-L111\r\n\r\n**Edit:** I just debugged into that code, and it is called indirectly via `AbstractBeanFactory.getBean(String)` and `AbstractAutowireCapableBeanFactory.createBean(String, RootBeanDefinition, Object[])`, as you can see here:\r\n\r\n![image](https://user-images.githubusercontent.com/1537384/162677617-ef2336be-16c1-4313-866e-fa8a6678c2ab.png)\r\n\r\nIf you look at the variables in the top stack frame, you see that in `AbstractApplicationEventMulticaster.addApplicationListener(ApplicationListener<?>)` the method parameter `listener` is an unwrapped bean, but at the same time the proxy exists already, as can be seen when inspecting the value of `listener.eventDemoListener` (the auto-wired self-reference). So along the way, somehow the proxy gets lost or is never retrieved. I.e., the logic in `addApplicationListener` cannot avoid the unwrapped listener to be added to the list, because what it sees is unwrapped already. I.e., my workaround in the patch above to also unwrap the bean is something that might cause duplicate calls in other situations when `addApplicationListener` really does get called with a proxy instance. Then it would not unwrap it, but in the beans list we would have an unwrapped object due to my patch. \r\n\r\nIn which way ever this problem is going to be solved, it would be important to either never or always unwrap proxies in order to avoid effective duplicates. To always unwrap would be safe, because unwrapping is always possible, but determining if there is a proxy for the method parameter in `addApplicationListener` elsewhere is not easily possible. Another workaround would be to make sure that `addApplicationListener` is never called with an unwrapped object in the first place, if a proxy exists. But how to ensure that, is beyond my knowledge.", "createdAt": "2022-04-11T06:03:32Z", "updatedAt": "2022-04-11T06:38:23Z"}, {"id": "IC_kwDOABGHUc5BPzqa", "author": {"login": "kriegaex"}, "body": "I think I found a better, more universal solution and created a PR:\r\n\r\nhttps://github.com/spring-projects/spring-framework/blob/1da3022c27a928988758a5f6bc43913f19eccccf/spring-context/src/main/java/org/springframework/context/event/AbstractApplicationEventMulticaster.java#L266-L281\r\n\r\nI am confident that this is going to work. There might be a way to avoid the proxy targets (unwrapped objects) in the listeners list in the first place, but this method cannot rely on it, as we can see in this issue. So this more defensively implemented solution should be OK.", "createdAt": "2022-04-11T07:46:01Z", "updatedAt": "2022-04-11T08:20:13Z"}, {"id": "IC_kwDOABGHUc5hFTc7", "author": {"login": "sbrannen"}, "body": "- superseded by PR #28322", "createdAt": "2023-07-10T11:30:55Z", "updatedAt": "2023-07-10T11:30:55Z"}, {"id": "IC_kwDOABGHUc5hFXo8", "author": {"login": "kriegaex"}, "body": "@sbrannen: How can a bug be superseded by a PR? After the PR will eventually get merged, it ought to close the bug. I think it is bad practice to close a bug before a fix is in place. Maybe you want to reopen for the time being?", "createdAt": "2023-07-10T11:42:46Z", "updatedAt": "2023-07-10T11:42:46Z"}, {"id": "IC_kwDOABGHUc5hFYrQ", "author": {"login": "sbrannen"}, "body": "> @sbrannen: How can a bug be superseded by a PR? After the PR will eventually get merged, it ought to close the bug. I think it is bad practice to close a bug before a fix is in place. \r\n\r\nThat's our policy: in order to keep the number of open \"issues\" to a minimum, we close an issue as superseded by a PR that addresses the topic.\r\n\r\n> Maybe you want to reopen for the time being?\r\n\r\nIf the PR turns out not to address the issue, the original issue can be reopened after the PR is closed.", "createdAt": "2023-07-10T11:45:34Z", "updatedAt": "2023-07-10T11:45:34Z"}, {"id": "IC_kwDOABGHUc5hFcH4", "author": {"login": "kriegaex"}, "body": "Oh, OK. Thanks for the explanation. Most OSS projects always have pairs of issues and PRs addressing them. Some, like Apache, even enforce it. Spring's policy is rather exotic and kind of counter-intuitive, especially given the fact that my PR contains a comment \"fixes [issue id]\", which would have closed this issue automatically after a merge. This GitHub feature is also rendered useless by the policy currently in place. But of course, strange as it might seem to me, I am going to stick to it.\r\n\r\n> If the PR turns out not to address the issue, the original issue can be reopened after the PR is closed.\r\n\r\nThat is kind of an extra effort, is it not? Anyway, if you prefer it this way, I can live with it.", "createdAt": "2023-07-10T11:55:43Z", "updatedAt": "2023-07-10T11:56:48Z"}]}}]}}
{"id": "PR_kwDOABGHUc4vCfDx", "title": "DataAccessUtils result accessors with Optional return value", "body": "Closes #27728\r\n(https://github.com/spring-projects/spring-framework/issues/27728)\r\n\r\nHi everyone, this is my first PR in any project here on github with the goal of improving my understanding of java. Hope i understood the enhancement request correctly.", "number": 27735, "url": "https://github.com/spring-projects/spring-framework/pull/27735", "author": {"login": "KaidosGH"}, "createdAt": "2021-11-26T00:46:59Z", "mergedAt": "2023-07-14T09:37:09Z", "mergedBy": {"login": "jhoeller"}, "baseRefOid": "2f32806bcb6cefa6479074d5fb66cb68043cedc9", "baseRefName": "main", "headRefOid": "1891fa45b5d43a3741905531f8b84944a7c820e0", "headRefName": "feature/extendDataAccessUtils", "changedFiles": 2, "labels": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Mg"}, "nodes": [{"name": "in: data"}, {"name": "type: enhancement"}]}, "commits": {"nodes": [{"commit": {"oid": "f86cf085cd38933189a5d126a6bd6db3966da515", "message": "extend DataAccessUtils", "changedFilesIfAvailable": 2, "authoredDate": "2021-11-26T00:02:33Z", "author": {"user": {"login": "KaidosGH"}}, "committedDate": "2021-11-26T00:02:33Z", "committer": {"user": {"login": "KaidosGH"}}, "parents": {"nodes": [{"oid": "2f32806bcb6cefa6479074d5fb66cb68043cedc9"}]}}}, {"commit": {"oid": "ff503c7f74eb26d0ee7383ca53856ec03467d10d", "message": "cleanup", "changedFilesIfAvailable": 2, "authoredDate": "2021-11-26T00:26:21Z", "author": {"user": {"login": "KaidosGH"}}, "committedDate": "2021-11-26T00:26:21Z", "committer": {"user": {"login": "KaidosGH"}}, "parents": {"nodes": [{"oid": "f86cf085cd38933189a5d126a6bd6db3966da515"}]}}}, {"commit": {"oid": "b98e7ad15d573bfa846d38b41b0661ae39c7f123", "message": "optimize imports, refactor iterator usage", "changedFilesIfAvailable": 2, "authoredDate": "2021-11-26T19:19:55Z", "author": {"user": {"login": "KaidosGH"}}, "committedDate": "2021-11-26T19:19:55Z", "committer": {"user": {"login": "KaidosGH"}}, "parents": {"nodes": [{"oid": "ff503c7f74eb26d0ee7383ca53856ec03467d10d"}]}}}, {"commit": {"oid": "8a5fc7d42bfef5a4c51e1adfe2392e10065f0c43", "message": "close streams properly with try-with-resource", "changedFilesIfAvailable": 1, "authoredDate": "2021-11-27T13:48:41Z", "author": {"user": {"login": "KaidosGH"}}, "committedDate": "2021-11-27T13:48:41Z", "committer": {"user": {"login": "KaidosGH"}}, "parents": {"nodes": [{"oid": "b98e7ad15d573bfa846d38b41b0661ae39c7f123"}]}}}, {"commit": {"oid": "1e7d103ef28d2d71953b538b1af3d695b0333f6f", "message": "Update spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java\r\n\r\nre-use newly added singleResult methods\n\nCo-authored-by: Vigneswaran <rkvigneswaran@gmail.com>", "changedFilesIfAvailable": 1, "authoredDate": "2021-11-28T03:02:07Z", "author": {"user": {"login": "KaidosGH"}}, "committedDate": "2021-11-28T03:02:07Z", "committer": {"user": null}, "parents": {"nodes": [{"oid": "8a5fc7d42bfef5a4c51e1adfe2392e10065f0c43"}]}}}, {"commit": {"oid": "6522003c31a7217a57f7072157c005633c09829b", "message": "Update spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java\r\n\r\nre-use newly added singleResult methods\n\nCo-authored-by: Vigneswaran <rkvigneswaran@gmail.com>", "changedFilesIfAvailable": 1, "authoredDate": "2021-11-28T03:02:16Z", "author": {"user": {"login": "KaidosGH"}}, "committedDate": "2021-11-28T03:02:16Z", "committer": {"user": null}, "parents": {"nodes": [{"oid": "1e7d103ef28d2d71953b538b1af3d695b0333f6f"}]}}}, {"commit": {"oid": "4ee08be619d964efaac39345699aa97fdeadf5f5", "message": "Update spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java\r\n\r\nre-use newly added singleResult methods\n\nCo-authored-by: Vigneswaran <rkvigneswaran@gmail.com>", "changedFilesIfAvailable": 1, "authoredDate": "2021-11-28T03:02:24Z", "author": {"user": {"login": "KaidosGH"}}, "committedDate": "2021-11-28T03:02:24Z", "committer": {"user": null}, "parents": {"nodes": [{"oid": "6522003c31a7217a57f7072157c005633c09829b"}]}}}, {"commit": {"oid": "3017bebc5bf1dfc7e779706c87ff1fb6b767eb7f", "message": "fix closing bracket", "changedFilesIfAvailable": 1, "authoredDate": "2021-11-28T03:03:17Z", "author": {"user": {"login": "KaidosGH"}}, "committedDate": "2021-11-28T03:03:17Z", "committer": {"user": {"login": "KaidosGH"}}, "parents": {"nodes": [{"oid": "4ee08be619d964efaac39345699aa97fdeadf5f5"}]}}}, {"commit": {"oid": "9206303d453566cd040d1014aad8cbdc78e56387", "message": "Update spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java\r\n\r\nuse \"public IncorrectResultSizeDataAccessException(int expectedSize)\" in stream and iterator method\n\nCo-authored-by: Kwangyong Kim <banana.yong@gmail.com>", "changedFilesIfAvailable": 1, "authoredDate": "2021-11-28T14:10:48Z", "author": {"user": {"login": "KaidosGH"}}, "committedDate": "2021-11-28T14:10:48Z", "committer": {"user": null}, "parents": {"nodes": [{"oid": "3017bebc5bf1dfc7e779706c87ff1fb6b767eb7f"}]}}}, {"commit": {"oid": "7c096e0683570f8fd99da129de25a80be5bf3e59", "message": "Update spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java\r\n\r\nuse \"public IncorrectResultSizeDataAccessException(int expectedSize)\" in stream and iterator method\n\nCo-authored-by: Vigneswaran <rkvigneswaran@gmail.com>", "changedFilesIfAvailable": 1, "authoredDate": "2021-11-28T14:10:56Z", "author": {"user": {"login": "KaidosGH"}}, "committedDate": "2021-11-28T14:10:56Z", "committer": {"user": null}, "parents": {"nodes": [{"oid": "9206303d453566cd040d1014aad8cbdc78e56387"}]}}}, {"commit": {"oid": "1891fa45b5d43a3741905531f8b84944a7c820e0", "message": "update tests to correctly assert the thrown exception", "changedFilesIfAvailable": 1, "authoredDate": "2021-11-28T14:25:33Z", "author": {"user": {"login": "KaidosGH"}}, "committedDate": "2021-11-28T14:25:33Z", "committer": {"user": {"login": "KaidosGH"}}, "parents": {"nodes": [{"oid": "7c096e0683570f8fd99da129de25a80be5bf3e59"}]}}}], "totalCount": 11, "pageInfo": {"hasNextPage": false, "endCursor": null}}, "reviews": {"nodes": [{"id": "PRR_kwDOABGHUc4wr-Qy", "author": {"login": "marschall"}, "state": "COMMENTED", "body": "", "submittedAt": "2021-11-26T14:10:06Z", "updatedAt": "2021-11-26T14:10:06Z", "commit": {"oid": "ff503c7f74eb26d0ee7383ca53856ec03467d10d"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yNlQxNDoxMDowNVrOLSbvHA=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tJu8c", "author": {"login": "marschall"}, "body": "Wouldn't it be better to do a\r\n\r\n    .limit(2).toList()\r\n\r\nand then avoid opening the second stream and instead do\r\n\r\n    resultList.get(0)", "createdAt": "2021-11-26T14:10:05Z", "updatedAt": "2021-11-26T14:10:06Z", "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "diffHunk": "@@ -56,6 +61,109 @@\n \t\treturn results.iterator().next();\n \t}\n \n+\t/**\n+\t * Return a single result object from the given Stream.\n+\t * <p>Returns {@code null} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Stream (can be {@code null})\n+\t * @return the single result object, or {@code null} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Stream\n+\t */\n+\t@Nullable\n+\tpublic static <T> T singleResult(@Nullable Stream<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tList<T> resultList = results.toList();", "line": null, "startLine": null, "originalLine": 78, "originalStartLine": null, "replyTo": null, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "1891fa45b5d43a3741905531f8b84944a7c820e0"}, "originalCommit": {"oid": "ff503c7f74eb26d0ee7383ca53856ec03467d10d"}}]}}, {"id": "PRR_kwDOABGHUc4wr-gv", "author": {"login": "marschall"}, "state": "COMMENTED", "body": "", "submittedAt": "2021-11-26T14:11:12Z", "updatedAt": "2021-11-26T14:11:12Z", "commit": {"oid": "ff503c7f74eb26d0ee7383ca53856ec03467d10d"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yNlQxNDoxMToxMlrOLSbyuw=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tJvK7", "author": {"login": "marschall"}, "body": "Why a stream instead of just\r\n\r\n    results.next()", "createdAt": "2021-11-26T14:11:12Z", "updatedAt": "2021-11-26T14:11:12Z", "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "diffHunk": "@@ -56,6 +61,109 @@\n \t\treturn results.iterator().next();\n \t}\n \n+\t/**\n+\t * Return a single result object from the given Stream.\n+\t * <p>Returns {@code null} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Stream (can be {@code null})\n+\t * @return the single result object, or {@code null} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Stream\n+\t */\n+\t@Nullable\n+\tpublic static <T> T singleResult(@Nullable Stream<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tList<T> resultList = results.toList();\n+\t\tif (resultList.size() > 1) {\n+\t\t\tthrow new IncorrectResultSizeDataAccessException(1, resultList.size());\n+\t\t}\n+\t\treturn resultList.stream().findFirst().orElse(null);\n+\t}\n+\n+\t/**\n+\t * Return a single result object from the given Iterator.\n+\t * <p>Returns {@code null} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Iterator (can be {@code null})\n+\t * @return the single result object, or {@code null} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Iterator\n+\t */\n+\t@Nullable\n+\tpublic static <T> T singleResult(@Nullable Iterator<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tIterable<T> iterable = () -> results;\n+\t\tList<T> resultList = StreamSupport.stream(iterable.spliterator(), false).toList();", "line": null, "startLine": null, "originalLine": 100, "originalStartLine": null, "replyTo": null, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "1891fa45b5d43a3741905531f8b84944a7c820e0"}, "originalCommit": {"oid": "ff503c7f74eb26d0ee7383ca53856ec03467d10d"}}]}}, {"id": "PRR_kwDOABGHUc4wssv0", "author": {"login": "KaidosGH"}, "state": "COMMENTED", "body": "", "submittedAt": "2021-11-26T19:27:57Z", "updatedAt": "2021-11-26T19:27:57Z", "commit": {"oid": "b98e7ad15d573bfa846d38b41b0661ae39c7f123"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yNlQxOToyNzo1N1rOLSknLw=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tKScv", "author": {"login": "KaidosGH"}, "body": "Hi @marschall,\r\n\r\nthanks for reviewing, sounds good, i refactored this. Does it make more sense now?\r\n\r\n`throw new IncorrectResultSizeDataAccessException(1, resultList.size());`\r\nas we limited the resultList size with .limit, this would not report the original passed Stream results size though but instead a maximum of 2... is that an issue?", "createdAt": "2021-11-26T19:27:57Z", "updatedAt": "2021-11-26T19:27:57Z", "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "diffHunk": "@@ -56,6 +61,109 @@\n \t\treturn results.iterator().next();\n \t}\n \n+\t/**\n+\t * Return a single result object from the given Stream.\n+\t * <p>Returns {@code null} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Stream (can be {@code null})\n+\t * @return the single result object, or {@code null} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Stream\n+\t */\n+\t@Nullable\n+\tpublic static <T> T singleResult(@Nullable Stream<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tList<T> resultList = results.toList();", "line": null, "startLine": null, "originalLine": 78, "originalStartLine": null, "replyTo": {"id": "PRRC_kwDOABGHUc4tJu8c"}, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "1891fa45b5d43a3741905531f8b84944a7c820e0"}, "originalCommit": {"oid": "ff503c7f74eb26d0ee7383ca53856ec03467d10d"}}]}}, {"id": "PRR_kwDOABGHUc4wtGLF", "author": {"login": "marschall"}, "state": "COMMENTED", "body": "", "submittedAt": "2021-11-27T12:03:41Z", "updatedAt": "2021-11-27T12:03:41Z", "commit": {"oid": "b98e7ad15d573bfa846d38b41b0661ae39c7f123"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yN1QxMjowMzo0MVrOLSq4Pw=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tKrg_", "author": {"login": "marschall"}, "body": "Yes, looks better to me.", "createdAt": "2021-11-27T12:03:41Z", "updatedAt": "2021-11-27T12:03:41Z", "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "diffHunk": "@@ -56,6 +61,109 @@\n \t\treturn results.iterator().next();\n \t}\n \n+\t/**\n+\t * Return a single result object from the given Stream.\n+\t * <p>Returns {@code null} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Stream (can be {@code null})\n+\t * @return the single result object, or {@code null} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Stream\n+\t */\n+\t@Nullable\n+\tpublic static <T> T singleResult(@Nullable Stream<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tList<T> resultList = results.toList();", "line": null, "startLine": null, "originalLine": 78, "originalStartLine": null, "replyTo": {"id": "PRRC_kwDOABGHUc4tJu8c"}, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "1891fa45b5d43a3741905531f8b84944a7c820e0"}, "originalCommit": {"oid": "ff503c7f74eb26d0ee7383ca53856ec03467d10d"}}]}}, {"id": "PRR_kwDOABGHUc4wtGRd", "author": {"login": "marschall"}, "state": "COMMENTED", "body": "", "submittedAt": "2021-11-27T12:09:49Z", "updatedAt": "2021-11-27T12:09:49Z", "commit": {"oid": "b98e7ad15d573bfa846d38b41b0661ae39c7f123"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yN1QxMjowOTo0OVrOLSq6Ug=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tKrpS", "author": {"login": "marschall"}, "body": "There is a trade off here and in `#optionalResult` whether we should call `#close` on the stream:\r\n\r\nOn one hand Java convention is the code who creates a \"resource\" is responsible for disposing it, in this case the caller of this method would be responsible to call `#close` on the streams where required.\r\nOn the other hand failing to call `#close` on some streams, like the ones returned by `JdbcOperations#queryForStream`, can lead to resource leaks. Having the caller put streams in a try-with-resources block is both cumbersome and error prone.", "createdAt": "2021-11-27T12:09:49Z", "updatedAt": "2021-11-27T12:09:49Z", "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "diffHunk": "@@ -56,6 +60,107 @@\n \t\treturn results.iterator().next();\n \t}\n \n+\t/**\n+\t * Return a single result object from the given Stream.\n+\t * <p>Returns {@code null} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Stream (can be {@code null})\n+\t * @return the single result object, or {@code null} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Stream\n+\t */\n+\t@Nullable\n+\tpublic static <T> T singleResult(@Nullable Stream<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tList<T> resultList = results.limit(2).toList();", "line": null, "startLine": null, "originalLine": 77, "originalStartLine": null, "replyTo": null, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "1891fa45b5d43a3741905531f8b84944a7c820e0"}, "originalCommit": {"oid": "b98e7ad15d573bfa846d38b41b0661ae39c7f123"}}]}}, {"id": "PRR_kwDOABGHUc4wtH0B", "author": {"login": "KaidosGH"}, "state": "COMMENTED", "body": "", "submittedAt": "2021-11-27T13:56:23Z", "updatedAt": "2021-11-27T13:56:23Z", "commit": {"oid": "8a5fc7d42bfef5a4c51e1adfe2392e10065f0c43"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yN1QxMzo1NjoyM1rOLSrezA=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tKt7M", "author": {"login": "KaidosGH"}, "body": "Makes sense. The passed stream is now closed in both methods. Also e.g. hibernate's Query.stream() documentation suggests the stream should be closed afterwards, so not so far fetched \ud83d\udc4d ", "createdAt": "2021-11-27T13:56:23Z", "updatedAt": "2021-11-27T13:56:23Z", "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "diffHunk": "@@ -56,6 +60,107 @@\n \t\treturn results.iterator().next();\n \t}\n \n+\t/**\n+\t * Return a single result object from the given Stream.\n+\t * <p>Returns {@code null} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Stream (can be {@code null})\n+\t * @return the single result object, or {@code null} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Stream\n+\t */\n+\t@Nullable\n+\tpublic static <T> T singleResult(@Nullable Stream<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tList<T> resultList = results.limit(2).toList();", "line": null, "startLine": null, "originalLine": 77, "originalStartLine": null, "replyTo": {"id": "PRRC_kwDOABGHUc4tKrpS"}, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "1891fa45b5d43a3741905531f8b84944a7c820e0"}, "originalCommit": {"oid": "b98e7ad15d573bfa846d38b41b0661ae39c7f123"}}]}}, {"id": "PRR_kwDOABGHUc4wtQbp", "author": {"login": "rkvigneswaran"}, "state": "COMMENTED", "body": "", "submittedAt": "2021-11-28T02:37:54Z", "updatedAt": "2021-11-28T02:37:54Z", "commit": {"oid": "8a5fc7d42bfef5a4c51e1adfe2392e10065f0c43"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yOFQwMjozNzo1NFrOLSuiVg=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tK6JW", "author": {"login": "rkvigneswaran"}, "body": "Would it be better if we delegate this to original `singleResult(Collection<T>)` method?\r\n\r\n```suggestion\r\n\t\treturn Optional.ofNullable(singleResult(results));\r\n```", "createdAt": "2021-11-28T02:37:54Z", "updatedAt": "2021-11-28T02:39:00Z", "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "diffHunk": "@@ -56,6 +60,111 @@\n \t\treturn results.iterator().next();\n \t}\n \n+\t/**\n+\t * Return a single result object from the given Stream.\n+\t * <p>Returns {@code null} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Stream (can be {@code null})\n+\t * @return the single result object, or {@code null} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Stream\n+\t */\n+\t@Nullable\n+\tpublic static <T> T singleResult(@Nullable Stream<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\ttry (results) {\n+\t\t\tList<T> resultList = results.limit(2).toList();\n+\t\t\tif (resultList.size() > 1) {\n+\t\t\t\tthrow new IncorrectResultSizeDataAccessException(1, resultList.size());\n+\t\t\t}\n+\t\t\treturn CollectionUtils.isEmpty(resultList) ? null : resultList.get(0);\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Return a single result object from the given Iterator.\n+\t * <p>Returns {@code null} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Iterator (can be {@code null})\n+\t * @return the single result object, or {@code null} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Iterator\n+\t */\n+\t@Nullable\n+\tpublic static <T> T singleResult(@Nullable Iterator<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tT result = results.hasNext() ? results.next() : null;\n+\t\tif (results.hasNext()) {\n+\t\t\tthrow new IncorrectResultSizeDataAccessException(1, 2);\n+\t\t}\n+\t\treturn result;\n+\t}\n+\n+\t/**\n+\t * Return a single result object from the given Collection.\n+\t * <p>Returns {@code Optional.empty()} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Collection (can be {@code null})\n+\t * @return the single optional result object, or {@code Optional.empty()} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Collection\n+\t */\n+\tpublic static <T> Optional<T> optionalResult(@Nullable Collection<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (CollectionUtils.isEmpty(results)) {\n+\t\t\treturn Optional.empty();\n+\t\t}\n+\t\tif (results.size() > 1) {\n+\t\t\tthrow new IncorrectResultSizeDataAccessException(1, results.size());\n+\t\t}\n+\t\treturn results.stream().findFirst();", "line": null, "startLine": null, "originalLine": 123, "originalStartLine": 117, "replyTo": null, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "1891fa45b5d43a3741905531f8b84944a7c820e0"}, "originalCommit": {"oid": "8a5fc7d42bfef5a4c51e1adfe2392e10065f0c43"}}]}}, {"id": "PRR_kwDOABGHUc4wtQeN", "author": {"login": "rkvigneswaran"}, "state": "COMMENTED", "body": "", "submittedAt": "2021-11-28T02:42:16Z", "updatedAt": "2021-11-28T02:42:16Z", "commit": {"oid": "8a5fc7d42bfef5a4c51e1adfe2392e10065f0c43"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yOFQwMjo0MjoxNVrOLSujhw=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tK6OH", "author": {"login": "rkvigneswaran"}, "body": "Would it be better if we delegate this to newly added `singleResult(Stream<T>)` method?\r\n```suggestion\r\n\t\treturn Optional.ofNullable(singleResult(results));\r\n```\r\n\r\n", "createdAt": "2021-11-28T02:42:15Z", "updatedAt": "2021-11-28T02:43:10Z", "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "diffHunk": "@@ -56,6 +60,111 @@\n \t\treturn results.iterator().next();\n \t}\n \n+\t/**\n+\t * Return a single result object from the given Stream.\n+\t * <p>Returns {@code null} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Stream (can be {@code null})\n+\t * @return the single result object, or {@code null} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Stream\n+\t */\n+\t@Nullable\n+\tpublic static <T> T singleResult(@Nullable Stream<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\ttry (results) {\n+\t\t\tList<T> resultList = results.limit(2).toList();\n+\t\t\tif (resultList.size() > 1) {\n+\t\t\t\tthrow new IncorrectResultSizeDataAccessException(1, resultList.size());\n+\t\t\t}\n+\t\t\treturn CollectionUtils.isEmpty(resultList) ? null : resultList.get(0);\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Return a single result object from the given Iterator.\n+\t * <p>Returns {@code null} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Iterator (can be {@code null})\n+\t * @return the single result object, or {@code null} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Iterator\n+\t */\n+\t@Nullable\n+\tpublic static <T> T singleResult(@Nullable Iterator<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tT result = results.hasNext() ? results.next() : null;\n+\t\tif (results.hasNext()) {\n+\t\t\tthrow new IncorrectResultSizeDataAccessException(1, 2);\n+\t\t}\n+\t\treturn result;\n+\t}\n+\n+\t/**\n+\t * Return a single result object from the given Collection.\n+\t * <p>Returns {@code Optional.empty()} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Collection (can be {@code null})\n+\t * @return the single optional result object, or {@code Optional.empty()} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Collection\n+\t */\n+\tpublic static <T> Optional<T> optionalResult(@Nullable Collection<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (CollectionUtils.isEmpty(results)) {\n+\t\t\treturn Optional.empty();\n+\t\t}\n+\t\tif (results.size() > 1) {\n+\t\t\tthrow new IncorrectResultSizeDataAccessException(1, results.size());\n+\t\t}\n+\t\treturn results.stream().findFirst();\n+\t}\n+\n+\t/**\n+\t * Return a single result object from the given Stream.\n+\t * <p>Returns {@code Optional.empty()} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Stream (can be {@code null})\n+\t * @return the single optional result object, or {@code Optional.empty()} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Stream\n+\t */\n+\tpublic static <T> Optional<T> optionalResult(@Nullable Stream<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn Optional.empty();\n+\t\t}\n+\t\ttry (results) {\n+\t\t\tList<T> resultList = results.limit(2).toList();\n+\t\t\tif (resultList.size() > 1) {\n+\t\t\t\tthrow new IncorrectResultSizeDataAccessException(1, resultList.size());\n+\t\t\t}\n+\t\t\treturn CollectionUtils.isEmpty(resultList) ? Optional.empty() : Optional.of(resultList.get(0));", "line": null, "startLine": null, "originalLine": 144, "originalStartLine": 136, "replyTo": null, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "1891fa45b5d43a3741905531f8b84944a7c820e0"}, "originalCommit": {"oid": "8a5fc7d42bfef5a4c51e1adfe2392e10065f0c43"}}]}}, {"id": "PRR_kwDOABGHUc4wtQef", "author": {"login": "rkvigneswaran"}, "state": "COMMENTED", "body": "", "submittedAt": "2021-11-28T02:42:58Z", "updatedAt": "2021-11-28T02:42:58Z", "commit": {"oid": "8a5fc7d42bfef5a4c51e1adfe2392e10065f0c43"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yOFQwMjo0Mjo1OFrOLSujpQ=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tK6Ol", "author": {"login": "rkvigneswaran"}, "body": "Would it be better if we delegate this to newly added `singleResult(Iterator<T>)` method?\r\n```suggestion\r\n\t\treturn Optional.ofNullable(singleResult(results));\r\n```\r\n\r\n", "createdAt": "2021-11-28T02:42:58Z", "updatedAt": "2021-11-28T02:42:58Z", "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "diffHunk": "@@ -56,6 +60,111 @@\n \t\treturn results.iterator().next();\n \t}\n \n+\t/**\n+\t * Return a single result object from the given Stream.\n+\t * <p>Returns {@code null} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Stream (can be {@code null})\n+\t * @return the single result object, or {@code null} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Stream\n+\t */\n+\t@Nullable\n+\tpublic static <T> T singleResult(@Nullable Stream<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\ttry (results) {\n+\t\t\tList<T> resultList = results.limit(2).toList();\n+\t\t\tif (resultList.size() > 1) {\n+\t\t\t\tthrow new IncorrectResultSizeDataAccessException(1, resultList.size());\n+\t\t\t}\n+\t\t\treturn CollectionUtils.isEmpty(resultList) ? null : resultList.get(0);\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Return a single result object from the given Iterator.\n+\t * <p>Returns {@code null} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Iterator (can be {@code null})\n+\t * @return the single result object, or {@code null} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Iterator\n+\t */\n+\t@Nullable\n+\tpublic static <T> T singleResult(@Nullable Iterator<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tT result = results.hasNext() ? results.next() : null;\n+\t\tif (results.hasNext()) {\n+\t\t\tthrow new IncorrectResultSizeDataAccessException(1, 2);\n+\t\t}\n+\t\treturn result;\n+\t}\n+\n+\t/**\n+\t * Return a single result object from the given Collection.\n+\t * <p>Returns {@code Optional.empty()} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Collection (can be {@code null})\n+\t * @return the single optional result object, or {@code Optional.empty()} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Collection\n+\t */\n+\tpublic static <T> Optional<T> optionalResult(@Nullable Collection<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (CollectionUtils.isEmpty(results)) {\n+\t\t\treturn Optional.empty();\n+\t\t}\n+\t\tif (results.size() > 1) {\n+\t\t\tthrow new IncorrectResultSizeDataAccessException(1, results.size());\n+\t\t}\n+\t\treturn results.stream().findFirst();\n+\t}\n+\n+\t/**\n+\t * Return a single result object from the given Stream.\n+\t * <p>Returns {@code Optional.empty()} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Stream (can be {@code null})\n+\t * @return the single optional result object, or {@code Optional.empty()} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Stream\n+\t */\n+\tpublic static <T> Optional<T> optionalResult(@Nullable Stream<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn Optional.empty();\n+\t\t}\n+\t\ttry (results) {\n+\t\t\tList<T> resultList = results.limit(2).toList();\n+\t\t\tif (resultList.size() > 1) {\n+\t\t\t\tthrow new IncorrectResultSizeDataAccessException(1, resultList.size());\n+\t\t\t}\n+\t\t\treturn CollectionUtils.isEmpty(resultList) ? Optional.empty() : Optional.of(resultList.get(0));\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Return a single result object from the given Iterator.\n+\t * <p>Returns {@code Optional.empty()} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Iterator (can be {@code null})\n+\t * @return the single optional result object, or {@code Optional.empty()} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Iterator\n+\t */\n+\tpublic static <T> Optional<T> optionalResult(@Nullable Iterator<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn Optional.empty();\n+\t\t}\n+\t\tT result = results.hasNext() ? results.next() : null;\n+\t\tif (results.hasNext()) {\n+\t\t\tthrow new IncorrectResultSizeDataAccessException(1, 2);\n+\t\t}\n+\t\treturn Optional.ofNullable(result);", "line": null, "startLine": null, "originalLine": 165, "originalStartLine": 158, "replyTo": null, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "1891fa45b5d43a3741905531f8b84944a7c820e0"}, "originalCommit": {"oid": "8a5fc7d42bfef5a4c51e1adfe2392e10065f0c43"}}]}}, {"id": "PRR_kwDOABGHUc4wtQgc", "author": {"login": "rkvigneswaran"}, "state": "CHANGES_REQUESTED", "body": "Hi,\r\n\r\nThis is my first review comments in any open source project. Kindly let me know if my comments are invalid.", "submittedAt": "2021-11-28T02:45:38Z", "updatedAt": "2021-11-28T02:45:38Z", "commit": {"oid": "8a5fc7d42bfef5a4c51e1adfe2392e10065f0c43"}, "comments": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}}, {"id": "PRR_kwDOABGHUc4wtQqW", "author": {"login": "KaidosGH"}, "state": "COMMENTED", "body": "", "submittedAt": "2021-11-28T03:01:29Z", "updatedAt": "2021-11-28T03:01:29Z", "commit": {"oid": "8a5fc7d42bfef5a4c51e1adfe2392e10065f0c43"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yOFQwMzowMToyOFrOLSuotw=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tK6i3", "author": {"login": "KaidosGH"}, "body": "Hi @rkvigneswaran,\r\n\r\nthat is actually pretty smart. Cuts out a lot of redundant code! \ud83d\udc4d \r\n\r\nedit: i commited all 3 enhancements", "createdAt": "2021-11-28T03:01:28Z", "updatedAt": "2021-11-28T03:04:28Z", "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "diffHunk": "@@ -56,6 +60,111 @@\n \t\treturn results.iterator().next();\n \t}\n \n+\t/**\n+\t * Return a single result object from the given Stream.\n+\t * <p>Returns {@code null} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Stream (can be {@code null})\n+\t * @return the single result object, or {@code null} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Stream\n+\t */\n+\t@Nullable\n+\tpublic static <T> T singleResult(@Nullable Stream<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\ttry (results) {\n+\t\t\tList<T> resultList = results.limit(2).toList();\n+\t\t\tif (resultList.size() > 1) {\n+\t\t\t\tthrow new IncorrectResultSizeDataAccessException(1, resultList.size());\n+\t\t\t}\n+\t\t\treturn CollectionUtils.isEmpty(resultList) ? null : resultList.get(0);\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Return a single result object from the given Iterator.\n+\t * <p>Returns {@code null} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Iterator (can be {@code null})\n+\t * @return the single result object, or {@code null} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Iterator\n+\t */\n+\t@Nullable\n+\tpublic static <T> T singleResult(@Nullable Iterator<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tT result = results.hasNext() ? results.next() : null;\n+\t\tif (results.hasNext()) {\n+\t\t\tthrow new IncorrectResultSizeDataAccessException(1, 2);\n+\t\t}\n+\t\treturn result;\n+\t}\n+\n+\t/**\n+\t * Return a single result object from the given Collection.\n+\t * <p>Returns {@code Optional.empty()} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Collection (can be {@code null})\n+\t * @return the single optional result object, or {@code Optional.empty()} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Collection\n+\t */\n+\tpublic static <T> Optional<T> optionalResult(@Nullable Collection<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (CollectionUtils.isEmpty(results)) {\n+\t\t\treturn Optional.empty();\n+\t\t}\n+\t\tif (results.size() > 1) {\n+\t\t\tthrow new IncorrectResultSizeDataAccessException(1, results.size());\n+\t\t}\n+\t\treturn results.stream().findFirst();", "line": null, "startLine": null, "originalLine": 123, "originalStartLine": 117, "replyTo": {"id": "PRRC_kwDOABGHUc4tK6JW"}, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "1891fa45b5d43a3741905531f8b84944a7c820e0"}, "originalCommit": {"oid": "8a5fc7d42bfef5a4c51e1adfe2392e10065f0c43"}}]}}, {"id": "PRR_kwDOABGHUc4wtSnN", "author": {"login": "bananayong"}, "state": "COMMENTED", "body": "", "submittedAt": "2021-11-28T06:21:53Z", "updatedAt": "2021-11-28T06:21:53Z", "commit": {"oid": "3017bebc5bf1dfc7e779706c87ff1fb6b767eb7f"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yOFQwNjoyMTo1M1rOLSvb4Q=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tK9vh", "author": {"login": "bananayong"}, "body": "I think IncorrectResultSizeDataAccessException should contain the size of the results stream.\r\nif `resultList.size()` will be used, actual size of IncorrectResultSizeDataAccessException is `<=2` always unlike actual size of results.\r\n\r\nIf prefer stream way, How about utilze `teeing`?\r\n```java\r\n\t\tresults.collect(teeing(counting(), reducing((first, second) -> first), (count, result) -> {\r\n\t\t\tif (count > 1) {\r\n\t\t\t\tthrow new IncorrectResultSizeDataAccessException(1, count.intValue());\r\n\t\t\t}\r\n\t\t\treturn result.orElse(null);\r\n\t\t}))\r\n```", "createdAt": "2021-11-28T06:21:53Z", "updatedAt": "2021-11-28T06:21:53Z", "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "diffHunk": "@@ -56,6 +60,89 @@\n \t\treturn results.iterator().next();\n \t}\n \n+\t/**\n+\t * Return a single result object from the given Stream.\n+\t * <p>Returns {@code null} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Stream (can be {@code null})\n+\t * @return the single result object, or {@code null} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Stream\n+\t */\n+\t@Nullable\n+\tpublic static <T> T singleResult(@Nullable Stream<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\ttry (results) {\n+\t\t\tList<T> resultList = results.limit(2).toList();\n+\t\t\tif (resultList.size() > 1) {\n+\t\t\t\tthrow new IncorrectResultSizeDataAccessException(1, resultList.size());", "line": null, "startLine": null, "originalLine": 80, "originalStartLine": null, "replyTo": null, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "1891fa45b5d43a3741905531f8b84944a7c820e0"}, "originalCommit": {"oid": "3017bebc5bf1dfc7e779706c87ff1fb6b767eb7f"}}]}}, {"id": "PRR_kwDOABGHUc4wtU0h", "author": {"login": "rkvigneswaran"}, "state": "COMMENTED", "body": "", "submittedAt": "2021-11-28T08:28:16Z", "updatedAt": "2021-11-28T08:28:16Z", "commit": {"oid": "3017bebc5bf1dfc7e779706c87ff1fb6b767eb7f"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yOFQwODoyODoxNVrOLSwKVA=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tLApU", "author": {"login": "rkvigneswaran"}, "body": "Just a suggestion. There are multiple constructors provided by `IncorrectResultSizeDataAccessException` class. \r\n\r\n* One of the constructors doesn't take `actualSize` argument and assigns the value `-1` if the size if unknown. You can consider using it\r\n  * `public IncorrectResultSizeDataAccessException(int expectedSize)` - [Javadoc](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/dao/IncorrectResultSizeDataAccessException.html#IncorrectResultSizeDataAccessException-int-)\r\n* Another constructor explicitly suggests setting the value of `actualSize` to `-1` if size is unknown\r\n  * `public IncorrectResultSizeDataAccessException(int expectedSize, int actualSize)` - [Javadoc](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/dao/IncorrectResultSizeDataAccessException.html#IncorrectResultSizeDataAccessException-int-int-)\r\n\r\nBoth of them would be suitable for this scenario since size is unknown", "createdAt": "2021-11-28T08:28:15Z", "updatedAt": "2021-11-28T08:30:33Z", "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "diffHunk": "@@ -56,6 +60,89 @@\n \t\treturn results.iterator().next();\n \t}\n \n+\t/**\n+\t * Return a single result object from the given Stream.\n+\t * <p>Returns {@code null} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Stream (can be {@code null})\n+\t * @return the single result object, or {@code null} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Stream\n+\t */\n+\t@Nullable\n+\tpublic static <T> T singleResult(@Nullable Stream<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\ttry (results) {\n+\t\t\tList<T> resultList = results.limit(2).toList();\n+\t\t\tif (resultList.size() > 1) {\n+\t\t\t\tthrow new IncorrectResultSizeDataAccessException(1, resultList.size());", "line": null, "startLine": null, "originalLine": 80, "originalStartLine": null, "replyTo": {"id": "PRRC_kwDOABGHUc4tK9vh"}, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "1891fa45b5d43a3741905531f8b84944a7c820e0"}, "originalCommit": {"oid": "3017bebc5bf1dfc7e779706c87ff1fb6b767eb7f"}}]}}, {"id": "PRR_kwDOABGHUc4wtVvK", "author": {"login": "bananayong"}, "state": "COMMENTED", "body": "", "submittedAt": "2021-11-28T09:08:45Z", "updatedAt": "2021-11-28T09:08:45Z", "commit": {"oid": "3017bebc5bf1dfc7e779706c87ff1fb6b767eb7f"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yOFQwOTowODo0NFrOLSwcNg=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tLBw2", "author": {"login": "bananayong"}, "body": "It makes sense.", "createdAt": "2021-11-28T09:08:44Z", "updatedAt": "2021-11-28T09:08:45Z", "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "diffHunk": "@@ -56,6 +60,89 @@\n \t\treturn results.iterator().next();\n \t}\n \n+\t/**\n+\t * Return a single result object from the given Stream.\n+\t * <p>Returns {@code null} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Stream (can be {@code null})\n+\t * @return the single result object, or {@code null} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Stream\n+\t */\n+\t@Nullable\n+\tpublic static <T> T singleResult(@Nullable Stream<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\ttry (results) {\n+\t\t\tList<T> resultList = results.limit(2).toList();\n+\t\t\tif (resultList.size() > 1) {\n+\t\t\t\tthrow new IncorrectResultSizeDataAccessException(1, resultList.size());", "line": null, "startLine": null, "originalLine": 80, "originalStartLine": null, "replyTo": {"id": "PRRC_kwDOABGHUc4tK9vh"}, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "1891fa45b5d43a3741905531f8b84944a7c820e0"}, "originalCommit": {"oid": "3017bebc5bf1dfc7e779706c87ff1fb6b767eb7f"}}]}}, {"id": "PRR_kwDOABGHUc4wtV8o", "author": {"login": "rkvigneswaran"}, "state": "COMMENTED", "body": "", "submittedAt": "2021-11-28T09:18:00Z", "updatedAt": "2021-11-28T09:18:00Z", "commit": {"oid": "3017bebc5bf1dfc7e779706c87ff1fb6b767eb7f"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yOFQwOToxNzo1OVrOLSwgpQ=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tLCCl", "author": {"login": "rkvigneswaran"}, "body": "```suggestion\r\n\t\t\t\tthrow new IncorrectResultSizeDataAccessException(1);\r\n```\r\n\r\nUTs might need to be updated to reflect this behaviour", "createdAt": "2021-11-28T09:17:59Z", "updatedAt": "2021-11-28T09:25:26Z", "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "diffHunk": "@@ -56,6 +60,89 @@\n \t\treturn results.iterator().next();\n \t}\n \n+\t/**\n+\t * Return a single result object from the given Stream.\n+\t * <p>Returns {@code null} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Stream (can be {@code null})\n+\t * @return the single result object, or {@code null} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Stream\n+\t */\n+\t@Nullable\n+\tpublic static <T> T singleResult(@Nullable Stream<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\ttry (results) {\n+\t\t\tList<T> resultList = results.limit(2).toList();\n+\t\t\tif (resultList.size() > 1) {\n+\t\t\t\tthrow new IncorrectResultSizeDataAccessException(1, resultList.size());", "line": null, "startLine": null, "originalLine": 80, "originalStartLine": null, "replyTo": {"id": "PRRC_kwDOABGHUc4tK9vh"}, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "1891fa45b5d43a3741905531f8b84944a7c820e0"}, "originalCommit": {"oid": "3017bebc5bf1dfc7e779706c87ff1fb6b767eb7f"}}]}}, {"id": "PRR_kwDOABGHUc4wtWEV", "author": {"login": "rkvigneswaran"}, "state": "COMMENTED", "body": "", "submittedAt": "2021-11-28T09:22:51Z", "updatedAt": "2021-11-28T09:22:51Z", "commit": {"oid": "3017bebc5bf1dfc7e779706c87ff1fb6b767eb7f"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yOFQwOToyMjo1MFrOLSwi2w=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tLCLb", "author": {"login": "rkvigneswaran"}, "body": "Same suggestion as above - [Link](https://github.com/spring-projects/spring-framework/pull/27735/files#r757849057). Since `actualSize` of the iterator isn't known beforehand, we can use `public IncorrectResultSizeDataAccessException(int expectedSize)` constructor and set the `actualSize`  as `-1`\r\n```suggestion\r\n\t\t\tthrow new IncorrectResultSizeDataAccessException(1);\r\n```\r\n\r\nUTs might need to be updated to reflect this behaviour", "createdAt": "2021-11-28T09:22:50Z", "updatedAt": "2021-11-28T09:25:12Z", "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "diffHunk": "@@ -56,6 +60,89 @@\n \t\treturn results.iterator().next();\n \t}\n \n+\t/**\n+\t * Return a single result object from the given Stream.\n+\t * <p>Returns {@code null} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Stream (can be {@code null})\n+\t * @return the single result object, or {@code null} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Stream\n+\t */\n+\t@Nullable\n+\tpublic static <T> T singleResult(@Nullable Stream<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\ttry (results) {\n+\t\t\tList<T> resultList = results.limit(2).toList();\n+\t\t\tif (resultList.size() > 1) {\n+\t\t\t\tthrow new IncorrectResultSizeDataAccessException(1, resultList.size());\n+\t\t\t}\n+\t\t\treturn CollectionUtils.isEmpty(resultList) ? null : resultList.get(0);\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Return a single result object from the given Iterator.\n+\t * <p>Returns {@code null} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Iterator (can be {@code null})\n+\t * @return the single result object, or {@code null} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Iterator\n+\t */\n+\t@Nullable\n+\tpublic static <T> T singleResult(@Nullable Iterator<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tT result = results.hasNext() ? results.next() : null;\n+\t\tif (results.hasNext()) {\n+\t\t\tthrow new IncorrectResultSizeDataAccessException(1, 2);", "line": null, "startLine": null, "originalLine": 102, "originalStartLine": null, "replyTo": null, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "1891fa45b5d43a3741905531f8b84944a7c820e0"}, "originalCommit": {"oid": "3017bebc5bf1dfc7e779706c87ff1fb6b767eb7f"}}]}}, {"id": "PRR_kwDOABGHUc4wtWLa", "author": {"login": "rkvigneswaran"}, "state": "CHANGES_REQUESTED", "body": "Modifying the exception to make it clear that size of the underlying Stream/Iterator is not known", "submittedAt": "2021-11-28T09:27:14Z", "updatedAt": "2021-11-28T09:27:14Z", "commit": {"oid": "3017bebc5bf1dfc7e779706c87ff1fb6b767eb7f"}, "comments": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}}, {"id": "PRR_kwDOABGHUc4wtc_j", "author": {"login": "KaidosGH"}, "state": "COMMENTED", "body": "", "submittedAt": "2021-11-28T14:09:23Z", "updatedAt": "2021-11-28T14:09:23Z", "commit": {"oid": "3017bebc5bf1dfc7e779706c87ff1fb6b767eb7f"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yOFQxNDowOToyM1rOLSysbQ=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tLKxt", "author": {"login": "KaidosGH"}, "body": "yeah let's use the `public IncorrectResultSizeDataAccessException(int expectedSize)` for the iterator and stream method. \r\nWhat do you mean by \"UT\"?\r\n\r\nEdit: nevermind, figured it out \ud83d\ude04", "createdAt": "2021-11-28T14:09:23Z", "updatedAt": "2021-11-28T14:14:52Z", "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "diffHunk": "@@ -56,6 +60,89 @@\n \t\treturn results.iterator().next();\n \t}\n \n+\t/**\n+\t * Return a single result object from the given Stream.\n+\t * <p>Returns {@code null} if 0 result objects found;\n+\t * throws an exception if more than 1 element found.\n+\t * @param results the result Stream (can be {@code null})\n+\t * @return the single result object, or {@code null} if none\n+\t * @throws IncorrectResultSizeDataAccessException if more than one\n+\t * element has been found in the given Stream\n+\t */\n+\t@Nullable\n+\tpublic static <T> T singleResult(@Nullable Stream<T> results) throws IncorrectResultSizeDataAccessException {\n+\t\tif (results == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\ttry (results) {\n+\t\t\tList<T> resultList = results.limit(2).toList();\n+\t\t\tif (resultList.size() > 1) {\n+\t\t\t\tthrow new IncorrectResultSizeDataAccessException(1, resultList.size());", "line": null, "startLine": null, "originalLine": 80, "originalStartLine": null, "replyTo": {"id": "PRRC_kwDOABGHUc4tK9vh"}, "isMinimized": false, "minimizedReason": null, "commit": {"oid": "1891fa45b5d43a3741905531f8b84944a7c820e0"}, "originalCommit": {"oid": "3017bebc5bf1dfc7e779706c87ff1fb6b767eb7f"}}]}}], "totalCount": 18, "pageInfo": {"hasNextPage": false, "endCursor": null}}, "reviewThreads": {"totalCount": 8, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yOFQwOToyMjo1MFrOHNtGVg=="}, "nodes": [{"id": "PRRT_kwDOABGHUc4c12KA", "isResolved": false, "isOutdated": true, "isCollapsed": false, "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "startLine": null, "originalLine": 78, "diffSide": "RIGHT", "startDiffSide": null, "resolvedBy": null, "comments": {"totalCount": 3, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yN1QxMjowMzo0MVrOLSq4Pw=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tJu8c"}, {"id": "PRRC_kwDOABGHUc4tKScv"}, {"id": "PRRC_kwDOABGHUc4tKrg_"}]}}, {"id": "PRRT_kwDOABGHUc4c12Ta", "isResolved": false, "isOutdated": true, "isCollapsed": false, "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "startLine": null, "originalLine": 100, "diffSide": "RIGHT", "startDiffSide": null, "resolvedBy": null, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yNlQxNDoxMToxMlrOLSbyuw=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tJvK7"}]}}, {"id": "PRRT_kwDOABGHUc4c2hh3", "isResolved": false, "isOutdated": true, "isCollapsed": false, "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "startLine": null, "originalLine": 77, "diffSide": "RIGHT", "startDiffSide": null, "resolvedBy": null, "comments": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yN1QxMzo1NjoyM1rOLSrezA=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tKrpS"}, {"id": "PRRC_kwDOABGHUc4tKt7M"}]}}, {"id": "PRRT_kwDOABGHUc4c2tq2", "isResolved": true, "isOutdated": true, "isCollapsed": true, "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "startLine": null, "originalLine": 123, "diffSide": "RIGHT", "startDiffSide": "RIGHT", "resolvedBy": {"login": "KaidosGH"}, "comments": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yOFQwMzowMToyOFrOLSuotw=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tK6JW"}, {"id": "PRRC_kwDOABGHUc4tK6i3"}]}}, {"id": "PRRT_kwDOABGHUc4c2tvE", "isResolved": true, "isOutdated": true, "isCollapsed": true, "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "startLine": null, "originalLine": 144, "diffSide": "RIGHT", "startDiffSide": "RIGHT", "resolvedBy": {"login": "KaidosGH"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yOFQwMjo0MjoxNVrOLSujhw=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tK6OH"}]}}, {"id": "PRRT_kwDOABGHUc4c2tvf", "isResolved": true, "isOutdated": true, "isCollapsed": true, "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "startLine": null, "originalLine": 165, "diffSide": "RIGHT", "startDiffSide": "RIGHT", "resolvedBy": {"login": "KaidosGH"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yOFQwMjo0Mjo1OFrOLSujpQ=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tK6Ol"}]}}, {"id": "PRRT_kwDOABGHUc4c2w0c", "isResolved": true, "isOutdated": true, "isCollapsed": true, "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "startLine": null, "originalLine": 80, "diffSide": "RIGHT", "startDiffSide": null, "resolvedBy": {"login": "KaidosGH"}, "comments": {"totalCount": 5, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yOFQxNDowOToyM1rOLSysbQ=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tK9vh"}, {"id": "PRRC_kwDOABGHUc4tLApU"}, {"id": "PRRC_kwDOABGHUc4tLBw2"}, {"id": "PRRC_kwDOABGHUc4tLCCl"}, {"id": "PRRC_kwDOABGHUc4tLKxt"}]}}, {"id": "PRRT_kwDOABGHUc4c20ZW", "isResolved": true, "isOutdated": true, "isCollapsed": true, "path": "spring-tx/src/main/java/org/springframework/dao/support/DataAccessUtils.java", "startLine": null, "originalLine": 102, "diffSide": "RIGHT", "startDiffSide": null, "resolvedBy": {"login": "KaidosGH"}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0xMS0yOFQwOToyMjo1MFrOLSwi2w=="}, "nodes": [{"id": "PRRC_kwDOABGHUc4tLCLb"}]}}]}, "closingIssuesReferences": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"id": "I_kwDOABGHUc4_U9mZ", "number": 27728, "url": "https://github.com/spring-projects/spring-framework/issues/27728", "title": "DataAccessUtils result accessors with Optional return value", "body": "Related to #724, `DataAccessUtils` should provide an `optionalResult` method for `Collection` as well as `Stream` arguments (and also for `Iterator` because we need that internally anyway), returning a corresponding `Optional` wrapper or `Optional.empty()`.\r\n\r\nIn addition, a `singleResult` overload for a `Stream` argument (and for `Iterator`) would complete the overall arrangement in `DataAccessUtils`.", "state": "CLOSED", "labels": {"totalCount": 3, "pageInfo": {"hasNextPage": false, "endCursor": "Mw"}, "nodes": [{"name": "in: data"}, {"name": "type: enhancement"}, {"name": "status: superseded"}]}, "comments": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpHOOmfCCg=="}, "nodes": [{"id": "IC_kwDOABGHUc46Z8IK", "author": {"login": "rstoyanchev"}, "body": "Superseded by #27735.", "createdAt": "2021-11-26T10:53:50Z", "updatedAt": "2021-11-26T10:53:50Z"}]}}]}}
{"id": "MDExOlB1bGxSZXF1ZXN0NzE2ODE1ODg5", "title": "Fix UrlPathHelper#shouldRemoveSemicolonContent()", "body": "Fixes #27256\r\n\r\nThis PR fixes a bug that renders read-only `UrlPathHelper`s unusable, because `shouldRemoveSemicolonContent()` throws an exception. For example, when using `UrlPathHelper#rawPathInstance`, which is read-only.\r\n\r\nThe `checkReadOnly()` method should only be called from methods that modify properties to prevent modification of read-only instances.", "number": 27303, "url": "https://github.com/spring-projects/spring-framework/pull/27303", "author": {"login": "evpaassen"}, "createdAt": "2021-08-20T15:16:19Z", "mergedAt": "2021-08-22T12:10:25Z", "mergedBy": {"login": "sbrannen"}, "baseRefOid": "9f7a94058a4bbc967fe47bfe6a82d88cb3feddfb", "baseRefName": "main", "headRefOid": "51a17316ff5d464400ffc9f7a42b34ba0c0eea69", "headRefName": "fix-27256", "changedFiles": 2, "labels": {"totalCount": 3, "pageInfo": {"hasNextPage": false, "endCursor": "Mw"}, "nodes": [{"name": "status: backported"}, {"name": "in: web"}, {"name": "type: bug"}]}, "commits": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"commit": {"oid": "51a17316ff5d464400ffc9f7a42b34ba0c0eea69", "message": "Fix UrlPathHelper#shouldRemoveSemicolonContent()\n\nThe checkReadOnly() method should only be called from\nmethods that modify properties to prevent modification\nof read-only instances.\n\nFixes #27256", "changedFilesIfAvailable": 2, "authoredDate": "2021-08-20T15:09:57Z", "author": {"user": {"login": "evpaassen"}}, "committedDate": "2021-08-20T18:33:04Z", "committer": {"user": {"login": "evpaassen"}}, "parents": {"nodes": [{"oid": "9f7a94058a4bbc967fe47bfe6a82d88cb3feddfb"}]}}}]}, "reviews": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "reviewThreads": {"totalCount": 0, "pageInfo": {"hasNextPage": false, "endCursor": null}, "nodes": []}, "closingIssuesReferences": {"totalCount": 1, "pageInfo": {"hasNextPage": false, "endCursor": "MQ"}, "nodes": [{"id": "MDU6SXNzdWU5NjUwMTkzNjc=", "number": 27256, "url": "https://github.com/spring-projects/spring-framework/issues/27256", "title": "UrlPathHelper: checkReadOnly() called in read method shouldRemoveSemicolonContent()", "body": "<!--\r\n!!! For Security Vulnerabilities, please go to https://spring.io/security-policy !!!\r\n-->\r\n**Affects:** 5.3.8\r\n\r\n---\r\n<!--\r\nThanks for taking the time to create an issue. Please read the following:\r\n\r\n- Questions should be asked on Stack Overflow.\r\n- For bugs, specify affected versions and explain what you are trying to do.\r\n- For enhancements, provide context and describe the problem.\r\n\r\nIssue or Pull Request? Create only one, not both. GitHub treats them as the same.\r\nIf unsure, start with an issue, and if you submit a pull request later, the\r\nissue will be closed as superseded.\r\n-->\r\nMethod `checkReadOnly` is called in read method UrlPathHelper#shouldRemoveSemicolonContent, line 149. If we want to know whether we should `removeSemicolonContent` when `this.readOnly` is true, an error will be thrown.\r\n```\r\npublic boolean shouldRemoveSemicolonContent() {\r\n    checkReadOnly();\r\n    return this.removeSemicolonContent;\r\n}\r\n```", "state": "CLOSED", "labels": {"totalCount": 4, "pageInfo": {"hasNextPage": false, "endCursor": "NA"}, "nodes": [{"name": "status: backported"}, {"name": "in: web"}, {"name": "type: bug"}, {"name": "status: superseded"}]}, "comments": {"totalCount": 2, "pageInfo": {"hasNextPage": false, "endCursor": "Y3Vyc29yOnYyOpHONc-vSQ=="}, "nodes": [{"id": "IC_kwDOABGHUc41zyX8", "author": {"login": "evpaassen"}, "body": "Today I encountered this bug too. I created PR #27303 to fix it.", "createdAt": "2021-08-20T15:17:46Z", "updatedAt": "2021-08-20T15:17:46Z"}, {"id": "IC_kwDOABGHUc41z69J", "author": {"login": "sbrannen"}, "body": "Superseded by #27303.", "createdAt": "2021-08-20T16:13:31Z", "updatedAt": "2021-08-20T16:13:31Z"}]}}]}}
